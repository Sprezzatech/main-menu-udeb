<!-- retain these comments for translator revision tracking -->
<!-- $Id: install-tftp.xml 23213 2004-10-18 21:04:56Z fjpop-guest $ -->

 <sect1 condition="supports-tftp" id="install-tftp">
 <title>Подготовка файлов для загрузки по TFTP</title>
<para>Если ваша машина подключена к локальной сети, то вы можете загружать её по сети с другой машины через TFTP. Если вы намерены загрузить систему установки с другой машины, то на эту машину в определённое место вам нужно поместить загрузочные файлы, и настроить поддержку загрузки вашей машины. </para><para>Вам нужно настроить TFTP, а если машин много, то и BOOTP сервер<phrase condition="supports-rarp">, или RARP сервер</phrase> <phrase condition="supports-dhcp">, или DHCP сервер</phrase>. </para><para><phrase condition="supports-rarp">Reverse Address Resolution Protocol (RARP) это один из путей сказать клиенту какой адрес IP для него предназначен. Другой способ это использовать BOOTP протокол. </phrase> <phrase condition="supports-bootp">BOOTP это IP протокол, который информирует компьютер о его IP адресе и где в сети получитьзагрузочный образ. </phrase> <phrase arch="m68k"> Другая альтернатива есть на системах VMEbus: IP адресможно вручную настроить в boot ROM. </phrase> <phrase condition="supports-dhcp">DHCP (Dynamic Host Configuration Protocol) более гибок, обратно совместимое расширение BOOTP. Некоторые системы могут быть настроены только через DHCP.</phrase> </para><para arch="powerpc">Для PowerPC, если вы имеете машину NewWorld Power Macintosh, лучше использоватьDHCP вместо BOOTP. Некоторые из последних машин невозможно загрузить с помощью BOOTP. </para><para arch="alpha">В отличие от Open Firmware в машинах Sparc и PowerPC, SRM консоль<emphasis>не</emphasis> будет использовать RARP для получения IP адреса, и поэтомувы должны использовать BOOTP для загрузки по сети вашей Alpha. Также вы можете ввести IP настройку для сетевых интерфейсов в SRM консоли. <footnote> <para>Системы Alpha также могут быть загружены по сети с помощью DECNet MOP (Maintenance Operations Protocol), но это здесь не описано. По-видимому, вам локальный операторOpenVMS будет счастлив рассказать, что нужно для MOP, чтобы загрузить Linux на Alpha. </para>
</footnote></para><para arch="hppa">Некоторые старые HPPA машины (например 715/75) используют RBOOTD, а не BOOTP. ПакетRBOOTD доступен на веб сайте parisc-linux. </para><para>Trivial File Transfer Protocol (TFTP) используется для загрузки загрузочного образа на клиент. Теоретически, можно использовать любой сервер, на любой платформе, которая реализует эти протоколы. В примерах этого раздела, мы используем команды из SunOS 4.x, SunOS 5.x (так называемый Solaris) и GNU/Linux. </para>
&tftp-rarp.xml; &tftp-bootp.xml; &tftp-dhcp.xml; <sect2 id="tftpd">
  <title>Включение TFTP сервера</title>
<para>Для запуска TFTP сервера, во-первых вы должны убедиться, что<command>tftpd</command> разрешён. Обычно, это делается добавлениемв <filename>/etc/inetd.conf</filename> строки вида: <informalexample><screen>

tftp dgram udp wait nobody /usr/sbin/tcpd in.tftpd /tftpboot

</screen></informalexample> Пакеты Debian сами создают такую строку при установке. </para><para>Загляните в этот файл и запомните каталог, который используется в качестве аргумента<command>in.tftpd</command>; он вам потребуется в дальнейшем. Аргумент <userinput>-l</userinput> в некоторых версиях <command>in.tftpd</command> включает запись протокола всех обращений в системные журналы; это полезно для диагностики ошибок.Если вы изменили <filename>/etc/inetd.conf</filename>, вам нужно об этом сказать запущенному процессу <command>inetd</command>. На машине Debian, выполните <userinput>/etc/init.d/inetd reload</userinput>; на других машинах, определите ID процесса <command>inetd</command>, и запустите <userinput>kill -HUP <replaceable>inetd-pid</replaceable></userinput>. </para><note arch="i386"><para>Для использования загрузки по TFTP в методе Pre-boot Execution Environment (PXE) , вам нужен TFTP сервер с поддержкой <userinput>tsize</userinput>. В сервере&debian;, этому условию удовлетворяют пакеты <classname>atftpd</classname> и <classname>tftpd-hpa</classname>; мы рекомендуем <classname>tftpd-hpa</classname>. </para></note><para arch="mips">Если вы хотите установить Debian на машину SGI, а ваш TFTP сервер работает на GNU/Linux с ядром Linux 2.4, то вам нужно выполнить следующее: <informalexample><screen>

echo 1 > /proc/sys/net/ipv4/ip_no_pmtu_disc

</screen></informalexample> чтобы отключить обнаружение Path MTU, иначеIndy PROM не сможет загрузить ядро. Кроме того, убедитесь, что TFTP пакеты посылаютсяс портом источника не более 32767, или загрузка остановится после первого пакета. Ещё раз, это ошибка Linux 2.4.X при работе с PROM, и вы можете избежать этого, выполнив настройку<informalexample><screen>

echo "2048 32767" > /proc/sys/net/ipv4/ip_local_port_range

</screen></informalexample>, которая регулирует диапазон портов источника используемого Linux сервере TFTP. </para>
  </sect2>

  <sect2 id="tftp-images">
  <title>Копирование TFTP образов в нужное место</title>
<para>Далее, поместите нужный загрузочный образ TFTP, из <xref linkend="where-files"/>, в каталог загрузочных образов <command>tftpd</command>. Как правило, этот каталог называется <filename>/tftpboot</filename>. Вы можете сделать ссылку на этот файл для файла, который будет загружать <command>tftpd</command> для загрузки определённому клиенту. К сожалению, имя файла, определяется TFTP клиентом, и никак не стандартизовано. </para><para arch="powerpc">На машинах NewWorld Power Macintosh, вам нужно настроить системный загрузчик<command>yaboot</command> на загрузочный образ TFTP. <command>Yaboot</command> затем получит образы ядра и RAMdisk через TFTP сам. Для сетевой загрузки, используйте <filename>yaboot-netboot.conf</filename>. Просто переименуйте его в <filename>yaboot.conf</filename> в каталоге TFTP. </para><para arch="i386">Для загрузки через PXE, всё что нужно лежит в файле<filename>netboot/netboot.tar.gz</filename>. Просто распакуйте этот файлв каталог загрузочных образов <command>tftpd</command>. Убедитесь, чтоdhcp сервер передаёт <filename>/pxelinux.0</filename> <command>tftpd</command> в качестве имени файла для загрузки. </para><para arch="ia64">Для загрузки через PXE, всё что нужно лежит в файле<filename>netboot/netboot.tar.gz</filename>. Просто распакуйте этот файлв каталог загрузочных образов <command>tftpd</command>. Убедитесь, чтоdhcp сервер передаёт <filename>/debian-installer/ia64/elilo.efi</filename> <command>tftpd</command> в качестве имени файла для загрузки. </para>

   <sect3 arch="mipsel">
   <title>TFTP образы для DECstation</title>
<para>Для DECstation, для каждой субархитектуры существует свой файл tftpimage, которыйсодержит ядро и программу установки. Правило именования:<replaceable>субархитектура</replaceable>/netboot-boot.img. Скопируйте файлаtftpimage, который нужно использовать в <userinput>/tftpboot/tftpboot.img</userinput>, если вы работаете с настройками BOOTP/DHCP, как примере, приведённом выше. </para><para>Микропрограмма DECstation производит загрузку по TFTP по команде <userinput>boot <replaceable>#</replaceable>/tftp</userinput>, где <replaceable>#</replaceable> это номер устройства TurboChannel с которого нужно загрузиться. На большинстве DECstation это номер "3". Если сервер BOOTP/DHCP не передаёт имя файла или вам нужно передать дополнительные параметры, они могут быть добавлены с помощью в следующем виде: </para><para>

<userinput>boot #/tftp/filename param1=value1 param2=value2 ...</userinput>

</para><para>У некоторых версий микропрограмм DECstation обнаружились проблемы в отношении загрузке по сети: передача начинается, но через некоторое время останавливается с ошибкой<computeroutput>a.out err</computeroutput>. Это может происходить по следующим причинам: <orderedlist> <listitem><para> Микропрограмма не отвечает на ARP запрос во времяTFTP передачи. Это приводит ожиданию ARP и остановки передачи. Решением будет добавить MAC адрес Ethernet карты DECstation статически в ARP таблицу TFTP сервера. Это достигается командой<userinput>arp -s <replaceable>IP-адрес</replaceable> <replaceable>MAC-адрес</replaceable></userinput> от суперпользователя на машине, служащей TFTP сервером. MAC-адрес DECstation можно прочитать введя в приглашении микропрограммы DECstation <command>cnfg</command>. </para></listitem> <listitem><para> Микропрограмма имеет ограничение на размер файлов, которые можно загрузить черезy TFTP. </para></listitem> </orderedlist>Также, есть версии микропрограмм, которые совсем не могут производить загрузку поa TFTl.Описание различий версий микропрограмм можно найти на веб страницахe NetBSs: <ulink url="http://www.netbsd.org/Ports/pmax/board-list.html#proms"></ulink>. </para>
   </sect3>

   <sect3 arch="alpha">
   <title>Загрузка Alpha по TFTP</title>
<para>На Alpha, вы должны указать имя файла (относительно каталога загрузочных образов) с помощью аргумента <userinput>-file</userinput> команды SRM <userinput>boot</userinput>, или установив переменную среды <userinput>BOOT_FILE</userinput>. Или же, имя файла можно получить по BOOTP (в ISC <command>dhcpd</command>, используйте директиву <userinput>filename</userinput>). В отличие от Open Firmware, <emphasis>имя файла по умолчанию не заданоfilename</emphasis> в SRM, поэтому вы <emphasis>должны</emphasis> указать имя файлаодним из этих методов. </para>
   </sect3>

   <sect3 arch="sparc">
   <title>Загрузка SPARC по TFTP</title>
<para>В SPARC архитектурах используются имена субархитектур, например``SUN4M'' или ``SUN4C''; в некоторых случаях, имя архитектуры оставляют пустым, аимя файла клиент ищет просто как <filename>ip-клиента-в-шестнадцатеричной-форме</filename>. То есть, если система с субархитектурой SUN4C, и IP адресом 192.168.1.3, то имя файлабудет <filename>C0A80103.SUN4C</filename>. Простой способ его определения это ввести следующую команду в оболочке (предполагаем, что машине назначен IP адрес равный 10.0.0.4). </para>

<informalexample><screen>printf '%.2x%.2x%.2x%.2x\n' 10 0 0 4
</screen></informalexample>

<para>Она выводит каждый октет IP в шестнадцатеричной форме; чтобы получить правильное имя файла, вам нужно изменить все буквы на заглавные и если нужно, добавить название субархитектуры. </para><para>Также вы можете заставить некоторые sparc системы брать имя файла из последнего параметра команды загрузки OpenPROM, например <userinput>boot net my-sparc.image</userinput>. Он всё ещё должен располагаться в каталоге, в котором его будет искать TFTP сервер. </para>
   </sect3>

   <sect3 arch="m68k">
   <title>Загрузка BVM/Motorola по TFTP</title>
<para>Для систем BVM и Motorola VMEbus скопируйте файлы &bvme6000-tftp-files; в каталог<filename>/tftpboot/</filename>. </para><para>Затем, настройте загрузку в ROM или в BOOTP на начальную загрузку файлов<filename>tftplilo.bvme</filename> или <filename>tftplilo.mvme</filename> с TFTP сервера. Обратитесь к файлу <filename>tftplilo.txt</filename> для вашей субархитектуры за дополнительной специфичной конфигурационной информацией. </para>
   </sect3>

   <sect3 arch="mips">
   <title>Загрузка SGI Indy по TFTP</title>
<para>На SGI Indy вы можете положиться на <command>bootpd</command> передав имяTFTP файла. Оно задаётся или как <userinput>bf=</userinput> в <filename>/etc/bootptab</filename> или как параметр <userinput>filename=</userinput> в <filename>/etc/dhcpd.conf</filename>. </para>
   </sect3>

   <sect3 arch="mips">
   <title>Загрузка Broadcom BCM91250A по TFTP</title>
<para>Не требуется как-то особенно настраивать DHCP, кроме как передать CFE полный путь к файлу для загрузки. </para>
   </sect3>

  </sect2>

<!-- FIXME: commented out since it seems too old to be usable and a current
            way is not known
  
  <sect2 id="tftp-low-memory">
  <title>TFTP Installation for Low-Memory Systems</title>
<para>

On some systems, the standard installation RAMdisk, combined with the
memory requirements of the TFTP boot image, cannot fit in memory.  In
this case, you can still install using TFTP, you'll just have to go
through the additional step of NFS mounting your root directory over
the network as well.  This type of setup is also appropriate for
diskless or dataless clients.

</para><para>

First, follow all the steps above in <xref linkend="install-tftp"/>.

<orderedlist>
<listitem><para>

Copy the Linux kernel image on your TFTP server using the
<userinput>a.out</userinput> image for the architecture you are
booting.

</para></listitem>
<listitem><para>

Untar the root archive on your NFS server (can be the same system as
your TFTP server): 

<informalexample><screen>

# cd /tftpboot
# tar xvzf root.tar.gz

</screen></informalexample>

Be sure to use the GNU <command>tar</command> (other tar programs, like the
SunOS one, badly handle devices as plain files).

</para></listitem>
<listitem><para>

Export your <filename>/tftpboot/debian-sparc-root</filename> directory
with root access to your client.  E.g., add the following line to
<filename>/etc/exports</filename> (GNU/Linux syntax, should be similar
for SunOS):

<informalexample><screen>

/tftpboot/debian-sparc-root client(rw,no_root_squash)

</screen></informalexample>

NOTE: "client" is the host name or IP address recognized by the server for
the system you are booting.

</para></listitem>
<listitem><para>

Create a symbolic link from your client IP address in dotted notation
to <filename>debian-sparc-root</filename> in the
<filename>/tftpboot</filename> directory.  For example, if the client
IP address is 192.168.1.3, do

<informalexample><screen>

# ln -s debian-sparc-root 192.168.1.3

</screen></informalexample>

</para></listitem>
</orderedlist>

</para>

  </sect2>

  <sect2 condition="supports-nfsroot">
  <title>Installing with TFTP and NFS Root</title>
<para>

Installing with TFTP and NFS Root is similar to 
<xref linkend="tftp-low-memory"/> because you don't want to 
load the RAMdisk anymore but boot from the newly created NFS-root file
system.  You then need to replace the symlink to the tftpboot image by
a symlink to the kernel image (for example,
<filename>linux-a.out</filename>).

</para><para>

RARP/TFTP requires all daemons to be running on the same server (the
workstation is sending a TFTP request back to the server that replied
to its previous RARP request).

</para>


  </sect2>
END FIXME -->
 </sect1>
