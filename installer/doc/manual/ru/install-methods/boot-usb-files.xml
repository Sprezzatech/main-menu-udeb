<!-- retain these comments for translator revision tracking -->
<!-- $Id: boot-usb-files.xml 22935 2004-10-09 18:36:20Z fjpop-guest $ -->

 <sect1 condition="bootable-usb" id="boot-usb-files">
 <title>Подготовка файлов для загрузки со сменного USB устройства</title>

<para>Для подготовки USB устройства вам нужна система с запущенной GNU/Linux и на которой поддерживается USB. Убедитесь, что загружен модуль ядра usb-storage (<userinput>modprobe usb-storage</userinput>) и попытайтесь выяснить на какое устройство SCSI отображено USB устройство (в примере используется <filename>/dev/sda</filename>). Чтобы производить запись на устройство, вам также нужно выключить защиту от записи. </para><para>Заметим, что USB устройство должно быть как минимум 128МБ (установка на меньший размервозможно после прочтения <xref linkend="usb-copy-flexible"/>). </para>

  <sect2 id="usb-copy-easy">
  <title>Копирование файлов - лёгкий путь</title>
<para>Существует файл "всё-в-одном" <filename>hd-media/boot.img.gz</filename>, который содержит все файлы установки (включая ядро), а также<command>SYSLINUX</command> и его файл конфигурации. Вам нужно только распаковать его прямо на USB устройство: <informalexample><screen>

gzip -dc boot.img.gz >/dev/<replaceable>sda</replaceable>

</screen></informalexample> Естественно, это уничтожит все данные на устройстве, поэтому не промахнитесь с именем USB устройства. </para><para>После этого, смонтируйте USB устройство (<userinput>mount /dev/sda /mnt</userinput>), которое теперь содержит файловую систему FAT, и скопируйте на него ISO образ Debian netinst или businesscard. Имя файла должно заканчиваться обязательно на<filename>.iso</filename>. Размонтируйте устройство (<userinput>umount /mnt</userinput>) и всё готово. </para>
  </sect2>

  <sect2 id="usb-copy-flexible">
  <title>Копирование файлов - гибкий путь</title>
<para>Если вам хочется больше гибкости или вы просто хотите знать, что на самом деле происходит, то можете воспользоваться следующим методом подготовки файлов. Мы покажем, как использовать на устройстве памяти только первый раздел, а не весь диск. </para><note><para>Так как большинство USB устройств продаются только с одним разделом FAT16, вам, вероятно, не хочется переразмечать или форматировать устройство. Если вас всё равно, то воспользуйтесь<command>cfdisk</command> или любой другой утилитой разметки для созданияраздела FAT16, а затем выполните <informalexample><screen>

mkdosfs /dev/<replaceable>sda1</replaceable>

</screen></informalexample> Обязательно вводите правильное имя устройства USB. Команда <command>mkdosfs</command> содержится в пакете Debian <classname>dosfstools</classname>. </para></note><para>Чтобы запустить ядро после загрузки с USB устройства, мы поместим на устройство системный загрузчик. Хотя должен работать любой системный загрузчик (например <command>LILO</command>), удобнее использовать <command>SYSLINUX</command>, так как он использует раздел FAT16 и настраивается простым редактированием текстового файла. Для изменения конфигурации системного загрузчика можно использовать любую операционную систему, которая поддерживает файловую систему FAT. </para><para>Чтобы положить <command>SYSLINUX</command> на раздел FAT16 устройства USB, установите пакеты <classname>syslinux</classname> и <classname>mtools</classname> в систему, и введите <informalexample><screen>

syslinux /dev/<replaceable>sda1</replaceable>

</screen></informalexample> Ещё раз отметим: не ошибитесь в имени устройства. Раздел не должен быть смонтирован при запуске <command>SYSLINUX</command>. Эта процедура переписывает загрузочный сектор раздела и создаёт файл<filename>ldlinux.sys</filename>, который содержит код системного загрузчика. </para><para>Смонтируйте раздел (<userinput>mount /dev/sda1 /mnt</userinput>) скопируйте следующие файлы из архива Debian на устройство: <itemizedlist> <listitem><para> <filename>vmlinuz</filename> (kernel binary) </para></listitem> <listitem><para> <filename>initrd.gz</filename> (образ ramdisk) </para></listitem> <listitem><para> <filename>syslinux.cfg</filename> (файл настройки SYSLINUX) </para></listitem> <listitem><para> Необязательные модули ядра</para></listitem> </itemizedlist> Если вы хотите переименовать файлы, учтите, что<command>SYSLINUX</command> работает только с файловыми именами DOS (8.3). </para><para>Файл настройки <filename>syslinux.cfg</filename> должен содержать две строки: <informalexample><screen>

default vmlinuz
append initrd=initrd.gz ramdisk_size=10000 root=/dev/rd/0 init=/linuxrc devfs=mount,dall rw

</screen></informalexample> Учтите, что может потребоваться увеличить параметр <userinput>ramdisk_size</userinput>, в зависимости от загружаемого образа. </para><para>Теперь вы должны положить какой-нибудь ISO образ Debian (businesscard, netinst или вообще один большой) на устройство (если он влезет). Имя файла образа обязательно должно заканчиваться на <filename>.iso</filename>. </para><para>Если вы хотите сделать установку через сеть, без использования ISO образа, вам естественно нужно пропустить предыдущий шаг. Кроме того, вам нужно использовать ramdisk из каталога <filename>netboot</filename>, а не из <filename>hd-media</filename>, так как <filename>hd-media/initrd.gz</filename> не содержит сетевой поддержки. </para><para>По завершению, размонтируйте съёмное USB устройство (<userinput>umount /mnt</userinput>) и включите защиту от записи. </para><warning><para>Если машина не хочет грузиться с USB устройства, носитель может содержать неправильную главную загрузочную запись (MBR). Чтобы исправить её, используйте команду <command>install-mbr</command> из пакета <classname>mbr</classname>: <informalexample><screen>install-mbr /dev/<replaceable>sda</replaceable>

</screen></informalexample>

</para></warning>
  </sect2>
 </sect1>
