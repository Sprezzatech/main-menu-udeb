<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- original version: 24663 -->

   <sect3 arch="powerpc">
   <title>Partitionner un périphérique USB sur &arch-title;</title>
<para>


La plupart des périphériques USB ne sont pas prêts à être amorcés par le
microprogramme Open Firmware, et vous devez les repartitionner.
Sur les systèmes Mac, faites <userinput>mac-fdisk /dev/sda</userinput>,
initialisez une nouvelle table des partitions avec la commande
<userinput>i</userinput> et créez une nouvelle partition Apple_Bootstrap
avec la commande <userinput>C</userinput>.
Remarquez que la première partition sera toujours la table des partitions 
elle-même. Saisissez&nbsp;:

<informalexample><screen>
$ hformat /dev/<replaceable>sda2</replaceable>
</screen></informalexample>

Faites attention à utiliser le périphérique correct pour la clé. Le programme
<command>hformat</command>  se trouve dans le paquet Debian
<classname>hfsutils</classname>.

</para><para>

Pour pouvoir lancer le noyau après l'amorçage sur la clé, nous y mettons
un programme d'amorçage. Le programme <command>yaboot</command> peut être
installer sur un système de fichiers HFS et configuré en modifiant un
simple fichier texte. On peut modifier la configuration du
programme d'amorçage avec tous les systèmes d'exploitation qui acceptent
le système de fichiers HFS.

</para><para>

L'utilitaire <command>ybin</command> de <command>yaboot</command> ne
comprend pas pour l'instant les périphériques USB, et vous devrez
installer <command>yaboot</command> manuellement avec les outils
<classname>hfsutils</classname>. Saisissez&nbsp;:

<informalexample><screen>
$ hmount /dev/sda2
$ hcopy -r /usr/lib/yaboot/yaboot :
$ hattrib -c UNIX -t tbxi :yaboot
$ hattrib -b :
$ humount
</screen></informalexample>

Encore une fois, faites bien attention à utiliser le nom correct pour la clé.
La partition ne doit pas être montée pendant la procédure. Cette procédure
met le programme d'amorçage sur la partition et utilise les outils HFS pour
préparer ce programme à être lancé par le microprogramme Open Firmware.
Ensuite, la clé USB peut être préparée avec les outils standards d'Unix.

</para><para>
Montez la partition (<userinput>mount /dev/sda2 /mnt</userinput>) et
copiez les fichiers suivants sur la clé&nbsp;:

<itemizedlist>
<listitem><para>

<filename>vmlinux</filename> (noyau binaire)

</para></listitem>
<listitem><para>

<filename>initrd.gz</filename> (image du disque virtuel initial)

</para></listitem>
<listitem><para>

<filename>yaboot.conf</filename> (fichier de configuration de yaboot)

</para></listitem>
<listitem><para>

<filename>boot.msg</filename> (message optionnel)

</para></listitem>
<listitem><para>

Modules optionnels du noyau

</para></listitem>
</itemizedlist>

</para><para>

Le fichier de configuration <filename>yaboot.conf</filename> doit contenir
les lignes suivantes&nbsp;:

<informalexample><screen>
default=install
root=/dev/ram

message=/boot.msg

image=/vmlinux
        label=install
        initrd=/initrd.gz
        initrd-size=10000
        append="devfs=mount,dall --"
        read-only
</screen></informalexample>

Remarquez que la valeur du paramètre <userinput>ramdisk_size</userinput>
doit être augmentée avec la taille de l'image qui est amorcée.

</para>
   </sect3>
