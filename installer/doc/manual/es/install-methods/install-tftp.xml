<!-- original version: 22232 -->

 <sect1 condition="supports-tftp" id="install-tftp">
 <title>Preparar los ficheros para arranque a través de red usando TFTP</title>
<para>

Si su máquina esta conectada a una red de área local, podría tener la
posibilidad de arrancarla a través de la red desde otra máquina, usando
TFTP. Si pretende arrancar el sistema de instalación desde otra máquina,
debe ubicar los ficheros de arranque necesarios en lugares especiales
en esa máquina, y ésta debe ser configurada para soportar el
arranque de su máquina específica.

</para><para>

Necesita configurar un servidor TFTP, y en caso tenga varias máquinas, un 
servidor BOOTP
<phrase condition="supports-rarp">, o un servidor RARP</phrase>
<phrase condition="supports-dhcp">, o un servidor DHCP</phrase>.

</para><para>

<phrase condition="supports-rarp">El protocolo de resolución reversa de 
dirección (RARP) es una forma de decirle al cliente que dirección IP
debe usar. Otra forma es usar el protocolo BOOTP. </phrase>

<phrase condition="supports-bootp">BOOTP es un protocolo IP que informa al
ordenador su dirección IP y desde donde puede obtener una imagen de arranque 
en la red.</phrase>

<phrase arch="m68k">Otra alternativa más existe en los sistemas VMEbus:
La dirección IP puede ser configurada manualmente en el ROM de arranque.
</phrase>

<phrase condition="supports-dhcp">El DHCP (Protocolo de configuración dinámica
de sistema) es mas flexible, una extensión compatible hacia atrás de BOOTP.
Algunos sistemas solamente puede ser configurados a través de DHCP. </phrase>

</para><para arch="powerpc">

Para PowerPC, si tiene una máquina Power Macintosh NewWorld, es una
buena idea utilizar DHCP en lugar de BOOTP. Algunas de los modelos más
recientes solamente pueden arrancar usando BOOTP.

</para><para arch="alpha"> 

A diferencia del Open Firmware encontrado en máquinas Sparc y PowerPC,
la consola SRM <emphasis>no</emphasis> usará RARP para obtener su
dirección IP, y por consiguiente deberá usar BOOTP para el arranque
a través de red en su Alpha. También puede ingresar la configuración IP
de las interfaces de red en la consola de SRM.

<footnote>
<para>

Los sistemas Alpha también pueden ser arrancados usando DECNet MOP 
(Protocolo de operaciones de mantenimiento), pero esto no se detalla
aquí. Presumiblemente, su operador de OpenVMS local estará gustoso de
asistirlo, deberá tener alguna fuerte razón para querer usar MOP para
arrancar Linux en su Alpha.

</para>
</footnote></para><para arch="hppa"> 

Algunas máquinas HPPA antiguas (como 715/75) usan RBOOTD en lugar de
BOOTP. Existe un paquete RBOOTD disponible en el sitio web de
parisc-linux.

</para><para>

El protocolo de transferencia trivial de ficheros (TFTP) es usado para
servir la imagen de arranque al cliente. Teóricamente, se puede 
usar cualquier servidor, en cualquier plataforma, que implemente este 
protocolo. En los ejemplos de esta sección, pondremos ordenes para
SunOS 4.x, SunOS 5.x (conocido también como Solaris) y GNU/Linux.

</para>

&tftp-rarp.xml;
&tftp-bootp.xml;
&tftp-dhcp.xml;

  <sect2 id="tftpd">
  <title>Habilitar el servidor TFTP</title>
<para>

Para tener listo el servidor TFTP, primero deberá asegurarse que
<command>tftpd</command> está habilitado. Esto generalmente se
efectúa al añadir a <filename>/etc/inetd.conf</filename>, algo
similar a lo siguiente:

<informalexample><screen>

tftp dgram udp wait nobody /usr/sbin/tcpd in.tftpd /tftpboot

</screen></informalexample>

Los paquetes Debian cuando se instalan, por lo general configuran
esto correctamente de forma predeterminada.

</para><para>

Busque en ese fichero y recuerde el directorio que usa como
argumento de <command>in.tftpd</command>; lo necesitará mas
adelante. El argumento <userinput>-l</userinput> habilita en algunas
versiones de <command>in.tftpd</command> el registro de los accesos
al sistema; esto es útil para diagnosticar fallos de arranque. Si
ha tenido que cambiar <filename>/etc/inetd.conf</filename>, deberá
notificar al proceso <command>inetd</command> en ejecución que el
fichero ha cambiado. En una máquina Debian, ejecute
<userinput>/etc/init.d/inetd reload</userinput>; en otras máquinas,
busque el ID del proceso <command>inetd</command>, y ejecute
<userinput>kill -HUP <replaceable>id-de-inetd</replaceable></userinput>.

</para><note arch="i386"><para>

Para usar el método de entorno de ejecución prearranque (PXE) del
arranque de TFTP, necesitará un servidor TFTP con soporte de
<userinput>tsize</userinput>. En un servidor &debian;, los paquetes
<classname>atftpd</classname> y <classname>tftpd-hpa</classname> 
califican; recomendamos <classname>tftpd-hpa</classname>.

</para></note><para arch="mips">

Si su servidor TFTP es una máquina GNU/Linux ejecutando Linux 2.4.x 
necesitará configurar lo siguiente:

<informalexample><screen>

echo 1 > /proc/sys/net/ipv4/ip_no_pmtu_disc

</screen></informalexample>

para desactivar el descubrimiento de ruta MTU, de otro modo el PROM
no podrá descargar el núcleo. Adicionalmente, asegúrese de que los
paquetes de TFTP son enviados desde un puerto origen no mayor a 32767,
o la descarga colapsará después del primer paquete. Nuevamente, es Linux
2.4.x el que presenta este fallo en el PROM, y puede evitarlo configurando

<informalexample><screen>

echo "2048 32767" > /proc/sys/net/ipv4/ip_local_port_range

</screen></informalexample>

para ajustar el rango de puertos origen que usa el servidor TFTP.

</para>
  </sect2>

  <sect2 id="tftp-images">
  <title>Mover las imágenes TFTP a su ubicación</title>
<para>

Seguidamente, localice la imagen TFTP de arranque que necesita, que
se encuentra en <xref linkend="where-files"/>, en el directorio de
imagen de arranque de <command>tftpd</command>. Generalmente, este
directorio será <filename>/tftpboot</filename>. Tendrá que hacer un
enlace desde este fichero hacia el fichero que usará 
<command>tftpd</command> para arrancar un cliente en particular. 
Desafortunadamente, el nombre del fichero es determinado por el 
cliente TFTP, y no existe un estándar definido.

</para><para arch="powerpc">

En máquinas Power Macintosh NewWorld, necesitará configurar
el gestor de arranque <command>yaboot</command> como la imagen de
arranque de TFTP. Entonces <command>Yaboot</command> recuperará las
imágenes del núcleo y disco ram a través del mismo TFTP. Para
arranque a través de red, use <filename>yaboot-netboot.conf</filename>.  
Simplemente renombrelo a <filename>yaboot.conf</filename> en el 
directorio de TFTP.

</para><para arch="i386">

Para arranque PXE, todo lo que necesitará es configurar el fichero de
archivo tar <filename>netboot/pxeboot.tar.gz</filename>. Simplemente 
extraiga este fichero en el directorio de imagen de arranque de 
<command>tftpd</command>.

</para><para arch="ia64">

Para arranque PXE, todo lo que necesitará es configurar el fichero de
archivo tar <filename>netboot/pxeboot.tar.gz</filename>. Simplemente 
extraiga este fichero en el directorio de imagen de arranque de 
<command>tftpd</command>.
Asegúrese de que su servidor dhcp está configurado para pasar 
<filename>/debian-installer/ia64/elilo.efi</filename> como
el nombre de fichero a arrancar a <command>tftpd</command>.

</para>


   <sect3 arch="mipsel">
   <title>Imágenes TFTP para DECstation</title>
<para>

Para DECstations, existen ficheros «tftpimage» para cada subarquitectura,
que contienen tanto el núcleo y el instalador en un solo fichero. La
convención de nombrado es tftpimage-<replaceable>subarquitectura</replaceable>
o tftpimage-<replaceable>subarquitectura</replaceable>.gz. Si el
«tftpimage» está comprimido con gzip (el nombre termina con .gz), primero
necesitará descomprimirlo con <userinput>gunzip
tftpimage-<replaceable>subarquitectura</replaceable>.gz</userinput>,
puesto que las DECstations no puede arrancar ficheros comprimidos a través
de TFTP. Copie el fichero «tftpimage» que desea usar a
<userinput>/tftpboot/tftpboot.img</userinput> si está usando la configuración
BOOTP/DHCP de ejemplo, descrita anteriormente.

</para><para>

El firmware de DECstations arranca por TFTP con la orden
<userinput>boot <replaceable>#</replaceable>/tftp</userinput>, donde
<replaceable>#</replaceable> es el número del dispositivo TurboChannel
desde donde arranca. En la mayoría de DECstations es «3». Si el servidor
BOOTP/DHCP no provee el fichero o necesita pasar parámetros adicionales,
éstos pueden ser opcionalmente añadidos con la siguiente sintaxis:

</para><para>

<userinput>boot #/tftp/fichero param1=valor1 param2=valor2 ...</userinput>

</para><para>

Algunas revisiones del firmware de DECstations muestran un problema
respecto al arranque a través de red: la transferencia se inicia, pero luego
de algún tiempo para con un <computeroutput>a.out err</computeroutput>. 
Esto puede tener diferentes razones:

<orderedlist>
<listitem><para>

El firmware no responde a solicitudes ARP durante una transferencia
TFTP. Esto lleva a una expiración de ARP y paralización de la
transferencia. La solución es añadir la dirección MAC de la tarjeta
Ethernet de la DECstation estáticamente a la tabla ARP del servidor
TFTP. Esto se hace ejecutando
<userinput>arp -s
<replaceable>Dirección IP</replaceable>
<replaceable>Dirección MAC</replaceable></userinput> 
como superusuario en la máquina que actúa como servidor TFTP. La «dirección 
MAC» de la DECstation puede ser obtenida al ingresar la orden
<command>cnfg</command> en el cursor de la DECstation.

</para></listitem>
<listitem><para>

El firmware tiene un límite de tamaño de los ficheros que pueden
ser arrancados a través de TFTP.

</para></listitem>
</orderedlist>

También existen revisiones de firmware que no pueden arrancar por
completo a través de TFTP. Puede encontrar una descripción sobre las 
diferentes revisiones de firmware en las páginas web de NetBSD:
<ulink url="http://www.netbsd.org/Ports/pmax/board-list.html#proms"></ulink>.

</para>
   </sect3>

   <sect3 arch="alpha">
   <title>Arranque TFTP en Alpha</title>
<para>
En Alpha, debe especificar el nombre del fichero (como una ruta relativa
al directorio de imagen de arranque) usando el argumento
<userinput>-file</userinput> de la orden <userinput>boot</userinput> de SRM,
o definiendo la variable de entorno <userinput>BOOT_FILE</userinput>.
Alternativamente, el nombre del fichero puede ser dado a través de BOOTP
(en <command>dhcpd</command> de ISC,
use la directiva <userinput>filename</userinput>). A diferencia de
Open Firmware, <emphasis>no existe nombre de fichero predeterminado</emphasis>
en SRM, de modo que <emphasis>debe</emphasis> especificar un nombre de 
fichero por alguno de estos métodos.

</para>
   </sect3>

   <sect3 arch="sparc">
   <title>Arranque de TFTP en SPARC</title>
<para>

Las arquitecturas SPARC por ejemplo usan los nombre de subarquitecturas,
como «SUN4M» o «SUN4C»; en algunos casos, la arquitectura se deja en
blanco, de modo que el fichero que el cliente busca es simplemente
<filename>ip-del-cliente-en-hex</filename>. Esto es, si la subarquitectura
de su sistema es «SUN4C» y su IP es 192.168.1.3, el nombre del fichero
será <filename>C0A80103.SUN4C</filename>.

</para><para>

También puede forzar algunos sistemas sparc para buscar un fichero en
específico al añadirlo al final de la orden boot de OpenPROM, como
<userinput>boot net mi-imagen.sparc</userinput>. Esta deberá
encontrarse en el directorio en el busca el servidor TFTP.

</para>
   </sect3>

   <sect3 arch="m68k">
   <title>Arranque TFTP de BVM/Motorola</title>
<para>

Para sistemas BVM y Motorola VMEbus copie los ficheros
&bvme6000-tftp-files; a <filename>/tftpboot/</filename>.

</para><para>

Seguidamente, configure su ROMs de arranque o servidor BOOTP para cargar
inicialmente los ficheros <filename>tftplilo.bvme</filename> o
<filename>tftplilo.mvme</filename> desde el servidor TFTP. Vea el fichero
<filename>tftplilo.txt</filename> para información adicional de configuración
específica para su subarquitectura.

</para>
   </sect3>

   <sect3 arch="mips">
   <title>Arranque TFTP en Indys SGI</title>
<para>

En Indys SGI puede confiar en <command>bootpd</command> para proveer
el nombre del fichero TFTP. Éste se señala ya sea como
<userinput>bf=</userinput> en <filename>/etc/bootptab</filename> o como
la opción <userinput>filename=</userinput> en
<filename>/etc/dhcpd.conf</filename>.

</para>
   </sect3>

   <sect3 arch="mips">
   <title>Arranque TFTP en BCM91250A</title>
<para>

Usted no necesita configurar DHCP de alguna forma especial debido a
que pasará la ruta completa del fichero a ser cargado en el «CFE».

</para>
   </sect3>

  </sect2>

<!-- FIXME: commented out since it seems too old to be usable and a current
            way is not known
  
  <sect2 id="tftp-low-memory">
  <title>Instalación TFTP para sistemas con poca memoria</title>
<para>

En algunos sistemas, la instalación estándar de disco ram, combinada
con los requisitos de memoria de la imagen de arranque TFTP, no
caben en memoria. En este caso, todavía puede instalar usando TFTP, 
simplemente tendrá que realizar pasos adicionales de montado NFS de su
directorio raíz a través de la red. Este tipo de configuración
también es apropiada para clientes sin disco o sin datos.

</para><para>

Primero, siga todos los pasos descritos anteriormente en 
<xref linkend="install-tftp"/>.

<orderedlist>
<listitem><para>

Copie la imagen del núcleo Linux en su servidor TFTP usando la
imagen <userinput>a.out</userinput> para la arquitectura que
esta arrancando.

</para></listitem>
<listitem><para>

Desempaquete el archivo raíz en su servidor NFS (puede ser el mismo
sistema que su servidor TFTP):

<informalexample><screen>

# cd /tftpboot
# tar xvzf root.tar.gz

</screen></informalexample>

Asegúrese de usar GNU <command>tar</command> (otros programas, como el de
SunOS, erróneamente tratan a los dispositivos como ficheros planos).

</para></listitem>
<listitem><para>

Exporte su directorio <filename>/tftpboot/debian-sparc-root</filename>
con acceso de superusuario a su cliente. Ejm. añada la siguiente
línea a <filename>/etc/exports</filename> (sintáxis de GNU/Linux, 
deberá ser similar para SunOS):

<informalexample><screen>

/tftpboot/debian-sparc-root cliente(rw,no_root_squash)

</screen></informalexample>

NOTA: «cliente» es el nombre de máquina o dirección IP reconocida por
el servidor, para el sistema que esta arrancando.

</para></listitem>
<listitem><para>

Cree un enlace simbólico para la dirección IP de su cliente en notación
punteada a <filename>debian-sparc-root</filename> en el directorio
<filename>/tftpboot</filename>. Por ejemplo, si la dirección IP del
cliente es 192.168.1.3, efectúe

<informalexample><screen>

# ln -s debian-sparc-root 192.168.1.3

</screen></informalexample>

</para></listitem>
</orderedlist>

</para>

  </sect2>

  <sect2 condition="supports-nfsroot">
  <title>Instalar con TFTP y raíz NFS</title>
<para>

Instalar con TFTP y raíz NFS es similar a 
<xref linkend="tftp-low-memory"/> debido a que no desea cargar el
disco ram, pero sí arrancar desde el nuevo sistema de ficheros NFS raíz 
creado. Luego necesitará reemplazar el enlace simbólico de la imagen
«tftpboot» por un enlace simbólico a la imagen del núcleo (por ejemplo,
<filename>linux-a.out</filename>).

</para><para>

RARP/TFTP requiere que todos los demonios se ejecuten en el mismo servidor
(la estación de trabajo envía una solicitud TFTP al servidor que respondió
a su solicitud RARP anterior).

</para>


  </sect2>
END FIXME -->
 </sect1>
