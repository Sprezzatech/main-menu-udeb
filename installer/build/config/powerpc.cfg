SUBARCH_SUPPORTED = powerpc power3 power4 powerpc-small apus

KERNELMAJOR = 2.6
INITRD_FS = cramfs

# create the kernels with builtin initrd.
builtin_initrd: $(TEMP_KERNEL) $(TEMP_INITRD)
	# temporary hack
	case $(KERNELMAJOR) in \
		2.6)	\
			for subarch in chrp prep; do	\
				rm -f $(DEST)/vmlinuz-$$subarch.initrd;	\
				mkvmlinuz				\
					-a $$subarch			\
					-k $(TEMP_KERNEL)		\
					-z -i $(TEMP_INITRD)		\
					-d $(TEMP)/lib			\
					-o $(DEST)/vmlinuz-$$subarch.initrd;	\
			done	\
			;;	\
		2.4)	\
			if [ ! -d $(TEMP_POWERPC_INITRD) ]; then	 \
				mkdir $(TEMP_POWERPC_INITRD);		\
			fi; \
			powerpc-builtin-initrd.sh	\
				$(TEMP_KERNEL)		\
				$(TEMP)/System.map	\
				$(TEMP_INITRD)		\
				$(TEMP_POWERPC_INITRD)	\
				$(DEST)			\
				$(KERNELIMAGEVERSION)	\
				$(POWERPCIMAGETYPES);	\
			;;	\
		*)	\
			echo "Kernel $(KERNEL_MAJOR) not supported yet\n"	\
			;;\
	esac

# cd content for powerpc, includes yaboot for booting 
# apple powerpc (newworld) computers
cd_content_common:
	mkdir -p $(TEMP_CD_TREE)
	mkdir -p $(TEMP_CD_TREE)/install/powermac

	cp $(TEMP_KERNEL) $(TEMP_CD_TREE)/install/powermac/$(TYPE)-linux
	ln -f $(TEMP_INITRD) $(TEMP_CD_TREE)/install/powermac/$(TYPE)-initrd.gz

	# New-world bootability
	cp -f boot/powerpc/ofboot.b $(TEMP_CD_TREE)/install/
	cp -f /usr/lib/yaboot/yaboot $(TEMP_CD_TREE)/install/
	./bootscreen-subst "${MEDIA_TYPE}" "${DEBIAN_VERSION}" "${BUILD_DATE}" \
		< boot/powerpc/boot.msg > $(TEMP_CD_TREE)/install/boot.msg
	./ramdisk-size-subst $(TEMP_INITRD) \
		< boot/powerpc/yaboot.conf \
		| sed 's/\$${TYPE}/$(TYPE)/g' \
		> $(TEMP_CD_TREE)/install/yaboot.conf

# creates a bootable cd image for powerpc
arch_miniiso_common: cd_content_common
	mkisofs -r -T --netatalk -hfs -probe -map boot/powerpc/hfs.map -part -no-desktop -hfs-bless $(TEMP_CD_TREE)/install -hfs-volid Debian-Installer/PPC -o $(TEMP_MINIISO) $(TEMP_CD_TREE)
