MEDIA_TYPE = netboot image

TARGET = $(INITRD) $(KERNEL) nslu2_swap $(SOME_DEST)/$(EXTRANAME)di-nslu2.bin
EXTRANAME = $(MEDIUM)/
TYPE = netboot/network-console
INITRD_FS = initramfs

MANIFEST-INITRD = "netboot initrd"
MANIFEST-KERNEL = "kernel image to netboot"

# byteswap boot loader, initrd and kernel for NSLU2
nslu2_initrd: $(INITRD) $(KERNEL)
	devio "<<"/boot/apex.flash > $(TEMP)/apex.flash.swapped \
	    'xp $$,4'
	util/arm/nslu2/pad-initrd $(TEMP)
	devio "<<"$(TEMP)/initrd.gz > $(TEMP)/initrd.gz.swapped
	    'xp $$,4'
	devio "<<"$(TEMP)/$(KERNELNAME) > $(TEMP)/$(KERNELNAME).swapped \
	    'xp $$,4'

# Generate an image for Linksys NSLU2 which can be flashed
$(SOME_DEST)/$(EXTRANAME)di-nslu2.bin:
	slugimage -p -L $(TEMP)/apex.flash.swapped -k -r $(TEMP)/initrd.gz.swapped \
	    -k $(TEMP)/$(KERNELNAME).swapped -o $@
	update-manifest $@ "Flashable firmware image of debian-installer for NSLU2"

