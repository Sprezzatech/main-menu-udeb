MEDIA_TYPE = netboot image

TARGET = $(INITRD) $(KERNEL) n2100
TYPE = netboot
EXTRANAME = $(TYPE)/

MANIFEST-INITRD = "netboot initrd"
MANIFEST-KERNEL = "kernel image to netboot"

VERSION = 4.0.0

# Thecus N2100
n2100:
	mkdir -p $(TEMP)/n2100/upgrade
	install -m 755 util/arm/thecus/up.sh $(TEMP)/n2100/upgrade/
	cp $(TEMP_KERNEL) $(TEMP)/n2100/upgrade/initrd
	# Set machine id 1101 (0x044d)
	devio > $(TEMP)/n2100/upgrade/vmlinuz 'wl 0xe3a01c04,4' 'wl 0xe381104d,4'
	cat $(TEMP_INITRD) >> $(TEMP)/n2100/upgrade/vmlinuz
	echo $(VERSION) > $(TEMP)/n2100/upgrade/version
	(cd $(TEMP)/n2100 && tar -cpf n2100.tar upgrade)
#	util/arm/thecus/des -k n2100 -E $(TEMP)/n2100/n2100.tar > $(SOME_DEST)/$(EXTRANAME)/n2100.bin
	cat $(TEMP)/n2100/n2100.tar > $(SOME_DEST)/$(EXTRANAME)/n2100.bin
	update-manifest $(SOME_DEST)/$(EXTRANAME)/n2100.bin "Firmware for Thecus N2100"

