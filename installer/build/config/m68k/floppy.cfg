MEDIA_TYPE = floppy image

TYPE = floppy

EXTRANAME = floppy/

include config/m68k/common-kernel.cfg

# The version of the kernel to use.
KERNELMAJOR = 2.2
KERNELVERSION = $(M68K_KERNEL22_VME) $(M68K_KERNEL_VME) $(M68K_KERNEL_ATARI) $(M68K_KERNEL22_ATARI)
KERNEL_FLAVOUR = di
KERNELIMAGEVERSION = $(KERNELVERSION)
KERNELNAME = $(foreach ver,$(KERNELVERSION),vmlinuz-$(ver))
VERSIONED_SYSTEM_MAP = t

# sudo is required for vmelilo, see bts #250578.
ROOTCMD = sudo

include config/m68k/common.cfg
include config/m68k/common-vme.cfg


# gzip the floppies
GZIPPED = .gz


#$(TEMP_ROOT): $(TEMP_INITRD) arch_root

.PHONY: arch_root2
arch_root2: 
	mkdir -p $(TEMP)/$(SUB)root/etc
	cp $(TEMP_INITRD) $(TEMP)/$(SUB)root/root.bin
	./makelabel $(DISK_LABEL) $(BUILD_DATE) > $(TEMP)/$(SUB)root/disk.lbl
	genext2fs -d $(TEMP)/$(SUB)root -b $(FLOPPY_SIZE) -r 0 $(TEMP)/$(SUB)root.img
	$(e2fsck) $(TEMP)/$(SUB)root.img || true 
	$(if $(GZIPPED),gzip -v9f $(TEMP)/$(SUB)root.img)

.PHONY: bvme_arch_root
bvme_arch_root: FLOPPY_SIZE = 1440 
bvme_arch_root: SUB = bvme-
bvme_arch_root: arch_root2

TARGET = $(TEMP_INITRD) bvme_arch_root


#BOOT = $(SOME_DEST)/$(EXTRANAME)boot.img$(GZIPPED)
#FLOPPY_SIZE = 1440
#EXTRANAME
#VMEARCH
#TEMP_KERNEL
# floppy/
# 	atari-boot.img.gz
# 	atari-root.img.gz
# 	bvme6000-boot.img.gz
# 	bvme6000-root.img.gz
# 	mvm147-boot.img.gz
# 	mvm147-root.img.gz
# 	mvm16x-boot.img.gz
# 	mvm16x-root.img.gz

