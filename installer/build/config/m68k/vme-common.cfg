.PHONY: tftplilo.conf
tftplilo.conf: 
	mkdir -p $(SOME_DEST)
	cp boot/m68k/vme-tftplilo.conf $(SOME_DEST)/$@
	./update-manifest $(SOME_DEST)/$@ $(MANIFEST-CONFIG)

.PHONY: tftplilo.txt
tftplilo.txt: 
	mkdir -p $(SOME_DEST)
	cp boot/m68k/vme-tftplilo.txt $(SOME_DEST)/$@
	./update-manifest $(SOME_DEST)/$@ $(MANIFEST-DOCS)

.PHONY: tftplilo.bvme
tftplilo.bvme: /boot/tftplilo.bvme
	mkdir -p $(SOME_DEST)
	cp $< $(SOME_DEST)/$@
	./update-manifest $(SOME_DEST)/$@ $(MANIFEST-TFTP)

.PHONY: tftplilo.mvme
tftplilo.mvme: /boot/tftplilo.mvme
	mkdir -p $(SOME_DEST)
	cp $< $(SOME_DEST)/$@
	./update-manifest $(SOME_DEST)/$@ $(MANIFEST-TFTP)

.PHONY: arch_boot_screens
arch_boot_screens:

.PHONY: arch_root
arch_root: 
	mkdir -p $(TEMP)/root/etc
	cp $(TEMP_INITRD) $(TEMP)/root/root.bin
	./makelabel $(DISK_LABEL) $(BUILD_DATE) > $(TEMP)/root/disk.lbl
	genext2fs -d $(TEMP)/root -b $(FLOPPY_SIZE) -r 0 $(TEMP_ROOT)
	gzip -v9f $(TEMP_ROOT)

.PHONY: arch_boot
arch_boot: /proc/mounts
	mkdir -p $(TEMP)/boot/etc
	mkdir -p $(TEMP)/boot/boot
	cp boot/m68k/vme-vmelilo.conf-floppy $(TEMP)/boot/etc/vmelilo.conf
	cp $(shell echo $(TEMP_KERNEL) | cut -d' ' -f 1) $(TEMP)/boot/linux
	if [ "$(FLOPPY_SIZE)" = "2880" ]; then \
		cp $(TEMP_INITRD) $(TEMP)/boot/root.bin ; \
	fi ;
	./makelabel $(DISK_LABEL) $(BUILD_DATE) > $(TEMP)/boot/disk.lbl
	genext2fs -d $(TEMP)/boot -b $(FLOPPY_SIZE) -r 0 $(TEMP_BOOT)
	mkdir -p $(TEMP)/mount
	$(ROOTCMD) mount -t ext2 -o loop $(TEMP_BOOT) $(TEMP)/mount
	@echo loopdev $(shell grep $(TEMP)/mount /proc/mounts | cut -d' ' -f 1)
	if $(ROOTCMD) vmelilo -f -a $(VMEARCH) -b /dev/null -w $(TEMP)/mount -d $(shell grep $(TEMP)/mount /proc/mounts | cut -d' ' -f 1); then \
		$(ROOTCMD) umount $(TEMP)/mount ; \
		gzip -v9f $(TEMP_BOOT) ; \
	else \
		$(ROOTCMD) umount $(TEMP)/mount ; \
	fi ;

