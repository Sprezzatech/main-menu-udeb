MEDIUM_SUPPORTED = netboot
MEDIUM_SUPPORTED_EXTRA = monolithic

# The version of the kernel to use.
KERNELVERSION = 7.2-1-486
KERNELMAJOR = 7
KERNEL_FLAVOUR = di
KERNELNAME = kfreebsd.gz
KERNELIMAGEVERSION = $(KERNELVERSION)

DEBIAN_RELEASE = unstable
INITRD_FS = ufs1


grub_moddir=/usr/lib/grub/i386-pc

arch_boot_screens:
arch_tree:


# Miniature CD image using GRUB, with only an initrd, no udebs or debs.
.PHONY: arch_miniiso
arch_miniiso: $(TEMP_INITRD) $(TEMP_KERNEL) $(TREE)
	-rm -f $(TEMP_CD_TREE)/*
	mkdir -p $(TEMP_CD_TREE)/boot/kernel
	mkdir -p $(TEMP_CD_TREE)/boot/grub

	cp $(TEMP_KERNEL)			$(TEMP_CD_TREE)/boot/kernel/kernel.gz
	cp $(TEMP_INITRD)			$(TEMP_CD_TREE)/boot/mfsroot.gz
	cp $(TREE)/lib/modules/*/acpi.ko	$(TEMP_CD_TREE)/boot/kernel/

	cp boot/kfreebsd/grub.cfg		$(TEMP_CD_TREE)/boot/grub/

	grub-mkimage -o $(TEMP_CD_TREE)/boot/grub/core.img \
		biosdisk \
		minicmd normal sh echo \
		iso9660 \
		bsd chain \
		$(NULL)
	cat $(grub_moddir)/cdboot.img $(TEMP_CD_TREE)/boot/grub/core.img \
		> $(TEMP_CD_TREE)/boot/grub/grub_eltorito
	rm $(TEMP_CD_TREE)/boot/grub/core.img

	genisoimage -r -J -b boot/grub/grub_eltorito -c boot.cat -no-emul-boot \
		-boot-load-size 4 -boot-info-table \
		-o $(TEMP_MINIISO) $(TEMP_CD_TREE)


# Netboot files
.PHONY: arch_netboot_dir
arch_netboot_dir: 
	-rm -f $(TEMP_NETBOOT_DIR)
	mkdir -p $(TEMP_NETBOOT_DIR)/$(NETBOOT_PATH)
	cp $(TEMP_INITRD) $(TEMP_NETBOOT_DIR)/$(NETBOOT_PATH)
	cp $(TEMP_KERNEL) $(TEMP_NETBOOT_DIR)/$(NETBOOT_PATH)/linux
