MEDIUM_SUPPORTED = floppy cdrom netboot

KERNELVERSION = 2.4.25-powerpc-small
KERNEL_FLAVOUR = di
KERNELNAME = vmlinux
KERNELIMAGEVERSION = $(KERNELVERSION)

arch_boot:
	mkdir -p $(shell dirname $(TEMP_BOOT))
	dd if=/dev/zero of=$(TEMP_BOOT).new bs=1024 count=$(FLOPPY_SIZE)
	hformat -l $(DISK_LABEL) $(TEMP_BOOT).new
	gzip -vc9 $(TEMP_KERNEL) > $(TEMP_KERNEL).gz
	echo device $(TEMP_BOOT).new > $(TEMP)/miboot.conf
	echo kernel $(TEMP_KERNEL).gz $(KERNEL_CMDL) >> $(TEMP)/miboot.conf
	miboot -c $(TEMP)/miboot.conf
	mv $(TEMP_BOOT).new $(TEMP_BOOT)

arch_root:
	cp $(TEMP_INITRD) $(TEMP_ROOT)

arch_boot_screens:

# cd content for powerpc, includes yaboot for booting 
# apple powerpc (newworld) computers
cd_content: initrd
	mkdir -p $(CD_IMAGE_TREE)
	mkdir -p $(CD_IMAGE_TREE)/install/powermac

	$(foreach NAME,$(KERNELNAME), \
		cp -f $(TEMP)/$(NAME) $(CD_IMAGE_TREE)/install/powermac/$(TYPE)-linux; )

	cp -f $(INITRD) $(CD_IMAGE_TREE)/install/powermac

	# New-world bootability
	cp -f boot/powerpc/ofboot.b $(CD_IMAGE_TREE)/install/powermac
	cp -f /usr/lib/yaboot/yaboot $(CD_IMAGE_TREE)/install/powermac
	./bootscreen-subst "${MEDIA_TYPE}" "${DEBIAN_VERSION}" "${BUILD_DATE}" \
		< boot/powerpc/boot.msg > $(CD_IMAGE_TREE)/install/powermac/boot.msg
	cp -f boot/powerpc/$(TYPE)-yaboot.conf $(CD_IMAGE_TREE)/install/powermac/yaboot.conf

# creates a bootable cd image for powerpc
cd_image: cd_content
	mkisofs -r -T --netatalk -hfs -probe -map boot/powerpc/hfs.map -part -no-desktop -hfs-bless $(CD_IMAGE_TREE)/install/powermac -hfs-volid Debian-Installer/PPC -o $(DEST)/$(TYPE).iso $(CD_IMAGE_TREE)

arch_boot_screens:
