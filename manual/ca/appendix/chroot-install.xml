<!-- retain these comments for translator revision tracking -->
<!-- original version: 34713 -->

 <sect1 id="linux-upgrade">
 <title>Instal·lant &debian; des d'un sistema Unix/Linux</title>

<para>

Aquesta secció explica com instal·lar &debian; des d'un
Unix o Linux, sense utilitzar el sistema de menús de l'instal·lador com
s'explica a tot aquest manual. Aquest COM ES FA d'<quote>instal·lació
creuada</quote> l'han demanat usuaris de Red Hat, Mandrake i SuSE que
migren a &debian;. En aquesta secció es pressuposa una certa familiaritat
amb la introducció d'ordres *nix i la navegació pel sistema de fitxers.
En aquesta secció, <prompt>$</prompt> significa que l'ordre s'ha d'introduir
a sistema actual de l'usuari, i <prompt>#</prompt> significa que l'ordre
s'ha d'introduir al chroot de Debian.

</para><para>

Una vegada tingueu configurat el sistema Debian a la vostra mida,
podreu migrar totes les dades existents (si hi ha alguna) i continuar
treballant. Aquesta és per tant una instal·lació &debian; amb <quote>temps
de fora de servei zero</quote>. També és una manera intel·ligent de
treballar amb maquinari que d'altra manera no vol funcionar bé amb
diferents arrencades o mitjans d'instal·lació.

</para>

  <sect2>
  <title>Començant</title>
<para>

Amb les actuals eines *nix, es necessita reparticionar el disc,
creant al menys un sistema de fitxers i una partició d'intercanvi.
Necessitareu al menys 150 MiB d'espai per una instal·lació de consola,
o bé al menys 300 MiB si voleu instal·lar X.

</para><para>

Per exemple, per crear un sistema de fitxers ext3 a la partició
<filename>/dev/hda6</filename> (que és el nostre exemple per la
partició arrel):

<informalexample><screen>
# mke2fs -j /dev/hda6
</screen></informalexample>

Si voleu crear un sistema de fitxers ext2, ometeu <userinput>-j</userinput>.

</para><para>

Inicialitzeu i activeu l'intercanvi (substituïu el nombre de la partició per
la vostra partició d'intercanvi de Debian):

<informalexample><screen>
# mkswap /dev/hda5
# sync; sync; sync
# swapon /dev/hda5
</screen></informalexample>

Munteu la partició a <filename>/mnt/debinst</filename> (el lloc
d'instal·lació, per ser l'arrel (<filename>/</filename>) del sistema de
fitxers del nou sistema). El punt de muntatge és arbitrari, i se'n farà
ús desprès.

<informalexample><screen>
# mkdir /mnt/debinst
# mount /dev/hda6 /mnt/debinst
</screen></informalexample>

</para>
<note><para>

Si voleu tenir parts del vostre sistema de fitxers (p.ex. /usr) muntats
en particions separades, haureu de crear i muntar aquests directoris
manualment abans de procedir amb la següent fase.

</para></note>
  </sect2>

  <sect2>
  <title>Instal·lar <command>debootstrap</command></title>
<para>

L'eina que utilitza l'instal·lador de Debian, que és reconeguda
oficialment com la manera d'instal·lar un sistema base de Debian, és
<command>debootstrap</command>. Fa ús de <command>wget</command> i
<command>ar</command>, i per altra part tan sols depèn de
<classname>/bin/sh</classname> i eines Unix/Linux bàsiques<footnote>

<para>

Això inclou les utilitats base de GNU i ordres com
<command>sed</command>, <command>grep</command>, <command>tar</command>
i <command>gzip</command>.

</para>

</footnote>. Instal·leu <command>wget</command> i
<command>ar</command> si no hi són ara al vostre sistema, i descarregueu
i instal·leu <command>debootstrap</command>.

</para>

<!-- Els fitxers enllaçats aquí són del 2004 i per tant no usables
<para>

Si el vostre sistema està basat en rpm, podeu fer ús d'alien per convertir
el .deb a .rpm, o descarregar una versió en rpm des de
<ulink url="http://people.debian.org/~blade/install/debootstrap"></ulink>

</para>
-->

<para>

Podeu també utilitzar el procediment següent per fer la instal·lació
de forma manual. Creeu un directori de treball per extreure els .deb dins:

<informalexample><screen>
# mkdir work
# cd work
</screen></informalexample>

El binari de <command>debootstrap</command> el podeu trobar a l'arxiu de
Debian (assegureu-vos de seleccionar l'arxiu correcte per la vostra
arquitectura). Descarregueu el .deb <command>debootstrap</command> del
<ulink url="http://ftp.debian.org/debian/pool/main/d/debootstrap/">
repositori</ulink>, copieu el paquet al directori i extraieu els fitxers del
binari. Necessitareu tenir privilegis de root per instal·lar els binaris.

<informalexample><screen>
# ar -x debootstrap_0.X.X_arch.deb
# cd /
# zcat /full-path-to-work/work/data.tar.gz | tar xv
</screen></informalexample>

</para><para>

Tingueu en compte que executant <command>debootstrap</command> pot requerir
que tingueu una versió mínima de <classname>glibc</classname> instal·lada
(actualment GLIBC_2.3). <command>debootstrap</command> és un guió
d'intèrpret d'ordres, però crida diverses utilitats que requereixen
<classname>glibc</classname>.

</para>
  </sect2>

  <sect2>
  <title>Executar <command>debootstrap</command></title>
<para>

Podeu descarregar els fitxers que necessiteu del <command>debootstrap</command>
directament de l'arxiu quan l'executeu. Podeu substituir
<userinput>ftp.es.debian.org/debian</userinput> per qualsevol rèplica de
l'arxiu a l'ordre de l'exemple de baix, preferiblement per un que estigui
a prop vostre. Teniu una llista de less rèpliques a
<ulink url="http://www.debian.org/misc/README.mirrors"></ulink>.

</para><para>

Si teniu un CD de &debian; &releasename; muntat a
<filename>/cdrom</filename>, podeu substituir l'adreça del http per:
<userinput>file:/cdrom/debian/</userinput>

</para><para>

Substituïu una de les següents per <replaceable>ARCH</replaceable>
a l'ordre <command>debootstrap</command>:

<userinput>alpha</userinput>,
<userinput>arm</userinput>,
<userinput>hppa</userinput>,
<userinput>i386</userinput>,
<userinput>ia64</userinput>,
<userinput>m68k</userinput>,
<userinput>mips</userinput>,
<userinput>mipsel</userinput>,
<userinput>powerpc</userinput>,
<userinput>s390</userinput> o
<userinput>sparc</userinput>.

<informalexample><screen>
# /usr/sbin/debootstrap --arch ARCH &releasename; \
     /mnt/debinst http://ftp.es.debian.org/debian
</screen></informalexample>

</para>
  </sect2>

  <sect2>
  <title>Configurar el sistema base</title>
<para>

Ara ja teniu un sistema Debian real al disc, això si, molt petit.
Feu <command>chroot</command>:

<informalexample><screen>
# LANG= chroot /mnt/debinst /bin/bash
</screen></informalexample>

</para>

   <sect3>
   <title>Muntatge de les particions</title>
<para>

Necessitareu crear el fitxer <filename>/etc/fstab</filename>.

<informalexample><screen>
# editor /etc/fstab
</screen></informalexample>

Aquest és un exemple que podeu modificar per que s'ajuste a los vostres
necessitats:

<informalexample><screen>
# /etc/fstab: informació estàtica del sistema de fitxers.
#
# s. fitxers    punt muntatge  tipus   opcions                  dump passades
/dev/XXX         /             ext3    defaults                 0    1
/dev/XXX         /boot         ext3    ro,nosuid,nodev          0    2

/dev/XXX         none          swap    sw                       0    0
proc             /proc         proc    defaults                 0    0

/dev/fd0         /mnt/floppy   auto    noauto,rw,sync,user,exec 0    0
/dev/cdrom       /mnt/cdrom    iso9660 noauto,ro,user,exec      0    0

/dev/XXX         /tmp          ext3    rw,nosuid,nodev          0    2
/dev/XXX         /var          ext3    rw,nosuid,nodev          0    2
/dev/XXX         /usr          ext3    rw,nodev                 0    2
/dev/XXX         /home         ext3    rw,nosuid,nodev          0    2
</screen></informalexample>

Utilitzeu <userinput>mount -a</userinput> per muntar tot el sistema de
fitxers que heu especificat al vostre <filename>/etc/fstab</filename>,
o bé munteu cada sistema de fitxers de forma individual:

<informalexample><screen>
# mount /path   # e.g.: mount /usr
</screen></informalexample>

Podeu muntar el sistema de fitxers proc varies vegades i a llocs arbitraris,
però s'espera tenir el <filename>/proc</filename>. Si no utilitzeu
<userinput>mount -a</userinput>, assegureu-vos de muntar proc abans
de continuar:

<informalexample><screen>
# mount -t proc proc /proc
</screen></informalexample>

</para><para>

L'ordre <userinput>ls /proc</userinput> ha de mostrar ara un directori
no buit. Si això fallés, podeu provar de muntar proc des de fora
del chroot:

<informalexample><screen>
# mount -t proc proc /mnt/debinst/proc
</screen></informalexample>

</para>
   </sect3>

   <sect3>
   <title>Configurar el teclat</title>
<para>

Per configurar el vostre teclat:

<informalexample><screen>
# dpkg-reconfigure console-data
</screen></informalexample>

</para><para>

Tingueu en compte que no es pot establir el teclat mentre esteu dins
del chroot, però serà configurat per al següent reinici.

</para>
   </sect3>

   <sect3>
   <title>Configurar la xarxa</title>
<para>

Per configurar la xarxa, editeu
<filename>/etc/network/interfaces</filename>,
<filename>/etc/resolv.conf</filename> i
<filename>/etc/hostname</filename>.

<informalexample><screen>
# editor /etc/network/interfaces
</screen></informalexample>

Ací teniu alguns exemples senzills de
<filename>/usr/share/doc/ifupdown/examples</filename>:

<informalexample><screen>
######################################################################
# /etc/network/interfaces -- fitxer de configuració per ifup(8), ifdown(8)
# Llegiu la pàgina del manual de interfaces(5) per veure quines
# opcions teniu al vostre abast.
######################################################################

# Sempre voldrem l'interfície loopback
#
auto lo
iface lo inet loopback

# Per utilitzar dhcp:
#
# auto eth0
# iface eth0 inet dhcp

# Un exemple de configuració amb IP estàtica (broadcast i gateway són
# opcionals):
#
# auto eth0
# iface eth0 inet static
#     address 192.168.0.42
#     network 192.168.0.0
#     netmask 255.255.255.0
#     broadcast 192.168.0.255
#     gateway 192.168.0.1
</screen></informalexample>

Introduïu el nom del(s) vostre(s) servidor(s) de noms a
<filename>/etc/resolv.conf</filename>:

<informalexample><screen>
# editor /etc/resolv.conf
</screen></informalexample>

Un exemple senzill de <filename>/etc/resolv.conf</filename>:

<informalexample><screen>
search hqdom.local\000
nameserver 10.1.1.36
nameserver 192.168.9.100
</screen></informalexample>

Introduïu el nom del vostre sistema (de 2 a 63 caràcters):

<informalexample><screen>
# echo DebianHostName &gt; /etc/hostname
</screen></informalexample>

Si teniu vàries targes de xarxa, ordeneu els noms dels mòduls dels
controladors al fitxer <filename>/etc/modules</filename> amb l'ordre desitjat.
A l'arrencada, cada targeta s'associarà amb el nom de l'interfície 
(eth0, eth1, etc.) que esperàveu.

</para>
   </sect3>

   <sect3>
   <title>Configurar locals</title>
<para>

Per configurar els vostres paràmetres locals per utilitzar un idioma
que no sigui l'anglès, instal·leu el paquet per suportar els locals i
configureu-lo:

<informalexample><screen>
# apt-get install locales
# dpkg-reconfigure locales
</screen></informalexample>

AVÍS: L'apt s'ha de configurar abans, creant un sources.list i executant
apt-get update.
Abans d'utilitzar locals amb altres conjunts de caràcters diferents de
ASCII o latin1, consulteu el COM ES FA de localització apropiat.

</para>
   </sect3>
  </sect2>

  <sect2>
  <title>Instal·lar un nucli</title>
<para>

Si intenteu arrencar aquest sistema, probablement voldreu un nucli Linux i
una carregador d'arrencada. Identifiqueu si hi ha algun nucli
pre-empaquetat amb

<informalexample><screen>
# apt-cache search kernel-image
</screen></informalexample>

Aleshores instal·leu la vostra elecció utilitzant el nom del paquet.

<informalexample><screen>
# apt-get install kernel-image-<replaceable>2.X.X-arch-etc</replaceable>
</screen></informalexample>

</para>
  </sect2>

  <sect2>
<title>Configurant el carregador d'arrencada</title>
<para>

Per fer que el vostre sistema &debian; es pugui arrencar, configureu el
vostre carregador d'arrencada per que carregui el nucli instal·lat a la
vostra nova partició arrel. Adoneu-vos que el debootstrap no instal·la un
carregador d'arrencada, encara que podeu utilitzar l'apt-get dins del
vostre chroot per fer-ho.

</para><para arch="i386">

Comproveu l'informació de <userinput>info grub</userinput> o <userinput>man
lilo.conf</userinput> per com configurar el carregador d'arrencada. Si el
vostre sistema era ja Debian, afegiu una entrada per la instal·lació al
vostre fitxer existent <filename>menu.lst</filename> o
<filename>lilo.conf</filename>. Pel <filename>lilo.conf</filename>,
podeu copiar-lo al nou sistema i editar-lo allí. Després de editar-lo,
executeu lilo (recordeu que utilitzarà el <filename>lilo.conf</filename>
relatiu al sistema des d'on el crideu).

</para><para arch="i386">

Ací teniu un exemple bàsic de <filename>/etc/lilo.conf</filename>:

<informalexample><screen>
boot=/dev/hda6
root=/dev/hda6
install=menu
delay=20
lba32
image=/vmlinuz
label=Debian
</screen></informalexample>

</para><para arch="powerpc">

Llegiu <userinput>man yaboot.conf</userinput> per tenir més informació de
com configurar el carregador d'arrencada. Si esteu a un sistema on
prèviament teníeu ja instal·lat Debian, copieu el vostre fitxer ja existent
<filename>yaboot.conf</filename>. Podeu copiar-lo al nou sistema i
editar-lo allí. Desprès d'editar-lo, executeu ybin (recordeu que utilitzarà
el <filename>yaboot.conf</filename> relatiu al sistema des d'on l'executeu).

</para><para arch="powerpc">

Un exemple bàsic de <filename>/etc/yaboot.conf</filename> podria ser:

<informalexample><screen>
boot=/dev/hda2
device=hd:
partition=6
root=/dev/hda6
magicboot=/usr/lib/yaboot/ofboot
timeout=50
image=/vmlinux
label=Debian
</screen></informalexample>

A algunes màquines, podríeu necessitar utilitzar <userinput>ide0:</userinput>
en comptes de <userinput>hd:</userinput>.

</para>
  </sect2>
 </sect1>
