<?xml version="1.0" encoding="UTF-8"?>
<!-- original version: 64829 -->
<!-- revisado jfs, 21 noviembre 2004 -->
<!-- revisado rudy, 24 feb. 2005 -->
<!-- actualizado jfs, 23 marzo 2006 -->
<!-- actualizado jfs, enero 2007 -->
<!-- actualizado igortamara, nov 17 2008 -->
<!-- revisado jfs, nov 24 2008 -->
<!-- revisado elric, 10 Agosto 2010 -->

 <sect1 id="linux-upgrade">
 <title>Instalar &debian-gnu; desde un sistema Unix/Linux</title>

<para>

Esta sección explica cómo instalar &debian-gnu; desde un sistema Unix o
Linux existente, sin usar el instalador basado en menús,
como se explica en el resto de este manual. Los usuarios que se
cambian a &debian-gnu; desde Red Hat, Mandrake y SuSE han solicitado este
CÓMO de <quote>instalación cruzada</quote>. En esta sección se asume alguna
familiaridad con la introducción de órdenes en *nix y navegación en el
sistema de ficheros. En esta sección <prompt>$</prompt> simboliza una
orden a introducirse en el sistema actual del usuario, mientras que
<prompt>#</prompt> se refiere a una orden introducida en la jaula
(<quote>chroot</quote>, N. del t.) de Debian.

</para><para>

Una vez que tenga el nuevo sistema Debian configurado a su preferencia,
puede migrar los datos existentes de sus usuarios (si fuese el caso) a
éste y continuar funcionando. Esto es por tanto una instalación
<quote>sin parada</quote> de &debian-gnu;. Es también una forma inteligente de
tratar con hardware que no puede utilizarse de forma sencilla con
los distintos mecanismos de instalación o arranque disponibles.

</para>

<note><para>

Dado que este proceso es, en gran parte, manual ha de tener en cuenta que
tendrá que hacer gran parte de la configuración básica del sistema por su cuenta.
Para poder hacer esto necesitará más conocimientos de Debian y en general de &arch-kernel;
que si fuera a hacer una instalación normal. No espere que el resultado de este procedimiento
sea un sistema idéntico al que uno obtendría si realizara la instalación normalmente.
También debería tener en cuenta que este procedimiento solamente describe los pasos
básicos para configurar un sistema. Es posible que puedan tener que realizarse
pasos adicionales en la instalación y/o configuración.

</para></note>

  <sect2>
  <title>Primeros pasos</title>
<para>

Reparticione el disco duro como desee
con las herramientas de particionado de *nix que disponga,
debe crear por lo menos un sistema de
ficheros más una partición de intercambio. Necesita
por lo menos 350 MB de espacio disponible para una instalación de
consola o por lo menos 1 GB si va a instalar el entorno X (más si
quiere instalar entornos de escritorio como GNOME o KDE).

</para><para>

A continuación, deberá crear sistemas de ficheros en sus particiones. Por ejemplo,
para crear un sistema de ficheros ext3 en la partición
<filename>/dev/hda6</filename> (es nuestra partición raíz de ejemplo):

<informalexample><screen>
# mke2fs -j /dev/<replaceable>hda6</replaceable>
</screen></informalexample>

En cambio para crear un sistema de ficheros ext2, omita <userinput>-j</userinput>.

</para><para>

Inicialice y active la partición de intercambio (sustituya el número de
partición por la partición de intercambio de Debian que vaya a utilizar):

<informalexample><screen>
# mkswap /dev/<replaceable>hda5</replaceable>
# sync; sync; sync
# swapon /dev/<replaceable>hda5</replaceable>
</screen></informalexample>

Monte una partición como <filename>/mnt/debinst</filename> (el punto
de instalación, que será el sistema de ficheros raíz
(<filename>/</filename>) en su nuevo sistema). El nombre del punto de
montaje es estrictamente arbitrario, pero se utilizará este mismo
nombre más adelante.

<informalexample><screen>
# mkdir /mnt/debinst
# mount /dev/<replaceable>hda6</replaceable> /mnt/debinst
</screen></informalexample>

</para>
<note><para>

Deberá crear y montar manualmente los directorios que sean necesarios antes de
continuar con la siguiente parte del proceso si desea montar partes del sistema
de ficheros (como por ejemplo <quote>/usr</quote>)
en particiones distintas.

</para></note>
  </sect2>

  <sect2>
  <title>Instalar <command>debootstrap</command></title>
<para>

<command>debootstrap</command> es la herramienta que usa el instalador
de Debian, es también la forma oficial de instalar un sistema base
Debian. Éste usa <command>wget</command> y <command>ar</command>,
pero, salvo esto, sólo
depende de <classname>/bin/sh</classname> y algunas herramientas básicas
de Unix/Linux<footnote>

<para>
Esto incluye las utilidades principales de GNU y órdenes como
<command>sed</command>,
<command>grep</command>, <command>tar</command> y <command>gzip</command>.

</para>

</footnote>. Si aún no lo ha hecho,
instale <command>wget</command> y <command>ar</command>
en su sistema actual, y luego
descargue e instale <command>debootstrap</command>.

</para>

<!-- The files linked to here are from 2004 and thus currently not usable
<para>

Si tiene un sistema basado en rpm, puede usar alien para
convertir el .deb en .rpm, o descargar una versión adaptada a rpm de
<ulink url="http://people.debian.org/~blade/install/debootstrap"></ulink>

</para>
-->

<para>

Por otra parte, puede usar el siguiente procedimiento para instalarlo manualmente.
Cree un directorio temporal <quote>trabajo</quote> para extraer el fichero «.deb» en él:

<informalexample><screen>
# mkdir trabajo
# cd trabajo
</screen></informalexample>

El binario de <command>debootstrap</command> se encuentra en el archivo de
Debian (asegúrese de elegir el fichero adecuado para su arquitectura).
Descargue el paquete de <command>debootstrap</command> desde el almacén
de paquetes en
<ulink url="http://ftp.debian.org/debian/pool/main/d/debootstrap/"></ulink>,
copie el paquete al directorio <quote>trabajo</quote> y extraiga los
ficheros de éste. Necesitará privilegios de superusuario para
instalar los ficheros.

<informalexample><screen>
# ar -x debootstrap_0.X.X_all.deb
# cd /
# zcat /ruta-completa-hasta-trabajo/trabajo/data.tar.gz | tar xv
</screen></informalexample>

</para>
  </sect2>

  <sect2>
  <title>Ejecutar <command>debootstrap</command></title>
<para>

<command>debootstrap</command> descargará los ficheros necesarios
directamente desde el archivo cuando lo ejecute. Puede sustituir
<userinput>&archive-mirror;/debian</userinput> por cualquier servidor de réplica
del archivo Debian, en la orden de ejemplo que se muestra a continuación.
Es mejor que utilice un servidor de réplica cercano (es decir, en una red próxima).
Puede encontrar una lista completa de los servidores de réplica en:
<ulink url="http://www.debian.org/mirror/list"></ulink>.

</para><para>

Puede utilizar una dirección de fichero si tiene un CD de la versión
&releasename; de &debian-gnu; montado en <filename>/cdrom</filename>. Para
ello utilice, en lugar de la dirección http,
<userinput>file:/cdrom/debian/</userinput>.

</para><para>

Sustituya <replaceable>ARQ</replaceable> por alguno de los valores
mostrados a continuación en la orden <command>debootstrap</command> en
función de su arquitectura:

<userinput>alpha</userinput>,
<userinput>amd64</userinput>,
<userinput>arm</userinput>,
<userinput>armel</userinput>,
<userinput>hppa</userinput>,
<userinput>i386</userinput>,
<userinput>ia64</userinput>,
<userinput>m68k</userinput>,
<userinput>mips</userinput>,
<userinput>mipsel</userinput>,
<userinput>powerpc</userinput>,
<userinput>s390</userinput> o
<userinput>sparc</userinput>.

<informalexample><screen>
# /usr/sbin/debootstrap --arch ARQ &releasename; \
     /mnt/debinst http://ftp.us.debian.org/debian
</screen></informalexample>

</para>
  </sect2>

  <sect2>
  <title>Configurar el sistema base</title>
<para>

Ahora tiene instalado un sistema Debian, aunque algo limitado, en
su disco. Ejecute la orden <command>chroot</command> en él:

<informalexample><screen>
# LANG=C chroot /mnt/debinst /bin/bash
</screen></informalexample>

Después de haaber hecho esto puede que necesite establecer una
definición de terminal compatible con el sistema base de Debian. Por
ejemplo:

<informalexample><screen>
# export TERM=<replaceable>xterm-color</replaceable>
</screen></informalexample>

</para>

   <sect3>
   <title>Crear ficheros de dispositivos</title>
<para>

Llegados a este punto el directorio <filename>/dev/</filename> contiene solamente ficheros
de dispositivo muy básicos. Es posible que necesite ficheros de dispositivo adicionales
para llevar a cabo los pasos siguientes de la instalación. Hay varias formas
de hacerlo y el método que vaya a usar dependerá del sistema inicial que esté
usando para la instalación; si desea usar un núcleo modular o no, si
pretende usar ficheros de dispositivo dinámicos (p.ej. con
<classname>udev</classname>) o estáticos en el sistema nuevo.

</para><para>

Algunas de las opciones disponibles son las siguientes:

<itemizedlist>
<listitem><para>

cree un conjunto predeterminado de ficheros de dispositivo estáticos con
<informalexample><screen>
# cd /dev
# MAKEDEV generic
</screen></informalexample>

</para></listitem>
<listitem><para>

cree manualmente sólo ficheros de dispositivos específicos con
<command>MAKEDEV</command>

</para></listitem>
<listitem><para>

Monte <filename>/dev</filename> del sistema original encima del directorio <filename>/dev</filename>
del sistema objetivo utilizando un enlace de montaje («bind mount», N. del T.)
Ha de tener en cuenta que los programas de postinstalación de algunos paquetes
pueden tratar de crear ficheros de dispositivo. Utilice esta opción con precaución.

</para></listitem>
</itemizedlist>

</para>
   </sect3>

   <sect3>
   <title>Montar particiones</title>
<para>

Necesita crear <filename>/etc/fstab</filename>.

<informalexample><screen>
# editor /etc/fstab
</screen></informalexample>

Este es un ejemplo que puede modificar según sus necesidades:

<informalexample><screen>
# /etc/fstab: información estática del sistema de ficheros.
#
# file system    mount point   type    options                  dump pass
/dev/XXX         /             ext3    defaults                 0    1
/dev/XXX         /boot         ext3    ro,nosuid,nodev          0    2

/dev/XXX         none          swap    sw                       0    0
proc             /proc         proc    defaults                 0    0

/dev/fd0         /media/floppy auto    noauto,rw,sync,user,exec 0    0
/dev/cdrom       /media/cdrom  iso9660 noauto,ro,user,exec      0    0

/dev/XXX         /tmp          ext3    rw,nosuid,nodev          0    2
/dev/XXX         /var          ext3    rw,nosuid,nodev          0    2
/dev/XXX         /usr          ext3    rw,nodev                 0    2
/dev/XXX         /home         ext3    rw,nosuid,nodev          0    2
</screen></informalexample>

Utilice <userinput>mount -a</userinput> para montar todos los sistemas de
ficheros que ha especificado en <filename>/etc/fstab</filename> o
móntelos individualmente usando:

<informalexample><screen>
# mount /ruta  # por ej.:  mount /usr
</screen></informalexample>

Los sistemas Debian actuales tienen puntos de montaje para medios
extraíbles bajo <filename>/media</filename>, pero mantienen enlaces
simbólicos por compatibilidad en 
<filename>/</filename>. Cree esto si los necesita, como por ejemplo:

<informalexample><screen>
# cd /media
# mkdir cdrom0
# ln -s cdrom0 cdrom
# cd /
# ln -s media/cdrom
</screen></informalexample>

Puede montar el sistema de ficheros <quote>proc</quote> tantas veces como quiera y
en cualquier ubicación, aunque la ubicación habitual es <filename>/proc</filename>.
Asegúrese de montar proc antes de continuar si no usa <userinput>mount
-a</userinput>:


<informalexample><screen>
# mount -t proc proc /proc
</screen></informalexample>

</para><para>

Si ejecuta la orden <userinput>ls /proc</userinput> debería ver que el directorio
no está vacío. Si esto falla, puede intentar montar <quote>proc</quote> fuera
del entorno chroot:

<informalexample><screen>
# mount -t proc proc /mnt/debinst/proc
</screen></informalexample>

</para>
   </sect3>

   <sect3>
   <title>Configurar la zona horaria</title>
 <para>
 
Una opción en el archivo <filename>/etc/default/rcS</filename>
determina si el sistema interpreta el reloj de hardware como UTC o
como hora local. La siguiente orden le permite configurar esto y
elegir su zona horaria.
 
 <informalexample><screen>
# editor /etc/default/rcS
# dpkg-reconfigure tzdata
 </screen></informalexample>

</para>
   </sect3>

   <sect3>
   <title>Configurar la red</title>
<para>

Para configurar la red, edite
<filename>/etc/network/interfaces</filename>,
<filename>/etc/resolv.conf</filename>,
<filename>/etc/hostname</filename> y
<filename>/etc/hosts</filename>.

<informalexample><screen>
# editor /etc/network/interfaces
</screen></informalexample>

Aquí hay algunos ejemplos sencillos que podrá encontrar en
<filename>/usr/share/doc/ifupdown/examples</filename>:

<informalexample><screen>
######################################################################
# /etc/network/interfaces -- fichero de configuración para ifup(8), ifdown(8)
# Lea la página de manual de interfaces(5) para información sobre las
# opciones disponibles.
######################################################################

# Siempre necesitamos la interfaz loopback.
#
auto lo
iface lo inet loopback

# Para usar dhcp:
#
# auto eth0
# iface eth0 inet dhcp

# Un ejemplo de configuración de IP estática: (el broadcast y pasarela son
# opcionales)
#
# auto eth0
# iface eth0 inet static
#     address 192.168.0.42
#     network 192.168.0.0
#     netmask 255.255.255.0
#     broadcast 192.168.0.255
#     gateway 192.168.0.1
</screen></informalexample>

Introduzca su servidor o servidores de nombres así como las
directivas de búsqueda en
<filename>/etc/resolv.conf</filename>:

<informalexample><screen>
# editor /etc/resolv.conf
</screen></informalexample>

Un <filename>/etc/resolv.conf</filename> sencillo de ejemplo sería:

<informalexample><screen>
search hqdom.local
nameserver 10.1.1.36
nameserver 192.168.9.100
</screen></informalexample>

Escriba el nombre de máquina de su sistema (de 2 a 63 caracteres):

<informalexample><screen>
# echo MaquinaDebian &gt; /etc/hostname
</screen></informalexample>

Y una <filename>/etc/hosts</filename> básico con soporte IPv6 sería:

<informalexample><screen>
127.0.0.1 localhost 
127.0.0.1 MaquinaDebian

# Las siguientes líneas son recomendables en equipos que pueden
# utilizar IPv6
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
ff02::3 ip6-allhosts
</screen></informalexample>

Si tiene múltiples tarjetas de red, debe añadir los nombres de los
módulos de controlador en el fichero <filename>/etc/modules</filename>
en el orden que desee. Luego durante el arranque, cada tarjeta será
asociada con el nombre de la interfaz (eth0, eth1, etc.) que haya indicado.

</para>
   </sect3>

   <sect3>
   <title>Configurar Apt</title>
 <para>
 
Debootstrap habrá creado un 
<filename>/etc/apt/sources.list</filename> muy básico que le permite
instalar paquetes adicioanles. Seguramente querrá, sin embargo, tener
algunas fuentes adicionales para poder acceder a paquetes fuente y a
actualizaciones de seguridad:

<informalexample><screen>
deb-src http://ftp.us.debian.org/debian &releasename; main

deb http://security.debian.org/ &releasename;/updates main
deb-src http://security.debian.org/ &releasename;/updates main
</screen></informalexample>

Asegúrese de ejecutar <userinput>aptitude update</userinput> después
de hacer cambios a la lista de fuentes.

</para>
   </sect3>

   <sect3>
   <title>Configurar la localización y el teclado</title>
<para>


Instale el paquete de soporte de localización
<classname>locales</classname> y configúrelo para poder definir los
valores de localización para usar un idioma diferente al
inglés. Actualmente se recomienda utilizar locales codificados en UTF-8.

<informalexample><screen>
# aptitude install locales
# dpkg-reconfigure locales
</screen></informalexample>

Para configurar su teclado (si lo necesita):
 
<informalexample><screen>
# aptitude install console-data
# dpkg-reconfigure console-data
</screen></informalexample>

</para><para>

Tenga en cuenta que no puede configurar el teclado mientras esté dentro del
chroot, pero se configurará en el siguiente reinicio.

</para>
   </sect3>
  </sect2>

  <sect2>
  <title>Instalar un núcleo</title>
<para>

Si intenta arrancar este sistema, probablemente querrá un núcleo &arch-kernel;
y un gestor de arranque. Identifique los núcleos previamente empaquetados
disponibles con:

<informalexample><screen>
# apt-cache search &kernelpackage;
</screen></informalexample>

</para><para>

Si va a utilizar un núcleo pre-empaquetado puede querer crear su
propio fichero de configuración
<filename>/etc/kernel-img.conf</filename> antes de hacerlo. Aquí tiene
un fichero de ejemplo:

<informalexample><screen>
# Kernel image management overrides
# See kernel-img.conf(5) for details
do_symlinks = yes
relative_links = yes
do_bootloader = yes
do_bootfloppy = no
do_initrd = yes
link_in_boot = no
</screen></informalexample>

</para><para>

Consulte su página de manual si quiere información detallada de este
fichero y de las distintas opciones. La página de manual estará
disponible una vez instale el paquete
<classname>kernel-package</classname>. Le recomendamos que revise si
los valores son correctos para su sistema.

</para><para>

Después instale el paquete del núcleo que elija utilizando el nombre
del paquete.

<informalexample><screen>
# aptitude install &kernelpackage;-<replaceable>&kernelversion;-arch-etc</replaceable>
</screen></informalexample>

Se le harán algunas preguntas referidas a
<filename>/etc/kernel-img.conf</filename> durante la instalación si no
creó ese fichero antes de instalar un núcleo pre-empaquetado.


</para>
  </sect2>

  <sect2>
<title>Configurar el gestor de arranque</title>
<para>

Para poder arrancar su sistema &debian-gnu; deberá configurar su gestor de
arranque para cargar el núcleo instalado en su nueva partición
raíz. Tenga en cuenta que <command>debootstrap</command> no instala un
gestor de arranque, pero puede usar <command>aptitude</command> dentro
de su jaula Debian para hacer esto.

</para><para arch="any-x86">

Use <userinput>info grub</userinput> <phrase arch="x86">o <userinput>man
lilo.conf</userinput></phrase> para leer las instrucciones sobre cómo
configurar el gestor de arranque. Si desea mantener el sistema que
utilizó para instalar Debian, simplemente añada una entrada para la
instalación de Debian en el fichero <filename>menu.lst</filename><phrase arch="x86">o
<filename>lilo.conf</filename> actual. También podría copiar <filename>lilo.conf</filename> al
nuevo sistema y editarlo allí. Ejecute <command>lilo</command> una vez termine de editar
el fichero (recuerde que éste usará el <filename>lilo.conf</filename>
relativo al sistema desde el cual lo ejecute)</phrase>.

</para><para arch="any-x86">

La instalación y configuración de <classname>grub</classname> es tan
sencilla como hacer:

<informalexample><screen>
# aptitude install grub
# grub-install /dev/<replaceable>hda</replaceable>
# update-grub
</screen></informalexample>

La segunda orden instalará <command>grub</command> (en este caso en el
sector de arranque de <literal>hda</literal>). La última orden creará un
<filename>/boot/grub/menu.lst</filename> funcional.

</para><para>

Estos ejemplos asumen que se ha creado el fichero de dispositivo
<filename>/dev/hda</filename>. Existen métodos alternativos para 
instalar <command>grub</command>,
pero están fuera del alcance de este apéndice.

</para><para arch="x86">

Aquí tiene un ejemplo básico de /etc/lilo.conf:

<informalexample><screen>
boot=/dev/<replaceable>hda6</replaceable>
root=/dev/<replaceable>hda6</replaceable>
install=menu
delay=20
lba32
image=/vmlinuz
initrd=/initrd.img
label=Debian
</screen></informalexample>

</para><para arch="any-x86">

Puede hacer algunos cambios a
<filename>/etc/kernel-img.conf</filename> dependiendo del cargador de
arranque que haya instalado.

</para><para arch="any-x86">

Debería fijar la opción <literal>do_bootloader</literal> a
<quote>no</quote> en el caso de que tenga el cargador de arranque
<classname>grub</classname>. Para actualizar automáticamente su
<filename>/boot/grub/menu.lst</filename> cuando se instalen o eliminen
núcleos de Debian debe añadir las siguientes líneas:

<informalexample><screen>
postinst_hook = update-grub
postrm_hook   = update-grub
</screen></informalexample>

<phrase arch="x86">El valor de la opción <literal>do_bootloader</literal> debe estar
definido como <quote>yes</quote> en el caso del cargador de arranque
<classname>lilo</classname>.</phrase>

</para><para arch="powerpc">

Puede consultar <userinput>man yaboot.conf</userinput> para obtener
más información sobre la configuración del gestor de arranque.  Si
desea mantener el sistema que utilizó para instalar Debian,
simplemente añada una entrada para la instalación de Debian al fichero
<filename>yaboot.conf</filename> existente.  También podrá copiarlo al
nuevo sistema y editarlo allí. Ejecute ybin después de que finalice la
edición (recuerde que éste usará el <filename>yaboot.conf</filename>
relativo al sistema desde el cual lo ejecute).

</para><para arch="powerpc">

Aquí tiene un ejemplo básico de <filename>/etc/yaboot.conf</filename>:

<informalexample><screen>
boot=/dev/hda2
device=hd:
partition=6
root=/dev/hda6
magicboot=/usr/lib/yaboot/ofboot
timeout=50
image=/vmlinux
label=Debian
</screen></informalexample>

Puede que tenga que utilizar <userinput>ide0:</userinput>
en algunas máquinas
en lugar de <userinput>hd:</userinput>.

</para>
  </sect2>

  <sect2>
<title>Toques finales</title>
<para>

El sistema instalado, como se ha mencionado previamente, será muy
básico. Si quiere que su sistema sea un poco más maduro puede hacerlo fácilmente
instalando todos los paquetes de prioridad <quote>standard</quote>:

<informalexample><screen>
# tasksel install standard
</screen></informalexample>

Por supuesto, también puede utilizar <command>aptitude</command> para
instalar individualmente todos los paquetes.

</para><para>

Después de la instalación habrá muchos paquetes descargados en
<filename>/var/cache/apt/archives/</filename>. Puede liberar algo de
espacio de disco ejecutando:

<informalexample><screen>
# aptitude clean
</screen></informalexample>

</para>
  </sect2>

 </sect1>
