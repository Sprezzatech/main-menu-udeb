<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- original version: 39614 -->
<!-- revisado por nahoo, 1 noviembre 2004 -->
<!-- revisado rudy, 24 feb. 2005 -->

 <sect1 condition="supports-tftp" id="install-tftp">
 <title>Preparación de los ficheros para el arranque a través de red usando TFTP</title>
<para>

Si su máquina está conectada a una red de área local, podría tener la
posibilidad de arrancarla a través de la red desde otra máquina, usando
TFTP. Si pretende arrancar el sistema de instalación desde otra máquina,
debe ubicar los ficheros de arranque necesarios en lugares específicos
en esa máquina, y debe configurarla para soportar el arranque desde ella.

</para><para>

Necesita configurar un servidor TFTP, y en caso de que tenga varias máquinas, un
servidor BOOTP
<phrase condition="supports-rarp">, o un servidor RARP</phrase>
<phrase condition="supports-dhcp">, o un servidor DHCP</phrase>.

</para><para>

<phrase condition="supports-rarp">El protocolo de resolución reversa de
dirección (RARP) es una forma de decirle al cliente que dirección IP
debe usar. Otra forma es usar el protocolo BOOTP. </phrase>

<phrase condition="supports-bootp">BOOTP es un protocolo IP que informa al
ordenador de su dirección IP y desde dónde puede obtener una imagen de arranque
en la red.</phrase>

<phrase arch="m68k">Existe otra alternativa más en los sistemas VMEbus:
Se puede configurar manualemnte la dirección IP en la ROM de arranque.
</phrase>

<phrase condition="supports-dhcp">El DHCP (Protocolo de configuración dinámica
de sistema) es una extensión de BOOTP compatible con éste, pero más flexible.
Algunos sistemas solamente se pueden configurar a través de DHCP. </phrase>

</para><para arch="powerpc">

Para PowerPC, si tiene una máquina Power Macintosh NewWorld, es una
buena idea utilizar DHCP en lugar de BOOTP. Algunos de los modelos más
recientes solamente pueden arrancar usando BOOTP.

</para><para arch="alpha">

A diferencia del «Open Firmware» encontrado en máquinas Sparc y PowerPC,
la consola SRM <emphasis>no</emphasis> usará RARP para obtener su
dirección IP, y por consiguiente deberá usar BOOTP para el arranque
a través de red en su sistema Alpha<footnote>

<para>

Los sistemas Alpha también se pueden arrancar usando DECNet MOP
(Protocolo de operaciones de mantenimiento), pero esto no se detalla
aquí. Presumiblemente, su operador de OpenVMS local estará gustoso de
asistirlo, deberá tener alguna razón de peso si quiere usar MOP para
arrancar Linux en su Alpha.
</para>
</footnote>. También puede ingresar la configuración de las interfaces
de red directamente en la consola SRM.

</para><para arch="hppa">

Algunas máquinas HPPA antiguas (como 715/75) usan RBOOTD en lugar de
BOOTP. Existe un paquete llamado <classname>rbootd</classname> disponible
en Debian.

</para><para>

El protocolo de transferencia trivial de ficheros (TFTP) se usa para
servir la imagen de arranque al cliente. Teóricamente, se puede
usar cualquier servidor, en cualquier plataforma, que implemente este
protocolo. En los ejemplos de esta sección, mostraremos órdenes para
SunOS 4.x, SunOS 5.x (conocido también como Solaris) y GNU/Linux.

<note arch="x86"><para>

Para usar el método de arranque de TFTP llamado
«Pre-boot Execution Environment» (PXE) tiene que utilizar un servidor
de TFTP con soporte de <userinput>tsize</userinput>. En el caso de que
esté utilizando un servidor &debian; los paquetes
<classname>atftpd</classname> y
<classname>tftpd-hpa</classname> ofrecen dicho soporte; le recomendamos
que utilice <classname>tftpd-hpa</classname>.

</para></note>

</para>

&tftp-rarp.xml;
&tftp-bootp.xml;
&tftp-dhcp.xml;

  <sect2 id="tftpd">
  <title>Habilitar el servidor TFTP</title>
<para>

Para tener listo el servidor TFTP, primero deberá asegurarse de que
<command>tftpd</command> está habilitado. Generalmente se hace
añadiendo a <filename>/etc/inetd.conf</filename> algo
similar a lo siguiente:

<informalexample><screen>
tftp dgram udp wait nobody /usr/sbin/tcpd in.tftpd /tftpboot
</screen></informalexample>

Cuando se instalan los paquetes de Debian, por lo general, lo configuran
correctamente de forma predeterminada.

</para><para>

Busque en ese fichero y recuerde el directorio que usa como
argumento de <command>in.tftpd</command>; lo necesitará mas
adelante. El argumento <userinput>-l</userinput> hace que algunas
versiones de <command>in.tftpd</command> registren todas las peticiones en los
registros del sistema; es útil para diagnosticar fallos de arranque. Si
ha tenido que cambiar <filename>/etc/inetd.conf</filename>, deberá
notificar al proceso <command>inetd</command> en ejecución que el
fichero ha cambiado. En un sistema Debian, ejecute
<userinput>/etc/init.d/inetd reload</userinput>; en otros sistemas,
busque el ID del proceso <command>inetd</command>, y ejecute
<userinput>kill -HUP <replaceable>id-de-inetd</replaceable></userinput>.

</para><para arch="mips">

Si pretende instalar Debian en una máquina SGI y su servidor TFTP es una máquina
GNU/Linux ejecutando Linux 2.4 necesitará configurar en su servidor lo siguiente:

<informalexample><screen>
# echo 1 &gt; /proc/sys/net/ipv4/ip_no_pmtu_disc
</screen></informalexample>

para desactivar el descubrimiento de ruta MTU, de otro modo el PROM
de Indy no podrá descargar el núcleo. Adicionalmente, asegúrese de que los
paquetes de TFTP se envían desde un puerto origen inferior al 32767,
o la descarga se interrumpirá después del primer paquete. Nuevamente, es Linux
2.4.x el que presenta este fallo en la PROM, y puede evitarlo configurando

<informalexample><screen>
# echo "2048 32767" &gt; /proc/sys/net/ipv4/ip_local_port_range
</screen></informalexample>

para ajustar el rango de puertos origen que usa el servidor TFTP.

</para>
  </sect2>

  <sect2 id="tftp-images">
  <title>Mover las imágenes TFTP a su ubicación</title>
<para>

Seguidamente, ubique la imagen TFTP de arranque que necesita, como se
describe en la <xref linkend="where-files"/>, en el directorio de
imagen de arranque de <command>tftpd</command>. Generalmente, este
directorio será <filename>/tftpboot</filename>. Tendrá que hacer un
enlace desde este fichero hacia el fichero que usará
<command>tftpd</command> para arrancar un cliente en específico.
Desafortunadamente, el nombre del fichero es determinado por el
cliente TFTP, y no existe un estándar definido.

</para><para arch="powerpc">

En máquinas Power Macintosh NewWorld, necesitará configurar
el gestor de arranque <command>yaboot</command> como la imagen de
arranque de TFTP. Entonces <command>yaboot</command> obtendrá las
imágenes del núcleo y del disco RAM a través del propio TFTP. Para el
arranque a través de red, use <filename>yaboot-netboot.conf</filename>.
Simplemente renómbrelo a <filename>yaboot.conf</filename> en el
directorio de TFTP.

</para><para arch="x86">

Para arranque PXE, todo lo que necesitará es colocar el fichero tar
<filename>netboot/netboot.tar.gz</filename>. Simplemente
extraiga este fichero tar en el directorio de imágenes de arranque de
<command>tftpd</command>. Asegúrese de que su servidor DHCP está configurado
para pasar <filename>/pxelinux.0</filename> a <command>tftpd</command> como
el nombre del fichero a arrancar.

</para><para arch="ia64">

Para arranque PXE, todo lo que necesitará es colocar el fichero tar
<filename>netboot/netboot.tar.gz</filename>. Simplemente
extraiga este fichero tar en el directorio de imágenes de arranque de
<command>tftpd</command>.
Asegúrese de que su servidor DHCP está configurado para pasar
<filename>/debian-installer/ia64/elilo.efi</filename> a
<command>tftpd</command> como el nombre del fichero a arrancar.

</para>

   <sect3 arch="mipsel">
   <title>Imágenes TFTP para DECstation</title>
<para>

Para DECstations existen ficheros «tftpimage» para cada subarquitectura
que contienen tanto el núcleo como el instalador en un solo fichero. Por convención
los nombres son del tipo
<filename><replaceable>subarquitectura</replaceable>/netboot-boot.img</filename>.
Copie el fichero «tftpimage» que desee usar a
<userinput>/tftpboot/tftpboot.img</userinput> si está usando la configuración
BOOTP/DHCP de ejemplo descrita anteriormente.

</para><para>

El firmware de DECstations se arranca por TFTP con la orden
<userinput>boot <replaceable>#</replaceable>/tftp</userinput>, donde
<replaceable>#</replaceable> es el número del dispositivo TurboChannel
desde el cual arrancar. En la mayoría de DECstations es «3». Si el servidor
BOOTP/DHCP no provee el nombre del fichero o necesita pasar parámetros adicionales,
estos se pueden añadir opcionalmente con la siguiente sintaxis:

</para><para>

<userinput>boot #/tftp/fichero param1=valor1 param2=valor2 ...</userinput>

</para><para>

Varias revisiones del firmware de DECstations presentan un problema
respecto al arranque a través de red: la transferencia se inicia, pero después
de algún tiempo se para mostranto el mensaje <computeroutput>a.out err</computeroutput>.
Esto puede deberse a diversas razones:

<orderedlist>
<listitem><para>

El firmware no responde a solicitudes ARP durante una transferencia
TFTP. Esto lleva a que expire el tiempo máximo de ARP y a la paralización de la
transferencia. La solución es añadir la dirección MAC de la tarjeta
Ethernet de la DECstation estáticamente a la tabla ARP del servidor
TFTP. Esto se hace ejecutando
<userinput>arp -s
<replaceable>Dirección IP</replaceable>
<replaceable>Dirección MAC</replaceable></userinput>
como superusuario en la máquina que actúe como servidor TFTP. La dirección
MAC de la DECstation puede obtenerse con la orden
<command>cnfg</command> en el cursor del firmware de la DECstation.

</para></listitem>
<listitem><para>

El firmware tiene un límite de tamaño para los ficheros que pueden
arrancarse a través de TFTP.

</para></listitem>
</orderedlist>

También existen revisiones de firmware que no pueden arrancar
en absoluto a través de TFTP. Puede encontrar una descripción sobre las
diferentes revisiones de firmware en las páginas web de NetBSD:
<ulink url="http://www.netbsd.org/Ports/pmax/board-list.html#proms"></ulink>.

</para>
   </sect3>

   <sect3 arch="alpha">
   <title>Arranque de TFTP en Alpha</title>
<para>
En Alpha, debe especificar el nombre del fichero (como una ruta relativa
al directorio de imagen de arranque) usando el argumento
<userinput>-file</userinput> a la orden <userinput>boot</userinput> de SRM,
o definiendo la variable de entorno <userinput>BOOT_FILE</userinput>.
Alternativamente, se puede dar el nombre del fichero a través de BOOTP
(en la versión de <command>dhcpd</command> de ISC,
use la directiva <userinput>filename</userinput>). A diferencia de
«Open Firmware», en SRM <emphasis>no existe ningún nombre de fichero
predeterminado</emphasis>, de modo que <emphasis>debe</emphasis> especificar
un nombre de fichero por cualquiera de estos métodos.

</para>
   </sect3>

   <sect3 arch="sparc">
   <title>Arranque de TFTP en SPARC</title>
<para>

Algunas arquitecturas SPARC añaden los nombres de las subarquitecturas,
como «SUN4M» o «SUN4C» al fichero. Esto es, si la subarquitectura
de su sistema es «SUN4C» y su IP es 192.168.1.3, el nombre del fichero será
<filename>C0A80103.SUN4C</filename>. Hay algunas arquitecturas para las que el
cliente busca simplemente el fichero
<filename>ip-del-cliente-en-hex</filename>. Una forma sencilla de determinar
el código hexadecimal del cliente es usar la siguiente orden en un línea de
órdenes (asumiendo que la IP sea 10.0.0.4).

<informalexample><screen>
$ printf '%.2x%.2x%.2x%.2x\n' 10 0 0 4
</screen></informalexample>

Esto mostrará la IP en hexadecimal, para obtener el nombre correcto, necesita
cambiar todas las letras a mayúsculas y añadir, si es necesario, el nombre de la
subarquitectura.

</para><para>

También puede forzar algunos sistemas sparc para buscar un fichero
en específico al añadirlo al final de la orden boot de OpenPROM, como
<userinput>boot net mi-imagen.sparc</userinput>. Éste deberá
encontrarse en el directorio en el que busca el servidor TFTP.

</para>
   </sect3>

   <sect3 arch="m68k">
   <title>Arranque TFTP de BVM/Motorola</title>
<para>

Para sistemas BVM y Motorola VMEbus copie los ficheros
&bvme6000-tftp-files; a <filename>/tftpboot/</filename>.

</para><para>

Seguidamente, configure sus ROMs de arranque o servidor BOOTP para cargar
inicialmente los ficheros <filename>tftplilo.bvme</filename> o
<filename>tftplilo.mvme</filename> desde el servidor TFTP. Véase el fichero
<filename>tftplilo.txt</filename> para información adicional sobre
configuraciones específicas para su subarquitectura.

</para>
   </sect3>

   <sect3 arch="mips">
   <title>Arranque TFTP en SGI</title>
<para>

En Indys SGI puede confiar en la orden <command>bootpd</command> para proveer
el nombre del fichero TFTP. Éste se señala o bien como
<userinput>bf=</userinput> en <filename>/etc/bootptab</filename> o como
la opción <userinput>filename=</userinput> en
<filename>/etc/dhcpd.conf</filename>.

</para>
   </sect3>

   <sect3 arch="mips">
   <title>Arranque TFTP en Broadcom BCM91250A y BCM91480B</title>
<para>

No necesita configurar DHCP de forma especial debido a
que pasará la ruta completa del fichero a cargar en el «CFE».

</para>
   </sect3>

  </sect2>

<!-- FIXME: commented out since it seems too old to be usable and a current
            way is not known

  <sect2 id="tftp-low-memory">
  <title>Instalación TFTP para sistemas con poca memoria</title>
<para>

En algunos sistemas, la instalación estándar de disco RAM, combinada
con los requisitos de memoria de la imagen de arranque TFTP, no
caben en memoria. En este caso, todavía puede instalar usando TFTP,
simplemente tendrá que realizar pasos adicionales para montar mediante NFS su
directorio raíz a través de la red. Este tipo de configuración
también es apropiada para clientes sin disco o sin datos.

</para><para>

Primero, siga todos los pasos descritos anteriormente en
<xref linkend="install-tftp"/>.

<orderedlist>
<listitem><para>

Copie la imagen del núcleo Linux en su servidor TFTP usando la
imagen <userinput>a.out</userinput> para la arquitectura que
esté arrancando.

</para></listitem>
<listitem><para>

Desempaquete el fichero raíz en su servidor NFS (puede ser el mismo
sistema en el que reside su servidor TFTP):

<informalexample><screen>
# cd /tftpboot
# tar xvzf root.tar.gz
</screen></informalexample>

Asegúrese de usar GNU <command>tar</command> (otros programas, como el de
SunOS, tratan, erróneamente, a los dispositivos como ficheros normales).

</para></listitem>
<listitem><para>

Exporte su directorio <filename>/tftpboot/debian-sparc-root</filename>
con acceso de superusuario a su cliente. p. ej. añada la siguiente
línea a <filename>/etc/exports</filename> (sintaxis de GNU/Linux,
debería ser similar para SunOS):

<informalexample><screen>
/tftpboot/debian-sparc-root <replaceable>cliente</replaceable>(rw,no_root_squash)
</screen></informalexample>

NOTA: <replaceable>cliente</replaceable> es el nombre de máquina
o dirección IP reconocida por
el servidor, para el sistema que esté arrancando.

</para></listitem>
<listitem><para>

Cree un enlace simbólico para la dirección IP de su cliente en notación
punteada a <filename>debian-sparc-root</filename> en el directorio
<filename>/tftpboot</filename>. Por ejemplo, si la dirección IP del
cliente es 192.168.1.3, efectúe

<informalexample><screen>
# ln -s debian-sparc-root 192.168.1.3
</screen></informalexample>

</para></listitem>
</orderedlist>

</para>

  </sect2>

  <sect2 condition="supports-nfsroot">
  <title>Instalación con TFTP y raíz NFS</title>
<para>

Instalar con TFTP y raíz NFS es similar a
<xref linkend="tftp-low-memory"/> debido a que no desea cargar el
disco RAM, pero sí arrancar desde el nuevo sistema de ficheros raíz NFS
creado. Luego necesitará reemplazar el enlace simbólico de la imagen
«tftpboot» por un enlace simbólico a la imagen del núcleo (por ejemplo,
<filename>linux-a.out</filename>).

</para><para>

RARP/TFTP requiere que todos los demonios se ejecuten en el mismo servidor
(la estación de trabajo envía una solicitud TFTP al servidor que respondió
a su solicitud RARP anterior).

</para>


  </sect2>
END FIXME -->
 </sect1>
