<?xml version="1.0" encoding="ISO-8859-2"?>
<!-- $Id$ -->
<!-- original version: 33719 -->

 <sect1 id="linux-upgrade">
 <title>Instalace Debianu ze stávajícího unixového/linuxového systému</title>

<para>

Tato kapitola se, na rozdíl od zbytku pøíruèky, nezabývá oficiálním
instalaèním programem, ale popisuje instalaci Debianu ze stávajícího
unixového nebo linuxového systému. Tuto kapitolu si vy¾ádali u¾ivatelé
pøecházející z distribucí Red Hat, Mandrake a SUSE. Pøedpokládáme zde
jisté znalosti s pou¾íváním *nixových pøíkazù a pohybem v souborovém
systému. V této sekci platí, ¾e pøíkazy uvozené promptem
<prompt>$</prompt> zadáváte ve svém stávajícím systému, zatímco
pøíkazy uvozené <prompt>#</prompt> se spou¹tí v
<firstterm>chroot</firstterm>ovaném prostøedí.

</para><para>

A¾ si Debian vyladíte k obrazu svému, mù¾ete do nìj pøevést stávající
u¾ivatelská data a plynule pøejít k nové distribuci bez zbyteèných
prostojù. Tento druh instalace je té¾ vhodný pro systémy s podivným
hardwarem, který jinak není podporován instalaèními médii.

</para>

  <sect2>
  <title>Pøípravné práce</title>
<para>

Nejprve si rozdìlte disk. Budete potøebovat aspoò jeden oddíl
(koøenový) plus oblast pro virtuální pamì» (swap). Pro èistì
konzolovou instalaci potøebujete oblast velkou minimálnì 150 MB,
jestli¾e budete instalovat i X Window System, poèítejte s nejménì
300 megabajty.

</para><para>

Na nových oddílech vytvoøte souborové systémy. Napøíklad souborový
systém ext3 na oblasti <filename>/dev/hda6</filename> vytvoøíte
pøíkazem:

<informalexample><screen>
<prompt>#</prompt> <userinput>mke2fs -j /dev/hda6</userinput>
</screen></informalexample>

(Ve zbytku návodu budeme pøedpokládat, ¾e koøenový oddíl je
<filename>/dev/hda6</filename>.)
Jestli¾e chcete vytvoøit systém ext2, vynechejte parametr
<userinput>-j</userinput>.

</para><para>

Inicializujte a aktivujte odkládací oddíl (nezapomeòte zmìnit èíslo
oblasti podle skuteènosti):

<informalexample><screen>
<prompt>#</prompt> <userinput>mkswap /dev/hda5</userinput>
<prompt>#</prompt> <userinput>sync; sync; sync</userinput>
<prompt>#</prompt> <userinput>swapon /dev/hda5</userinput>
</screen></informalexample>

Pøipojte budoucí koøenovou oblast (<filename>/</filename>) do adresáøe
<filename>/mnt/debinst</filename>. Na jménì pøípojného adresáøe
nezále¾í.

<informalexample><screen>
<prompt>#</prompt> <userinput>mkdir /mnt/debinst</userinput>
<prompt>#</prompt> <userinput>mount /dev/hda6 /mnt/debinst</userinput>
</screen></informalexample>

</para><note><para>

Chcete-li mít èásti souborového systému (napø. /usr) pøipojené na
rùzných oblastech, musíte tyto adresáøe vytvoøit a pøipojit ruènì
je¹tì pøed pøí¹tí kapitolou.

</para></note>
  </sect2>

  <sect2>
  <title>Instalace balíku <command>debootstrap</command></title>
<para>

<command>debootstrap</command> je program, kterým se v Debianu
instaluje základní systém. Má minimum závislostí (pouze
<classname>/bin/sh</classname>, <command>ar</command>
a <command>wget</command>), tak¾e se dá pou¾ít na témìø libovolném
systému. Pokud je¹tì <command>wget</command> a <command>ar</command>
nemáte, nainstalujte si je.

</para><para>

Na systému pou¾ívajícím RPM balíèky si mù¾ete sta¾ený
<filename>.deb</filename> soubor pøevést do formátu
<filename>.rpm</filename> programem <command>alien</command>, nebo
mù¾ete pou¾ít pøipravený balík z
<ulink url="http://people.debian.org/~blade/install/debootstrap"></ulink>.

</para><para>

Poslední mo¾ností je ruèní instalace. Vytvoøte si pracovní adresáø, do
kterého pozdìji balík rozbalíte:

<informalexample><screen>
<prompt>#</prompt> <userinput>mkdir work</userinput>
<prompt>#</prompt> <userinput>cd work</userinput>
</screen></informalexample>

Z <ulink url="http://ftp.debian.org/debian/pool/main/d/debootstrap/">
poolu</ulink> si stáhnìte balík <command>debootstrap</command> pro
svou architekturu, ulo¾te jej do pracovního adresáøe a vybalte z nìj
binární soubory. K instalaci souborù musíte mít rootovská práva.

<informalexample><screen>
<prompt>#</prompt> <userinput>ar -x debootstrap_0.X.X_arch.deb</userinput>
<prompt>#</prompt> <userinput>cd /</userinput>
<prompt>#</prompt> <userinput>zcat /cesta-k-pracovnimu-adresari/work/data.tar.gz | tar xv</userinput>
</screen></informalexample>

</para><para>

Pro bìh <command>debootstrap</command>u musíte mít nainstalovanou
rozumnou minimální verzi knihovny <classname>glibc</classname>
(momentálnì GLIBC_2.3). <command>debootstrap</command> samotný je
shellový skript, ale vyu¾ívá rùzné nástroje, které vy¾adují
<classname>glibc</classname>.

</para>
  </sect2>

  <sect2>
  <title>Spu¹tìní <command>debootstrap</command>u</title>
<para>

<command>debootstrap</command> si umí stáhnout potøebné soubory pøímo
z debianího archivu. Aby se soubory nestahovaly pøes pùl Zemìkoule,
nahraïte v ukázce server
<userinput>http.us.debian.org/debian</userinput> nìjakým bli¾¹ím.
Seznam zrcadel naleznete v
<ulink url="http://www.debian.org/misc/README.mirrors"></ulink>.

</para><para>

Pokud máte první oficiální CD, mù¾ete jej pøipojit jako
<filename>/cdrom</filename> a místo sí»ové adresy pou¾ít odkaz na
soubor: <userinput>file:/cdrom/debian/</userinput>.

</para><para>

V ukázkovém pøíkazu <command>debootstrap</command> nahraïte
<replaceable>ARCH</replaceable> jedním z následujících:

<userinput>alpha</userinput>,
<userinput>arm</userinput>,
<userinput>hppa</userinput>,
<userinput>i386</userinput>,
<userinput>ia64</userinput>,
<userinput>m68k</userinput>,
<userinput>mips</userinput>,
<userinput>mipsel</userinput>,
<userinput>powerpc</userinput>,
<userinput>s390</userinput> nebo
<userinput>sparc</userinput>.

<informalexample><screen>
<prompt>#</prompt> <userinput>/usr/sbin/debootstrap --arch <replaceable>ARCH</replaceable> &releasename; \
     /mnt/debinst http://http.us.debian.org/debian</userinput>
</screen></informalexample>

</para>
  </sect2>


  <sect2>
  <title>Nastavení základního systému</title>

<para>

V adresáøi <filename>/mnt/debinst</filename> teï máte opravdový, i
kdy¾ minimální, systém Debian. Nastal èas se do nìj pøesunout:

<informalexample><screen>
<prompt>#</prompt> <userinput>LANG=C chroot /mnt/debinst /bin/bash</userinput>
</screen></informalexample>

</para>

   <sect3>
   <title>Pøipojení oblastí</title>
<para>

Nejprve musíte vytvoøit soubor <filename>/etc/fstab</filename>.

<informalexample><screen>
<prompt>#</prompt> <userinput>editor /etc/fstab</userinput>
</screen></informalexample>

Jako vzor mù¾ete pou¾ít následující ¹ablonu (místo
<replaceable>XXX</replaceable> dosaïte vlastní oblasti):

<informalexample><screen>
# /etc/fstab: static file system information.
#
# file system    mount point   type    options                  dump pass
/dev/XXX         /             ext3    defaults                 0    1
/dev/XXX         /boot         ext3    ro,nosuid,nodev          0    2

/dev/XXX         none          swap    sw                       0    0
proc             /proc         proc    defaults                 0    0

/dev/fd0         /mnt/floppy   auto    noauto,rw,sync,user,exec 0    0
/dev/cdrom       /mnt/cdrom    iso9660 noauto,ro,user,exec      0    0

/dev/XXX         /tmp          ext3    rw,nosuid,nodev          0    2
/dev/XXX         /var          ext3    rw,nosuid,nodev          0    2
/dev/XXX         /usr          ext3    rw,nodev                 0    2
/dev/XXX         /home         ext3    rw,nosuid,nodev          0    2
</screen></informalexample>

Souborové systémy, které jste zadali do
<filename>/etc/fstab</filename> mù¾ete pøipojit v¹echny najednou
pøíkazem <userinput>mount -a</userinput>, nebo individuálnì pøíkazem:

<informalexample><screen>
<prompt>#</prompt> <userinput>mount /cesta</userinput> # napø.:  mount /usr
</screen></informalexample>

Pøed dal¹í prací si ovìøte, ¾e máte pøipojený virtuální souborový
systém <filename>/proc</filename>. Pokud tomu tak není, pøipojte jej:

<informalexample><screen>
<prompt>#</prompt> <userinput>mount -t proc proc /proc</userinput>
</screen></informalexample>

</para><para>

Príkaz <userinput>ls /proc</userinput> by nyní mìll vypsat neprázdný
adresáø. Pokud by se tak nestalo, stále byste mìli být schopni
pøipojit <filename>proc</filename> z vnìj¹ku chrootu:

<informalexample><screen>
<prompt>#</prompt> <userinput>mount -t proc proc /mnt/debinst/proc</userinput>
</screen></informalexample>

</para>
   </sect3>

   <sect3>
   <title>Nastavení klávesnice</title>
<para>

Klávesnici nastavíte:

<informalexample><screen>
<prompt>#</prompt> <userinput>dpkg-reconfigure console-data</userinput>
</screen></informalexample>

</para><para>

Klávesnici nemù¾ete v chrootu nastavit, zmìna se projeví a¾ po pøí¹tím
restartu.

</para>
   </sect3>

   <sect3>
   <title>Nastavení sítì</title>
<para>

Sí»ování se nastavuje v souborech
<filename>/etc/network/interfaces</filename>,
<filename>/etc/resolv.conf</filename> a
<filename>/etc/hostname</filename>.

<informalexample><screen>
<prompt>#</prompt> <userinput>editor /etc/network/interfaces</userinput>
</screen></informalexample>

Pro zaèátek vám mohou pomoci ukázky z
<filename>/usr/share/doc/ifupdown/examples</filename>:

<informalexample><screen>
######################################################################
# /etc/network/interfaces -- configuration file for ifup(8), ifdown(8)
# See the interfaces(5) manpage for information on what options are
# available.
######################################################################

# Virtuální loopback chceme v¾dy.
#
auto lo
iface lo inet loopback

# Pou¾ití dhcp:
#
# auto eth0
# iface eth0 inet dhcp

# Statická IP adresa: (broadcast a gateway jsou volitelné)
#
# auto eth0
# iface eth0 inet static
#     address 192.168.0.42
#     network 192.168.0.0
#     netmask 255.255.255.0
#     broadcast 192.168.0.255
#     gateway 192.168.0.1
</screen></informalexample>

Do <filename>/etc/resolv.conf</filename> zadejte nastavení jmenných
serverù (DNS):

<informalexample><screen>
<prompt>#</prompt> <userinput>editor /etc/resolv.conf</userinput>
</screen></informalexample>

</para><para>

Jednoduchý <filename>/etc/resolv.conf</filename>:

<informalexample><screen>
search hqdom.local\000
nameserver 10.1.1.36
nameserver 192.168.9.100
</screen></informalexample>

Zadejte název svého systému (délka aspoò 2 a nejvý¹e 63 znaky):

<informalexample><screen>
<prompt>#</prompt> <userinput>echo JmenoPocitace &gt; /etc/hostname</userinput>
</screen></informalexample>

Jestli¾e máte více sí»ových karet, mìli byste si pohrát s názvy modulù
v <filename>/etc/modules</filename>, aby se karty v¾dy pøiøadily ke
stejnému rozhraní (eth0, eth1, atd.)

</para>
   </sect3>

   <sect3>
   <title>Nastavení Locales</title>
<para>

Aby se s vámi systém bavil v jiném jazyce ne¾ je angliètina, musíte
nainstalovat a nastavit balík pro podporu národních prostøedí:

<informalexample><screen>
<prompt>#</prompt> <userinput>apt-get install locales</userinput>
<prompt>#</prompt> <userinput>dpkg-reconfigure locales</userinput>
</screen></informalexample>

POZNÁMKA: Pøed tímto krokem ji¾ musíte mít nastavený systém pro správu
balíèkù &mdash; apt. Také nebude od vìci nastudovat si odpovídající
dokumenty HOWTO.

</para>
   </sect3>
  </sect2>

  <sect2>
  <title>Instalace jádra</title>
<para>

Jestli¾e budete chtít tento systém i zavádìt (na 99% ano), musíte si
nainstalovat jádro (a mo¾ná zavadìè). Následujícím pøíkazem zjistíte
dostupná pøipravená jádra:

<informalexample><screen>
<prompt>#</prompt> <userinput>apt-cache search kernel-image</userinput>
</screen></informalexample>

Vybrané jádro nainstalujte:

<informalexample><screen>
<prompt>#</prompt> <userinput>apt-get install kernel-image-2.X.X-arch-atd</userinput>
</screen></informalexample>

</para>
  </sect2>

  <sect2>
<title>Nastavení zavadìèe</title>
<para>

Abyste mohli zavádìt svùj Debian, nastavte v zavadìèi, aby nahrál
instalované jádro s novou koøenovou oblastí. Pamatujte, ¾e debootstrap
zavadìè neinstaluje, tak¾e jej budete muset doinstalovat zvlá¹»
(napø. pomocí apt-get uvnitø chrootovaného prostøedí).

</para><para arch="i386">

Návod k nastavení zavadìèe prozradí pøíkaz <userinput>info
grub</userinput> nebo <userinput>man lilo.conf</userinput>. Pokud si
ponecháte pùvodní operaèní systém, staèí do stávajícího <filename>grub
menu.lst</filename> nebo <filename>lilo.conf</filename> pøidat
pøíslu¹nou polo¾ku. <filename>lilo.conf</filename> si také mù¾ete
zkopírovat do nového systému, zde ho upravit a spustit
<command>lilo</command> (pou¾ije konfiguraèní soubor systému, ze
kterého jej spou¹títe).

</para><para arch="i386">

Pro inspiraci nabízíme minimální <filename>/etc/lilo.conf</filename>:

<informalexample><screen>
boot=/dev/hda6
root=/dev/hda6
install=menu
delay=20
lba32
image=/vmlinuz
label=Debian
</screen></informalexample>

</para><para arch="powerpc">

Návod k nastavení zavadìèe prozradí pøíkaz <userinput>man
yaboot.conf</userinput>. Pokud si ponecháte pùvodní operaèní systém,
staèí do stávajícího <filename>yaboot.conf</filename> pøidat
pøíslu¹nou polo¾ku. Tento soubor si také mù¾ete zkopírovat do nového
systému, zde ho upravit a spustit <command>ybin</command> (pou¾ije
konfiguraèní soubor systému, ze kterého jej spou¹títe).

</para><para arch="powerpc">

Pro inspiraci nabízíme minimální <filename>/etc/yaboot.conf</filename>:

<informalexample><screen>
boot=/dev/hda2
device=hd:
partition=6
root=/dev/hda6
magicboot=/usr/lib/yaboot/ofboot
timeout=50
image=/vmlinux
label=Debian
</screen></informalexample>

Na nìkterých poèítaèích musíte místo <userinput>hd:</userinput> pou¾ít
<userinput>ide0:</userinput>.

</para>
  </sect2>
 </sect1>
