<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- original version: 44002 -->

 <sect1 condition="supports-tftp" id="install-tftp">
 <title>Préparer les fichiers pour amorcer depuis le réseau avec TFTP</title>
<para>

Si votre machine est connectée à un réseau local, vous pouvez l'amorcer 
directement à partir d'une autre machine de ce réseau en utilisant 
TFTP. Pour cela, les fichiers d'amorçage doivent être 
placés à un endroit spécifique de cette machine et celle-ci doit savoir 
amorcer votre machine.

</para><para>

Vous devez configurer un serveur TFTP et, pour beaucoup de machines, 
un serveur DHCP<phrase condition="supports-rarp">, un serveur RARP</phrase>
<phrase condition="supports-bootp">ou un serveur BOOTP</phrase>.

</para><para>

<phrase condition="supports-rarp">Le protocole de recherche des adresses 
inverses (<emphasis>Reverse address Resolution Protocol</emphasis> ou RARP)
est une solution pour indiquer à votre client l'adresse IP qu'il doit 
utiliser pour lui-même. Une autre solution est d'utiliser le protocole BOOTP.
</phrase>

<phrase condition="supports-bootp">BOOTP est un protocole IP qui indique à un 
ordinateur quelle est son adresse IP et lui dit où obtenir sur le réseau une 
image d'amorçage.</phrase>

<phrase arch="m68k">Il existe désormais une autre solution pour les systèmes
VMEbus&nbsp;: l'adresse IP peut être configurée manuellement dans la ROM 
d'amorçage.</phrase>

Le protocole DHCP 
(«&nbsp;Dynamic Host Configuration Protocole&nbsp;», Protocole de 
configuration dynamique des hôtes) est une extension bien plus flexible 
de BOOTP (et respectant la compatibilité ascendante). Certains systèmes ne 
peuvent être configurés que par DHCP.

</para><para arch="powerpc">

Pour les PowerPC, si vous avez une machine Power Macintosh NewWorld, il vaut 
mieux utiliser DHCP plutôt que BOOTP. Certaines machines récentes ne peuvent pas 
s'amorcer avec BOOTP.

</para><para arch="alpha"> 

À la différence du microprogramme Open Firmware que l'on trouve sur les 
machines SPARC et PowerPC, la console SRM n'utilisera 
<emphasis>pas</emphasis> RARP pour obtenir les adresses IP&nbsp;; vous devrez 
donc utiliser BOOTP pour amorcer votre Alpha <footnote>

<para>
Les systèmes Alpha peuvent aussi s'amorcer depuis le réseau en utilisant 
MOP DECNet («&nbsp;Maintenance Operations Protocol&nbsp;», protocole des 
opérations de maintenance), mais l'on n'en dira rien ici. Il est 
vraisemblable que votre opérateur local OpenVMS sera ravi de vous assister si
vous ne pouvez résister à l'envie d'utiliser MOP pour amorcer Linux sur votre 
Alpha.
</para>

</footnote> depuis le réseau. Vous pouvez aussi entrer directement depuis la console VRM 
la configuration IP des interfaces réseau.
</para><para arch="hppa"> 

Quelques vieilles machines HPPA (p. ex. 715/75) utilisent RBOOTD plutôt que 
BOOTP. Un paquet <classname>rbootd</classname> est disponible dans l'archive Debian.

</para><para>

Le protocole trivial de transfert de fichiers (<emphasis>Trivial File Transfert
Protocol, TFTP</emphasis>) est utilisé pour transférer l'image d'amorçage 
au client. Théoriquement, tout serveur sur les plateformes qui
implémentent ces protocoles peut être utilisé. Dans les exemples qui vont 
suivre, on donnera les commandes pour SunOS 4.x, SunOS 5.x (mieux connu sous 
le nom de Solaris) et GNU/Linux.

<note arch="x86"><para>

Pour utiliser la méthode de démarrage par l'exécution d'un environnement de
pré-amorçage (PXE) de TFTP, vous avez besoin d'un serveur TFTP avec
<userinput>tsize</userinput>. Sur un serveur &debian;, les paquets
<classname>atftpd</classname> et <classname>tftpd-hpa</classname> 
sont bons&nbsp;; nous vous conseillons <classname>tftpd-hpa</classname>.

</para></note>

</para>

&tftp-rarp.xml;
&tftp-bootp.xml;
&tftp-dhcp.xml;

  <sect2 id="tftpd">
  <title>Activer le serveur TFTP</title>
<para>

Pour faire fonctionner le serveur TFTP, vous devez vous assurer au préalable 
que <command>tftpd</command> est activé. Ce dernier est généralement activé 
grâce à la ligne suivante dans <filename>/etc/inetd.conf</filename>&nbsp;:

<informalexample><screen>
tftp dgram udp wait root /usr/sbin/tcpd in.tftpd /tftpboot
</screen></informalexample>

Les paquets Debian, quand ils sont installés, placent correctement cette
ligne.
</para>

<note><para>
Les serveurs TFTP utilisaient habituellement le répertoire <filename>/tftpboot</filename> pour
stocker les images. Cependant les paquets &debian; se servent d'autres répertoires
pour obéir au <ulink url="&url-fhs-home;">standard sur l'organisation des fichiers</ulink>.
Par exemple, <classname>tftpd-hpa</classname> utilise par défaut
<filename>/var/lib/tftpboot</filename>. Vous aurez à modifier les exemples de cette section.
</para></note>

<para> 

Lisez le fichier <filename>/etc/inetd.conf</filename> et mémorisez le répertoire
passé en paramètre à <command>in.tftpd</command>
<footnote>
<para>
L'option <userinput>-l</userinput> autorise certaines versions de 
<command>in.tftpd</command> à enregistrer toutes les requêtes dans le journal 
du système&nbsp;; c'est extrêmement pratique en cas d'erreur d'amorçage.
</para>
</footnote>&nbsp;; vous en aurez besoin ultérieurement. 
Si vous avez dû modifier <filename>/etc/inetd.conf</filename>, vous devrez le 
signaler au processus <command>inetd</command>. Sur une machine Debian,
lancez <userinput>/etc/init.d/inetd reload</userinput>&nbsp;; sur les autres 
machines, retrouvez le numéro de processus de <command>inetd</command> et 
exécutez la commande 
<userinput>kill -HUP <replaceable>inetd-pid</replaceable></userinput>.

</para><para arch="mips">

Si vous voulez installer Debian sur une machine SGI et si votre serveur TFTP 
est une machine GNU/Linux avec Linux 2.4.X, il vous faudra effectuer la 
man&oelig;uvre suivante sur votre serveur&nbsp;:

<informalexample><screen>
# echo 1 &gt; /proc/sys/net/ipv4/ip_no_pmtu_disc
</screen></informalexample>

de façon à empêcher la détection du MTU, sinon la PROM de la machine SGI ne pourra 
pas télécharger le nouveau noyau. En outre, assurez-vous que les paquets TFTP 
transitent par un port source inférieur à 32767 ou bien le téléchargement 
s'arrêtera après le premier paquet. Vous pouvez toujours contourner ce
bogue de la PROM grâce au noyau 2.4.X en ajustant

<informalexample><screen>
# echo "2048 32767" &gt; /proc/sys/net/ipv4/ip_local_port_range
</screen></informalexample>

pour fixer l'intervalle des ports source que le serveur TFTP peut utiliser.

</para>
  </sect2>

  <sect2 id="tftp-images">
  <title>Mettre les images TFTP en place</title>
<para>

Ensuite, placez les images TFTP dont vous avez besoin (décrites dans la 
<xref linkend="where-files"/>) dans le répertoire des images d'amorçage 
de <command>tftpd</command>. Généralement, ce répertoire s'appelle 
<filename>/tftpboot</filename>. Vous aurez à faire un lien depuis ce fichier 
vers le fichier que <command>tftpd</command> utilisera pour amorcer le client.
Malheureusement, le nom du fichier est déterminé par le client 
TFTP et il n'y a pas vraiment de standard.

</para>
<para arch="powerpc">

Sur les machines Power Macintosh NewWorld, vous devrez configurer le programme 
d'amorçage <command>yaboot</command> comme une image d'amorçage TFTP. 
<command>Yaboot</command> chargera les images du noyau et du disque virtuel à 
travers TFTP. Pour amorcer sur le réseau, utilisez
<filename>yaboot-netboot.conf</filename>. Renommez-le simplement en
<filename>yaboot.conf</filename> dans le répertoire TFTP.

</para>
<para arch="x86">

Pour le démarrage PXE, tout ce dont vous avez besoin est dans l'archive
<filename>netboot/netboot.tar.gz</filename>. Extrayez les fichiers dans le
répertoire de l'image <command>tftpd</command>. Assurez-vous que le serveur
DHCP donnera bien le fichier <filename>pxelinux.0</filename> comme fichier
d'amorçage à <command>tftpd</command>.
</para>
<para arch="ia64">
Pour le démarrage PXE, tout ce dont vous avez besoin est dans l'archive
<filename>netboot/netboot.tar.gz</filename>. Extrayez les fichiers dans le
répertoire de l'image <command>tftpd</command>. Assurez-vous que le serveur
DHCP donnera bien le fichier 
<filename>/debian-installer/ia64/elilo.efi</filename> comme fichier
d'amorçage à <command>tftpd</command>.
</para>

   <sect3 arch="mipsel">
   <title>Images TFTP pour les DECstation</title>
<para>

Pour les DECstation, il y a des fichiers tftpimage pour chaque 
sous-architecture&nbsp;; ils contiennent à la fois un noyau et un 
installateur en un seul fichier. La convention
de nommage est <filename><replaceable>subarchitecture</replaceable>/netboot-boot.img</filename>.
Copiez l'image tftp que vous allez utiliser dans
<userinput>/tftpboot/tftpboot.img</userinput> si vous travaillez avec
l'exemple de configuration de BOOTP/DHCP décrit plus haut.

</para><para>

Le microprogramme des DECstation autorise l'amorçage via TFTP par
la commande <userinput>boot <replaceable>#</replaceable>/tftp</userinput> 
où <replaceable>#</replaceable> est le numéro de périphérique 
«&nbsp;TurboChannel&nbsp;» sur lequel amorcer. Sur la plupart des DECstation, 
c'est le numéro <quote>3</quote>. Si le serveur BOOTP/DHCP ne fournit pas le
nom du fichier ou si vous avez besoin de passer des paramètres 
supplémentaires, cela peut se faire avec la syntaxe suivante&nbsp;:

</para><para>

<userinput>boot #/tftp/filename param1=value1 param2=value2 ...</userinput>

</para><para>

Plusieurs révisions des microprogrammes des DECstation ont un problème avec 
l'amorçage sur le réseau&nbsp;: le transfert débute mais après un certain 
temps, il s'arrête avec <computeroutput>a.out err</computeroutput>. 
Il peut y avoir plusieurs causes&nbsp;:

<orderedlist>
<listitem><para>

Le microprogramme ne répond pas à une requête ARP durant un transfert TFTP. 
Cela conduit à un <quote>timeout</quote> d'ARP et le transfert s'arrête. La solution est 
d'ajouter l'adresse MAC de la carte Ethernet dans la table 
ARP du serveur TFTP. On peut le faire avec
<userinput>arp -s <replaceable>IP-address</replaceable>
<replaceable>MAC-address</replaceable></userinput> en tant que root sur la 
machine serveur TFTP. On peut lire l'adresse MAC de la DECstation en entrant
<command>cnfg</command> à l'invite du microprogramme de la DECstation.

</para></listitem>
<listitem><para>

Le microprogramme impose une taille limite aux fichiers utilisés pour amorcer par TFTP.

</para></listitem>
</orderedlist>

Il y aussi des révisions de microprogramme qui ne peuvent pas s'amorcer du 
tout par TFTP, voyez 
<ulink url="http://www.netbsd.org/Ports/pmax/board-list.html#proms">les pages web de NetBSD</ulink>.

</para>
   </sect3>

   <sect3 arch="alpha">
   <title>Amorçage TFTP pour Alpha</title>
<para>
Sur Alpha, vous devez spécifier le nom de fichier (le chemin étant
relatif au répertoire de l'image d'amorçage) en utilisant l'argument 
<userinput>-file</userinput> de la commande <userinput>boot</userinput> 
de SRM ou en configurant la variable d'environnement 
<userinput>BOOT_FILE</userinput>. Vous pouvez aussi passer le nom de fichier 
via BOOTP (pour <command>dhcpd</command> ISC, utilisez la directive 
<userinput>filename</userinput>). À la différence d'Open Firmware, il n'y a 
pas de <emphasis>nom de fichier par défaut</emphasis> dans SRM et vous 
<emphasis>devez</emphasis> utiliser l'une de ces méthodes pour spécifier un nom 
de fichier.

</para>
   </sect3>

   <sect3 arch="sparc">
   <title>Amorçage TFTP pour SPARC</title>
<para>

Certaines architectures SPARC ajoutent au nom de fichier la sous-architecture, comme 
<quote>SUN4M</quote> ou <quote>SUN4C</quote>. Ainsi, si votre sous-architecture système
est SUN4C et que son adresseIP est 192.168.1.3, le nom de fichier sera
<filename>C0A80103.SUN4C</filename>. Cependant, pour certaines architectures, le fichier
recherché est simplement <filename>client-ip-en-hex</filename>.
Pour déterminer facilement ce nom et en supposant que l'adresse IP est 
10.0.0.4, lancez un interpréteur de commandes et faites&nbsp;:

<informalexample><screen>
$ printf '%.2x%.2x%.2x%.2x\n' 10 0 0 4
</screen></informalexample>

Il suffira de mettre les lettres en majuscule et d'ajouter le nom de la sous-architecture
pour obtenir le nom du fichier.

</para>

<para>

Si tout a été fait correctement, la commande <userinput>boot net</userinput>
depuis l'OpenPROM devrait charger l'image. Si l'image n'est pas trouvée,
vérifiez dans les journaux du serveur tftp sous quel nom elle a été demandée.
</para>
<para>

Vous pouvez aussi forcer certains systèmes SPARC à rechercher un nom de 
fichier spécifique en l'ajoutant à la fin de la commande d'amorçage de 
OpenPROM, p.&nbsp;ex. <userinput>boot net my-sparc.image</userinput>. 
Ce fichier doit bien sûr être présent dans un répertoire connu du serveur TFTP.

</para>
   </sect3>

   <sect3 arch="m68k">
   <title>Amorçage TFTP pour BVM/Motorola</title>
<para>

Pour BVM et les systèmes VMEbus Motorola, recopiez les fichiers 
&bvme6000-tftp-files; dans <filename>/tftpboot/</filename>.

</para><para>

Ensuite, configurez votre ROM d'amorçage et votre serveur BOOTP pour charger 
en premier les fichiers <filename>tftplilo.bvme</filename> ou 
<filename>tftplilo.mvme</filename> du serveur TFTP. Reportez-vous au fichier
<filename>tftplilo.txt</filename> de votre sous-architecture pour obtenir 
des informations supplémentaires sur la configuration de votre système.

</para>
   </sect3>

   <sect3 arch="mips">
   <title>Amorçage TFTP pour SGI</title>
<para>

Sur les machines SGI, vous pouvez compter sur <command>bootpd</command> pour
obtenir le nom du fichier TFTP. Il est donné soit par 
<userinput>bf=</userinput> dans <filename>/etc/bootptab</filename> ou 
bien par l'option <userinput>filename=</userinput> dans 
<filename>/etc/dhcpd.conf</filename>.

</para>
   </sect3>

   <sect3 arch="mips">
   <title>Amorcer avec TFTP les cartes Broadcom BCM91250A et BCM91480B</title>
<para>

Il n'est pas utile de configurer DHCP car vous indiquerez à CFE l'adresse 
exacte du fichier qui doit être chargé.

</para>
   </sect3>
  </sect2>
<!-- FIXME: commented out since it seems too old to be usable and a current
            way is not known


  <sect2 id="tftp-low-memory">
  <title>Installation de TFTP sur système avec peu de mémoire</title>
<para>

Sur certains systèmes, le disque virtuel d'installation
          standard, combiné avec les exigences en mémoire de l'image
          d'amorçage TFTP, ne peuvent tenir en mémoire. Dans ce cas,
          vous pouvez quand même utiliser TFTP mais vous aurez à
          passer par une étape supplémentaire pour monter votre
          répertoire racine à travers le réseau. Ce type de
          configuration est aussi approprié pour les clients sans
          disque  et les clients sans données.

</para><para>

Commencez par suivre toutes les étapes ci-dessus dans 
<xref linkend="install-tftp"/>.

<orderedlist>
<listitem><para>

Copiez l'image du noyau Linux sur votre serveur TFTP en
utilisant l'image <userinput>a.out</userinput> de l'architecture sur
           laquelle vous êtes en train d'amorcer.

</para></listitem>
<listitem><para>

«&nbsp;Détarez&nbsp;» l'archive de root sur votre serveur
           NFS (qui peut être le même que votre serveur TFTP)&nbsp;:

<informalexample><screen>
# cd /tftpboot
# tar xvzf root.tar.gz
</screen></informalexample>

Assurez-vous d'utiliser le <command>tar</command> de GNU (les
           autres programmes, comme celui de SunOS, manipulent
           incorrectement certains périphériques comme les fichiers
           ordinaires).

</para></listitem>
<listitem><para>

Exportez votre répertoire
<filename>/tftpboot/debian-sparc-root</filename> avec les accès
           root pour votre client. Vous devez ajouter la ligne
           suivante à <filename>/etc/exports</filename> (syntaxe GNU/Linux,
           cela devrait être similaire pour SunOS jusqu'à la version
           4.1.x)&nbsp;:

<informalexample><screen>

/tftpboot/debian-sparc-root client(rw,no_root_squash)

</screen></informalexample>

Note&nbsp;: <replaceable>client</replaceable> est le nom d'hôte ou bien
           l'adresse IP reconnue par le serveur pour le système que
           vous allez amorcer.

</para></listitem>
<listitem><para>

Créez un lien symbolique depuis votre adresse IP cliente
           sous forme de nombres séparés par des points dans le fichier
<filename>debian-sparc-root</filename> du répertoire
           <filename>/tftpboot</filename>. Par exemple, si l'adresse IP client
           est 192.168.1.3, faites&nbsp;:

<informalexample><screen>
# ln -s debian-sparc-root 192.168.1.3
</screen></informalexample>

</para></listitem>
</orderedlist>

</para>

  </sect2>

  <sect2>
  <title>Installation avec une racine TFTP et NFS</title>
<para>

C'est très proche de l'installation pour système avec peu de
mémoire <xref linkend="tftp-low-memory"/> parce que vous ne voulez pas 
charger le disque virtuel mais amorcer depuis le système de fichier nfs-root
          créé il y a peu. Vous n'avez qu'à remplacer le lien vers
          l'image tftpboot par un lien vers l'image du noyau
(p. ex. <filename>linux-a.out</filename>).

</para><para>

RARP/TFTP requires all daemons to be running on the same server (the
workstation is sending a TFTP request back to the server that replied
to its previous RARP request).

</para><para>

Pour amorcer la machine cliente, allez à <xref linkend="boot-tftp"/>.

</para>

  </sect2>
END FIXME -->
 </sect1>
