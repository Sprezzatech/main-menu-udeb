#!/bin/sh
# 
# A script to find out which .po files has been updated since the last
# update, according to the PO-Revision flag and the Debian changelog
# 
# Copyright (c) 2004 Nikolai Prokoschenko (nikolai@prokoschenko.de)
#
# This script is available under the GNU Public License
# (http://www.gnu.org/licenses/gpl.txt) 

CURDIR=`dirname $0`

if [ "x$1" = "x" ]
then
  echo "Usage: $0 <package-directory> [-d]"
  echo 
  echo "-d: remove the .credits_log file after the output, please use while releasing"
  echo
  exit
fi

if [ "$1" = "-d" ]
then 
    P=$2;
    DELETE="true";
else
    P=$1;
    if [ "$2" = "-d" ]
    then
	DELETE="true";
    fi

fi


PACKAGE=`echo $P | sed 's/\/$//g'` 

if [ ! -d $PACKAGE ]
then
  echo "Cannot access the directory $PACKAGE!"
  exit
fi

$CURDIR/log-changes $P

if [ "`cat "$PACKAGE/debian/.credits_log"| wc -l`" -gt 0 ]
then
echo -n "  * Updated translations: "
fi

PREV=""

while read line 
do
    L=`echo $line | cut -d ":" -f 1`
    T=`echo $line | cut -d ":" -f 2`
    CSN=`echo $L | sed 's/\.po$//g'`;
    TEMP=`echo $CSN | grep _`
    if [ ! "x$TEMP" = "x" ]
    then
	case $CSN in
	    "pt_BR") R="Portuguese (Brazil)";;
	    "zh_CN") R="Simplified Chinese";;
	    "zh_TW") R="Traditional Chinese";;
	 esac
    elif [ -e "/usr/share/iso-codes/iso_639.tab" ]
    then
	R=`cat /usr/share/iso-codes/iso_639.tab | cut -f 3,4 | grep "^$CSN" | cut -f 2`
    else
  
    case $CSN in
    "ar") R="Arabic";;
    "bg") R="Bulgarian";;
    "bs") R="Bosnian";;
    "ca") R="Catalan";;
    "cs") R="Czech";;
    "cy") R="Welsh";;
    "da") R="Danish";;
    "de") R="German";;
    "el") R="Greek";;
    "en") R="English";;
    "es") R="Spanish";;
    "fi") R="Finnish";;
    "fr") R="French";;
    "ga") R="Irish";;
    "he") R="Hebrew";;
    "hu") R="Hungarian";;
    "it") R="Italian";;
    "ja") R="Japanese";;
    "ko") R="Korean";;
    "lt") R="Lithuanian";;
    "lv") R="Latvian";;
    "nb") R="Norwegian";;
    "nl") R="Dutch";;
    "nn") R="Norwegian";;
    "pl") R="Polish";;
    "pt") R="Portuguese";;
    "ro") R="Romanian";;
    "ru") R="Russian";;
    "sk") R="Slovak";;
    "sl") R="Slovenian";;
    "sq") R="Albanian";;
    "sv") R="Swedish";;
    "tr") R="Turkish";;
    "uk") R="Ukrainian";;
    *) R=$CSN;;
  esac

  fi

  if [ "$PREV" = "$L" ]
  then
	echo -n ", $T"
  else
      echo
      echo -n "    - $R ($CSN.po) by $T"
  fi
  PREV=$L
done < $PACKAGE/debian/.credits_log
if [ "x$DELETE" != "x" ]
then
    rm $PACKAGE/debian/.credits_log
fi
echo
