#!/bin/sh
# Sets up a preseed/t/$MACHINE file based on some environment variables.
# This is mostly useful if you're netbooting and out of kernel command line
# space, and need to vary some options on a per scheme basis.
f=$DI_TESTDIR/preseed/t/$MACHINE
rm -f $f
echo "# Automatically generated for $SCHEME digress test" >> $f

if [ -n "$TASK" ]; then
	echo "d-i preseed/include string ../test.cfg ../task/$TASK.cfg" >> $f
else
	echo "d-i preseed/include string ../test.cfg" >> $f
fi

if [ -n "$SUITE" ]; then
	echo "d-i mirror/suite string $SUITE" >> $f
fi

if [ -n "$USER" ]; then
	echo "passwd passwd/username string $USER" >> $f
	echo "passwd passwd/user-fullname string $USER" >> $f
fi

# Of course this exposes the user password in the preseed file.
if [ -n "$USER_PASSWORD" ]; then
	echo "password passwd/user-password password $USER_PASSWORD" >> $f
	echo "password passwd/user-password-again password $USER_PASSWORD" >> $f
fi
