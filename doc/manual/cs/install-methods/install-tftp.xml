<?xml version="1.0" encoding="ISO-8859-2"?>
<!-- $Id: install-tftp.xml,v 1.1 2003/11/14 05:20:01 mck Exp $ -->
<!-- original version: 1.9 -->

 <sect1 condition="supports-tftp" id="install-tftp">
 <title>Pøíprava souborù pro zavedení ze sítì pomocí TFTP</title>
<para>

Pokud je vá¹ poèítaè pøipojen do lokální sítì, mù¾ete jej zavést ze
sítì pomocí TFTP. Jestli¾e chcete pomocí TFTP zavést instalaèní
systém, musíte na vzdáleném poèítaèi nakopírovat zavádìcí soubory do
specifických adresáøù a povolit zavádìní va¹í stanice.

</para><para>

Musíte nastavit TFTP server a pro CATS stroje BOOTP server
<phrase condition="supports-rarp"> nebo RARP </phrase>
<phrase condition="supports-dhcp"> nebo DHCP </phrase> server.

</para><para>

<phrase condition="supports-rarp"> Klientovi mù¾ete sdìlit jeho IP
adresu protokolem RARP (Reverse Address Resolution Protocol) nebo BOOTP.
</phrase>

<phrase condition="supports-bootp"> BOOTP je IP protokol, který
informuje poèítaè o jeho IP adrese a prozradí mu, odkud si má stáhnout
zavádìcí obraz.
</phrase>

<phrase arch="m68k"> Na systémech VMEbus existuje je¹tì jedna mo¾nost:
IP adresu mù¾ete ruènì nastavit v boot ROM.
</phrase>

<phrase condition="supports-dhcp"> DHCP (Dynamic Host Configuration
Protocol) je flexibilnìj¹í, zpìtnì kompatibilní roz¹íøení protokolu
BOOTP. Nìkteré systémy mohou být nastaveny pouze pomocí DHCP.
</phrase>

</para><para arch="powerpc">

Pokud máte NewWorld Power Macintosh, je lep¹í pou¾ít místo BOOTP
protokol DHCP, proto¾e nìkteré novìj¹í poèítaèe se neumí protokolem
BOOTP zavést.

</para><para arch="alpha"> 

Na rozdíl od Open Firmware, který je stanicích Sparc a PowerPC,
konzole SRM <emphasis>nemù¾e</emphasis> pou¾ít protokol RARP za
úèelem získání IP adresy. Proto musíte pro zavedení Alphy ze sítì
pou¾ít protokol BOOTP. Také mù¾ete zadat nastavení sí»ových rozhraní
pøímo v SRM konzoli.

<footnote>
<para>

Systémy Alpha mohou také sí»ovì nabootovat pomocí DECNet MOP
(Maintenance Operations Protocol), ale tato mo¾nost není dále
popsána. Pravdìpodobnì ale bude vá¹ lokální OpenVMS operátor
¹tìstím bez sebe, kdy¾ ho po¾ádáte o pomoc pøi zavedení Linuxu
na své Alphì.

</para>
</footnote></para><para arch="hppa"> 

Nìkteré star¹í stroje HPPA (tj. 715/75) pou¾ívají místo BOOTP protokol
RBOOTD. Balíèek je dostupný na WWW stránce parisc-linuxu.

</para><para>

Pro pøenos zavádìcího obrazu ke klientovi se pou¾ívá protokol TFTP
(Trivial File Transfer Protocol). Teoreticky mù¾ete pou¾ít server na
libovolné platformì, která jej implementuje. Ukázky v této kapitole se
vztahují k operaèním systémùm SunOS 4.x, SunOS 5.x (neboli Solaris) a
GNU/Linux.

</para>

&tftp-rarp.xml;
&tftp-bootp.xml;
&tftp-dhcp.xml;

  <sect2 id="tftpd">
  <title>Povolení TFTP serveru</title>
<para>

Aby vám TFTP server fungoval, mìli byste nejprve zkontrolovat,
zda je <command>tftpd</command> povolen. Toho obvykle docílíte
následující øádkou v souboru <filename>/etc/inetd.conf</filename>:

<informalexample><screen>

tftp dgram udp wait root /usr/sbin/tcpd in.tftpd /tftpboot

</screen></informalexample>

Podívejte se do souboru <filename>/etc/inetd.conf</filename> a
zapamatujte si název adresáøe, jeho¾ jméno je za
<command>in.tftpd</command>; budete jej dále potøebovat. Pøepínaè
<userinput>-l</userinput> umo¾òuje nìkterým verzím
<command>in.tftpd</command> zaznamenávat v¹echny po¾adavky, které mu
byly zaslány, do systémových logù. To je vhodné zejména v situaci, kdy
zavádìní neprobíhá tak, jak má. Pokud musíte zmìnit obsah souboru
<filename>/etc/inetd.conf</filename>, musíte proces
<command>inetd</command> upozornit, aby aktualizoval svá nastavení.
Na stroji s Debianem staèí spustit <userinput>/etc/init.d/netbase
reload</userinput> (pro potato/2.2 a novìj¹í pou¾ijte
<userinput>/etc/init.d/inetd reload</userinput>).
Na jiných systémech musíte zjistit ID bì¾ícího procesu
<command>inetd</command> a spustit <userinput>kill -HUP
<replaceable>inetd-pid</replaceable></userinput>.

</para><para arch="i386">

Abyste mohli vyu¾ít PXE (Pre-boot Execution Environment) metodu TFTP
zavádìní, musíte mít TFTP server s podporou
<userinput>tsize</userinput>, napøíklad <command>tftp-hpa</command>.

</para><para arch="mips">

Pokud je va¹ím TFTP serverem GNU/Linux s jádrem 2.4.X, musíte na nìm
následujícím pøíkazem vypnout ,,Path MTU discovery'':

<informalexample><screen>

echo 1 > /proc/sys/net/ipv4/ip_no_pmtu_disc

</screen></informalexample>

Pokud tak neuèiníte, PROM na Indym nebude moci stáhnout jádro.
Dále zkontrolujte ¾e TFTP pakety jsou posílány z portu men¹ího ne¾
32767, proto¾e jinak by se pøenos zastavil po prvním paketu.
Rozsah zdrojových portù, které má TFTP server pou¾ívat se nastaví
pøíkazem:

<informalexample><screen>

echo "2048 32767" > /proc/sys/net/ipv4/ip_local_port_range

</screen></informalexample>

</para>
  </sect2>

  <sect2 id="tftp-images">
  <title>Pøesun TFTP obrazù na místo</title>
<para>

Dále je potøeba umístit pøíslu¹ný TFTP obraz (viz
<xref linkend="file-descs"/>) do adresáøe, kde má
<command>tftpd</command> ulo¾eny obrazy, obvykle
<filename>/tftpboot</filename>. Bohu¾el TFTP klient oèekává jméno
souboru v urèitém tvaru, pro který neexistují ¾ádné závazné
standardy. Proto je¹tì musíte na pøíslu¹ný obraz vytvoøit odkaz, který
<command>tftpd</command> pou¾ije pro zavedení konkrétního klienta.

</para><para arch="powerpc">

Na strojích NewWorld Power Macintosh budete muset nastavit jako
zavádìcí TFTP obraz zavadìè <command>yaboot</command>.
<command>Yaboot</command> si pak sám pøes TFTP stáhne obrazy jádra a
RAMdisku. Pro zavádìní ze sítì pou¾ijte soubor
<filename>yaboot-netboot.conf</filename>, který v TFTP adresáøi
pøejmenujete na <filename>yaboot.conf</filename>.

</para><para arch="not-powerpc">

TFTP klient èasto hledá soubor
<replaceable>hex-ip-adresa-klienta-architektura</replaceable>.
Tento název se spoèítá relativnì jednodu¹e: K èásti
<replaceable>hex-ip-adresa-klienta</replaceable> dojdete tak, ¾e
vyjádøíte ka¾dý bajt IP adresy klienta v ¹estnáctkové soustavì. 
Pokud máte po ruce program <command>bc</command> klidnì jej pou¾ijte.
Pøíkazem <userinput>obase=16</userinput> nastavíte výstup na
hexadecimální a potom u¾ jen zadáte jednotlivé èásti IP adresy.
Pro promìnnou <replaceable>architektura</replaceable> vyzkou¹ejte
rùzné hodnoty.

</para><para arch="i386">

Pro PXE zavádìní mù¾ete pou¾ít zavadìè
<filename>pxelinux.0</filename>, je¾ je souèástí balíku
<classname>syslinux</classname>. Zavadìè nakopírujte do adresáøe
<filename>/tftpboot</filename>. Tamté¾ vytvoøte podadresáø
<filename>/tftpboot/pxelinux.cfg</filename>, který bude obsahovat
textový soubor <filename>default</filename>. Mo¾ný obsah souboru:

<informalexample><screen>

default lanlinux
prompt 1

label lanlinux
  kernel tftpboot.img
  append load initrd=root.bin devfs=nomount

</screen></informalexample>

Parametr <userinput>devfs=nomount</userinput> je podstatný, proto¾e
bez nìj by ne¹lo pøipojit koøenový souborový systém ze souboru
<filename>root.bin</filename>.

</para><para arch="i386">

Závìrem nakopírujte do adresáøe <filename>/tftpboot</filename> soubory 
<filename>tftpboot.img</filename> a <filename>root.bin</filename>
(naleznete je na ftp archivech Debianu).

</para>


   <sect3 arch="mipsel">
   <title>TFTP obrazy pro DECstation</title>
<para>

Na poèítaèích DECstation existují pro ka¾dou podarchitekturu speciální
tftp obrazy, které v jednom souboru obsahují jak jádro, tak instalaèní
program. Jména tìchto souborù jsou
tftpimage-<replaceable>podarchitektura</replaceable> nebo
tftpimage-<replaceable>podarchitektura</replaceable>.gz. Pokud je
obraz zabalený (má pøíponu .gz), musíte jej pøed pou¾itím rozbalit
(napø. <userinput>gunzip
tftpimage-<replaceable>podarchitektura</replaceable>.gz</userinput>),
proto¾e DECstation neumí zavádìt komprimované obrazy skrze TFTP.
Jestli¾e jste si nastavili BOOTP/DHCP podle na¹ich pøíkladù,
nakopírujte tftp obraz do souboru
<filename>/tftpboot/tftpboot.img</filename>.

</para><para>

Z DECstation firmwaru zavedete systém pøes TFTP pøíkazem
<userinput>boot <replaceable>#</replaceable>/tftp</userinput>, kde
<replaceable>#</replaceable> je èíslo zaøízení TurboChannel, ze
kterého se má zavádìt. Vìt¹inou to bývá ,,3''. Pokud vám BOOTP/DHCP
server nenabídne správný obraz, nebo pokud chcete zadat speciální
parametry, mù¾ete pou¾ít následující syntaxi:

</para><para>

<userinput>boot #/tftp/filename param1=value1 param2=value2 ...</userinput>

</para><para>

U nìkolika revizí DECstation firmwaru se projevuje problém se
zavádìním ze sítì: zahájí se pøenos a po krátké dobì stahování spadne
s hlá¹kou  <computeroutput>a.out err</computeroutput>. To mù¾e mít
nìkolik pøíèin:

<orderedlist>
<listitem><para>

Firmware neodpovídá na ARP po¾adavky, co¾ po chvíli vede k vypr¹ení
èasového kvanta ARP protokolu a pøenos se zastaví. Øe¹ením je ruènì
pøidat MAC adresu sí»ové karty stanice do ARP tabulky TFTP
serveru. MAC adresu získáte z promptu firmwaru pøíkazem
<command>cnfg</command>. Tuto adresu pak na TFTP serveru pøidáte
pøíkazem <userinput>arp -s <replaceable>IP-adresa</replaceable>
<replaceable>MAC-adresa</replaceable></userinput>.

</para></listitem>
<listitem><para>

Firmware má omezení na velikost zavádìných obrazù.

</para></listitem>
</orderedlist>

Také existují revize firmwaru, které neumí s TFTP pracovat vùbec.
Pøehled rùzných revizí mù¾ete najít na stránkách projektu NetBSD:
<ulink
url="http://www.netbsd.org/Ports/pmax/board-list.html#proms"></ulink>.

</para>
   </sect3>

   <sect3 arch="alpha">
   <title>Zavedení Alphy pøes TFTP</title>
<para>

Na systémech Alpha musíte v SRM konzoli zadat jméno obrazu (jako
relativní cestu k adresáøi se zavádìcími obrazy) jako parametr
argumentu <userinput>-file</userinput> pøíkazu
<userinput>boot</userinput>. Stejného výsledku dosáhnete nastavením
promìnné <userinput>BOOT_FILE</userinput>.
Eventuálnì mù¾ete jméno specifikovat rovnì¾ pomocí BOOTP
(pøi konfiguraci ISC <command>dhcpd</command> pou¾ijte direktivu
<userinput>filename</userinput>). Na SRM konzoli, na rozdíl od Open
Firmwaru, <emphasis>neexistuje</emphasis> standardní jméno souboru,
tak¾e <emphasis>musíte</emphasis> zadat jméno souboru jednou z
popsaných metod.

</para>
   </sect3>

   <sect3 arch="sparc">
   <title>TFTP zavádìní na poèítaèích SPARC</title>
<para>

Poèítaèe SPARC pou¾ívají jména podarchitektur jako tøeba ,,SUN4M''
nebo ,,SUN4C''; v nìkterých pøípadech se jméno architektury nechává
prázdné, tak¾e jméno hledaného souboru je pouze
<filename>hex-ip-adresa-klienta</filename>.
Pokud tøeba máte poèítaè s podarchitekturou SUN4C a IP adresa je
192.168.1.3, pak jméno souboru bude
<filename>C0A80103.SUN4C</filename>.

</para><para>

Nìkteré sparc systémy mù¾ete pøidáním jména souboru na konec OpenPROM
pøíkazu <userinput>boot</userinput> donutit hledat konkrétní soubor.
(Napø. <userinput>boot net muj-sparc.obraz</userinput>).
Soubor musí být samozøejmì v adresáøi prohledávaném TFTP serverem.

</para>
   </sect3>

   <sect3 arch="m68k">
   <title>TFTP zavádìní na systémech BVM/Motorola</title>
<para>

Pro systémy BVM a Motorola VMEbus nakopírujte soubory
&bvme6000-tftp-files; do adresáøe <filename>/tftpboot/</filename>.

</para><para>

Poté nakonfigurujte boot ROM nebo BOOTP server, aby nejprve z TFTP
serveru natáhl soubory <filename>tftplilo.bvme</filename> nebo
<filename>tftplilo.mvme</filename>.
Dal¹í informace o konfiguraci systémovì specifických èástí pro svou
podarchitekturu získáte v souboru <filename>tftplilo.txt</filename>.

</para>
   </sect3>

   <sect3 arch="mips">
   <title>TFTP zavádìní na SGI Indy</title>
<para>

U poèítaèù SGI Indy se mù¾ete spolehnout na <command>bootpd</command>,
¾e pøedá správné jméno TFTP souboru. Jméno se zadává v souboru
<filename>/etc/bootptab</filename> jako parametr
<userinput>bf=</userinput> nebo v souboru
<filename>/etc/dhcpd.conf</filename> parametrem <tt>filename=</tt>.

</para>
   </sect3>
  </sect2>

  <sect2 id="tftp-low-memory">
  <title>TFTP instalace na systémech s nedostatkem pamìti</title>
<para>

Na nìkterých systémech se standardní instalaèní RAMdisk a zavádìcí
TFTP obraz nemusí vlézt do pamìti. V takovém pøípadì musíte navíc pøes
NFS pøipojit také koøenový adresáø. Tento postup je shodný s instalací
na bezdiskové nebo bezdatové klienty.

</para><para>

Nejprve proveïte v¹echny kroky podle <xref linkend="install-tftp"/>.

<orderedlist>
<listitem><para>

Nakopírujte obraz linuxového jádra (<userinput>a.out</userinput> verzi
pro va¹i architekturu) na TFTP server.

</para></listitem>
<listitem><para>

Na NFS serveru rozbalte koøenový archiv. (NFS i TFTP mohou bì¾et na
stejném poèítaèi):

<informalexample><screen>

# cd /tftpboot
# tar xvzf root.tar.gz

</screen></informalexample>

Ujistìte se, ¾e pou¾íváte GNU <command>tar</command>, proto¾e nìkteré
implementace (konkrétnì ta na SunOS) pracují (chybnì) se zaøízeními
jako s obyèejnými soubory.

</para></listitem>
<listitem><para>

Na klienta exportujte adresáø
<filename>/tftpboot/debian-sparc-root</filename> (s rootovským
pøístupem). Tj. do souboru <filename>/etc/exports</filename> pøidejte
následující øádek (toto je GNU/Linux syntaxe - pro SunOS by to mìlo
být podobné):

<informalexample><screen>

/tftpboot/debian-sparc-root klient(rw,no_root_squash)

</screen></informalexample>

Poznámka: ,,klient'' je jméno nebo IP adresa instalovaného poèítaèe
tak, jak ji vidí server, kdy¾ se klient zavádí.

</para></listitem>
<listitem><para>

Vytvoøte symbolický odkaz z klientské IP adresy, v teèkové notaci,
na soubor <filename>debian-sparc-root</filename> v adresáøi
<filename>/tftpboot</filename>.
Napøíklad pokud je IP adresa klienta 192.168.1.3, napi¹te:

<informalexample><screen>

# ln -s debian-sparc-root 192.168.1.3

</screen></informalexample>

</para></listitem>
</orderedlist>

</para>

  </sect2>

  <sect2>
  <title>Instalace za pou¾ití TFTP a NFS</title>
<para>

Instalace pøes TFTP a pou¾ití koøenového adresáøe pøes NFS je podobné
jako <xref linkend="tftp-low-memory"/>, proto¾e nebudete do pamìti
nahrávat RAMdisk, ale zavedete systém z koøenového souborového systému
pøipojeného pøes NFS. Musíte pak nahradit symbolický odkaz, aby
ukazoval na jádro (napøíklad <filename>linux-a.out</filename>) a ne na
tftp obraz.

</para><para>

RARP/TFTP vy¾adují, aby v¹echny démony bì¾ely na stejném serveru.
(Stanice toti¾ ode¹le TFTP po¾adavek tomu, kdo odpoví na RARP
zprávu).

</para><para>

Nyní máte nachystáno v¹e potøebné a mù¾ete pøejít k zavedení klientské
stanice &mdash; <xref linkend="boot-tftp"/>.

</para>

  </sect2>
 </sect1>
