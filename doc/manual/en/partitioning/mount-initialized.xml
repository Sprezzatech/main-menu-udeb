<!-- retain these comments for translator revision tracking -->
<!-- $Id: mount-initialized.xml,v 1.4 2003/09/30 21:50:10 barbier Exp $ -->


 <sect1 id="mount-initialized">
 <title>``Mount a Previously-Initialized Partition''</title>
<para>

An alternative to <xref linkend="init-partition"/> is the
``Mount a Previously-Initialized Partition'' step.  Use this if you
are resuming an installation that was broken off, or if you want to
mount partitions that have already been initialized or have data on it
which you wish to preserve.  

</para><para condition="supports-nfsroot">

If you are installing a diskless workstation, at this point, you want
to NFS mount your root partition from the remote NFS server. Specify
the path to the NFS server in standard NFS syntax, namely,

<informalexample><screen>
<replaceable>server-name-or-IP</replaceable>:<replaceable>server-share-path</replaceable>
</screen></informalexample>.

If you need to mount additional file systems as well, you can do that
at this time.

</para><para arch="m68k"> 

The <replaceable>server-share-path</replaceable> for the BVM and
Motorola VMEbus systems should match the path specified in
<filename>tftplilo.conf</filename> on the TFTP server; it is used to
tell the Linux kernel which directory to mount when the installed
system is booted.  The default path in
<filename>tftplilo.conf</filename> is
<filename>/nfshome/%C</filename>,; where <userinput>%C</userinput>; is
replaced by the IP address, in dotted quad notation, of the booting
client system. 

</para><para condition="supports-nfsroot">

If you have not already set up your network as described in 
<xref linkend="configure-network"/>, then selecting an NFS install
will prompt you to do so.

</para>

  <sect2 condition="supports-nfsroot">
  <title>NFS Root Installation Workaround</title>
<para>
<phrase condition="FIXME">FIXME: still applicable in debian-installer?</phrase>

Unfortunately, the woody release of <command>boot-floppies</command> does
not support <command>dpkg</command> locking on NFS root installs. To work
around this problem, take the following steps after mounting your
target NFS share at <filename>/target</filename>. This example assumes
installation from a CD, but it could just as well apply for
installation from files placed on an NFS share and mounted at
<filename>/instmnt</filename> (which is where the installer normally mounts
installation media).

</para><para>

To enable NFS locking, make pre-arrangements to have this command
sequence on the NFS share, or create it there using
<command>nano-tiny</command>.

<informalexample><screen>
#!/bin/sh
mount /dev/hdc /instmnt  # substitute your cdrom device for /dev/hdc
cd /target
mkdir x
cd x
for i in g/glibc/libc6 t/tcp-wrappers/libwrap0 p/portmap/portmap n/nfs-utils/nfs-common
do
  ar -x /instmnt/pool/main/$i''_*.deb
  zcat data.tar.gz | tar x
done
umount /instmnt
mkdir -p /var/lib/nfs
for i in portmap rpc.statd
do
  LD_LIBRARY_PATH=lib sbin/$i
done
</screen></informalexample>

</para><para>

Now install the base system as usual.  Then install <classname>nfs-common</classname>:

<informalexample><screen>
$ umount /instmnt
$ chroot /target /bin/sh
$ apt-cdrom add
$ apt-get install nfs-common
</screen></informalexample>

</para><para>

The messages about missing <filename>/proc</filename> can be ignored, since
<command>portmap</command> and <command>statd</command> are already running.

</para><para>

You'll need a kernel built with
<userinput>CONFIG_ROOT_NFS</userinput>.  The one on the installation
CD isn't.  If you don't have one and can't build one on another
machine, you must build one right here in the
<command>chroot</command> environment:

<informalexample><screen>
$ apt-get install gcc make libc6-dev kernel-source-2.4.18 less screen links lynx wget ftp # etc.
</screen></informalexample>

</para><para>

When you've made arrangements to boot the new kernel, using the NFS
share as root device, back out cleanly:

<informalexample><screen>
$ exit # from chroot shell
$ cd /
$ killall portmap rpc.statd
$ umount /target
</screen></informalexample>

</para><para>

Then reboot. If it fails, then boot the installation CD, mount the NFS
share on /target, enable NFS locking, chroot /target, do what you forgot
to do, back out cleanly, and reboot.  If it fails, try again.  Good luck.

</para>
  </sect2>
 </sect1>
