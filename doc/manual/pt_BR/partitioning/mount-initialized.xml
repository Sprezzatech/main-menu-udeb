<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- $Id: mount-initialized.xml,v 1.2 2004/03/13 11:57:22 gleydson Exp $ -->
<!-- original version: 1.5 -->

 <sect1 id="mount-initialized">
 <title>"Montar uma partição montada anteriormente"</title>
<para>

Uma alternativa a <xref linkend="init-partition"/> é o passo
"Montar uma Partição Inicializada Anteriormente". Use isto se 
estiver retomando a instalação que tenha falhado ou deseja montar
partição que já foram inicializadas ou tem dados que deseja preservar.

</para><para condition="supports-nfsroot">

Caso estiver instalando a partir de uma estação sem discos, neste ponto,
você deverá fazer a montagem de sua partição raíz através de um servidor
NFS. Especifique o caminho para o servidor NFS em uma sintaxe padrão do 
NFS, da seguinte forma:

<informalexample><screen>
<replaceable>nome-do-servidor-ou-IP</replaceable>:<replaceable>caminho-compartilhamento-servidor</replaceable>
</screen></informalexample>.

Caso deseje também montar sistemas de arquivos adicionais, você poderá fazer
isto agora.

</para><para arch="m68k"> 

O <replaceable>caminho-do-compartilhamento-do-servidor</replaceable> 
para sistemas BVM e Motorola VMEbus devem estar de acordo com o caminho
especificado no arquivo <filename>tftplilo.conf</filename> do servidor
TFTP; ele será usado para dizer ao kernel do Linux que diretório montar
quando o sistema instalado for inicializado. O caminho padrão em
<filename>tftplilo.conf</filename> é
<filename>/nfshome/%C</filename>,; onde <userinput>%C</userinput>; é
substituido pelo endereço IP, em notação pontuada do sistema cliente
que estiver sendo inicializado.

</para><para condition="supports-nfsroot">

Caso não tenha configurado sa rede como descrito em
<xref linkend="netcfg"/>, então selecionando uma instalação
via NFS você será perguntado por isso.

</para>

  <sect2 condition="supports-nfsroot">
  <title>Solução de problemas na instalação usando NFS do sistema raíz</title>
<para>
<phrase condition="FIXME">FIXME: ainda aplicável no debian-installer?</phrase>

Infelizmente, o lançamento do woody dos <command>boot-floppies</command> não
suportam o locking do <command>dpkg</command> em instalações usando sistemas
de arquivos raíz montados via NFS. Para contornar este problema, 
faça os seguintes pasosa pós montar seu compartilhamento NFS alvo em 
<filename>/target</filename>. Este exemplo assume a instalação através 
de CD, mas também é aplicável para arquivos de instalação colocados em 
um compartilhamento NFS e montado em <filename>/instmnt</filename> 
(que é o local aonde o programa de instalação normalmente
monta a mídia de instalação).

</para><para>

Para ativar o locking do NFS, faça alguns pré arranjos para ter 
esta sequência de comandos no seu compartilhamento NFS, ou crie-o 
usando o <command>nano-tiny</command>.

<informalexample><screen>
#!/bin/sh
mount /dev/hdc /instmnt  # substitua seu dispositivo de CD-ROM para /dev/hdc
cd /target
mkdir x
cd x
for i in g/glibc/libc6 t/tcp-wrappers/libwrap0 p/portmap/portmap n/nfs-utils/nfs-common
do
  ar -x /instmnt/pool/main/$i''_*.deb
  zcat data.tar.gz | tar x
done
umount /instmnt
mkdir -p /var/lib/nfs
for i in portmap rpc.statd
do
  LD_LIBRARY_PATH=lib sbin/$i
done
</screen></informalexample>

</para><para>

Agora instale o sistema básico como habitual. Então instale 
<classname>nfs-common</classname>:

<informalexample><screen>
$ umount /instmnt
$ chroot /target /bin/sh
$ apt-cdrom add
$ apt-get install nfs-common
</screen></informalexample>

</para><para>

As mensagens sobre o <filename>/proc</filename> faltando podem ser ignoradas,
pois o <command>portmap</command> e <command>statd</command> já estão sendo
executados.

</para><para>
Você precisará de um kernel compilado com o suporte a 
<userinput>CONFIG_ROOT_NFS</userinput>. O que está contido na instalação através
do CD não tem esse suporte. Caso não tenha um e não possa construir um kernel
em outra máquina, você poderá construir um kernel no ambicnete
<command>chroot</command>:

<informalexample><screen>
$ apt-get install gcc make libc6-dev kernel-source-2.4.18 less screen links lynx wget ftp # etc.
</screen></informalexample>

</para><para>

Assim que tiver feito os passos para inicializar através de seu novo
kernel usando o compartilhamento NFS como dispositivo raíz, volte
os passos:

<informalexample><screen>
$ exit # sai do shell chroot
$ cd /
$ killall portmap rpc.statd
$ umount /target
</screen></informalexample>

</para><para>

Então reinicie. Caso falhe, então inicie a partir do CD, monte o compartilhamento
NFS em /target, ative o locking NFS, chroot /target, faça o que tiver esquecido
de fazer, volte e reinicie. Caso falhar, tente novamente. Boa Sorte.

</para>
  </sect2>
 </sect1>
