#! /bin/sh
# This script is called at system startup
# This is where the installer actually interacts with the user

#export DEBIAN_FRONTEND=text
#export DEBCONF_DEBUG=5 

bterm=/usr/bin/bterm
font=/unifont-reduced.bgf

# Load framebuffer and enable it for bterm
if [ -x "$bterm" -a -e "$font" ] && enable-fb ; then
    use_bterm=true
fi

# Turn off console blanking.
echo "\033[9;0]"

/usr/bin/debconf-loadtemplate debian /var/lib/dpkg/info/*.templates 

# Enable UTF-8 locale if it is available
if [ -d /usr/lib/locale/C@utf-8 ] ; then
	LANG=C@utf-8
	export LANG
fi

# init will restart this script when it exits.  This will let us pick another
# frontend every time main-menu exits
if [ -z "$DEBIAN_FRONTEND" ] ; then
    for frontend in gtk newt slang text ; do
        if [ -e "/usr/lib/cdebconf/frontend/$frontend.so" ] ; then
            DEBIAN_FRONTEND=$frontend
            export DEBIAN_FRONTEND
            break
        fi
    done
fi

if [ true = "$use_bterm" ] ; then
    $bterm -f "$font" -l "$LANG" /sbin/di-main-menu
else
    echo "\033%G" # Enable UTF-8 console ("<ESC>%@" will turn it off).
    /sbin/di-main-menu
fi
