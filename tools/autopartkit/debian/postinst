#! /bin/sh -e

template=autopartkit/partition_table

run_parts() {
    partsdir="$1"

    for script in "$partsdir"/*; do
	if [ -x "$script" ] ; then
	    "$script" "$template" || true
	else
	    echo "error: Unable to execute $script" 1>&2
	fi
    done
}
# Try to load LVM support
depmod -a || true
modprobe lvm-mod || true

# Make sure it is installed into /target/ as well
apt-install lvm10

# Run all scripts to choose table file
run_parts /usr/lib/autopartkit.d

if autopartkit "$template" ; then
    :
else
    # This should use debconf to report the error.
    echo "error: autopartkit failed."
    # No sleep in d-i environment [2002-08-21]
    #sleep 10
    exit 1
fi

##DEBHELPER##
