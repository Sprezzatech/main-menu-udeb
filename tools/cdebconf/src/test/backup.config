#!/bin/sh -e

. /usr/share/debconf/confmodule

db_capb backup

db_register test/string test/string-register
db_fset test/string-register seen false

for type in string text-subst boolean multiselect note password select string text
do
    db_fset test/$type seen false
done

STATE=1

while true; do

isvalid=1
case "$STATE" in
  1)
    db_input critical test/string-register || true
    ;;

  2)
    db_input critical test/string || true
    ;;

  3)
    db_subst test/text-subst TEXT "yabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadoo 1234567890abcdefghijklmnopqrstuvwxyz1234567890abcdefghijklmnopqrstuvwxyz1234567890abcdefghijklmnopqrstuvwxyz"
    db_input critical test/text-subst || true
    ;;

  4)
    db_input critical test/boolean || true
    ;;

  5)
    db_input critical test/multiselect || true
    ;;

  6)
    db_input critical test/note || true
    ;;

  7)
    db_input critical test/password || true
    ;;

  8)
    db_input critical test/select || true
    ;;

  9)
    db_input critical test/string || true
    ;;

  10)
    db_input critical test/text || true
    ;;

  *)
    isvalid=0
    ;;
  esac

  [ "$isvalid" = 1 ] || break
  if db_go; then
     STATE=$(($STATE + 1))
  else
     STATE=$(($STATE - 1))
  fi
done

[ "$STATE" = 0 ] && exit 10
exit 0
