#!/bin/sh -e

#   Feed debconf DB with test.templates before running this script

. ../client/confmodule

db_capb backup

db_register test/string test/string-register
db_fset test/string-register seen false

for type in string text-subst boolean multiselect note password select string text
do
    db_fset test/$type seen false
done

#  Initial state
STATE=1
#  Initial direction
lastdir='+'

while true
do
    #   ask is set to 1 if at least one question is asked
    ask=0
    case "$STATE" in
      0)
        #  Back up was selected
        exit 10
        ;;
    
      1)
        if db_input critical test/string-register; then ask=1; else [ $? -eq 30 ]; fi
        ;;
    
      2)
        if db_input critical test/string; then ask=1; else [ $? -eq 30 ]; fi
        ;;
    
      3)
        db_subst test/text-subst TEXT "yabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadoo 1234567890abcdefghijklmnopqrstuvwxyz1234567890abcdefghijklmnopqrstuvwxyz1234567890abcdefghijklmnopqrstuvwxyz"
        if db_input critical test/text-subst; then ask=1; else [ $? -eq 30 ]; fi
        ;;
    
      4)
        if db_input critical test/boolean; then ask=1; else [ $? -eq 30 ]; fi
        ;;
    
      5)
        if db_input critical test/multiselect; then ask=1; else [ $? -eq 30 ]; fi
        ;;
    
      6)
        if db_input critical test/note; then ask=1; else [ $? -eq 30 ]; fi
        ;;
    
      7)
        if db_input critical test/password; then ask=1; else [ $? -eq 30 ]; fi
        ;;
    
      8)
        if db_input critical test/select; then ask=1; else [ $? -eq 30 ]; fi
        if db_input critical test/string; then ask=1; else [ $? -eq 30 ]; fi
        ;;
    
      9)
        if db_input critical test/text; then ask=1; else [ $? -eq 30 ]; fi
        ;;
    
      *)
        break
        ;;
    esac

    if db_go; then
        #  If question has been asked, thus Ok was selected,
        #  otherwise question was skipped and processing continues
        #  into the same direction.
        [ $ask -eq 1 ] && lastdir='+'
    else
        #  Go Back has been selected
        lastdir='-'
    fi
    STATE=$(($STATE $lastdir 1))
done

exit 0
