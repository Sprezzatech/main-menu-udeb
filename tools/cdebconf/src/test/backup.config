#!/bin/sh -e

#   Feed debconf DB with test.templates before running this script

. ../client/confmodule

db_capb backup

db_register test/string test/string-register
db_fset test/string-register seen false

for type in string text-subst boolean multiselect note password select string text
do
    db_fset test/$type seen false
done

STATE=1
lastdir=next

while true; do

isvalid=1
#   skip is set to 0 if at least one question is asked
skip=1
case "$STATE" in
  1)
    if db_input critical test/string-register; then skip=0; fi
    ;;

  2)
    if db_input critical test/string; then skip=0; fi
    ;;

  3)
    db_subst test/text-subst TEXT "yabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadooyabbadiyabbadoo 1234567890abcdefghijklmnopqrstuvwxyz1234567890abcdefghijklmnopqrstuvwxyz1234567890abcdefghijklmnopqrstuvwxyz"
    if db_input critical test/text-subst; then skip=0; fi
    ;;

  4)
    if db_input critical test/boolean; then skip=0; fi
    ;;

  5)
    if db_input critical test/multiselect; then skip=0; fi
    ;;

  6)
    if db_input critical test/note; then skip=0; fi
    ;;

  7)
    if db_input critical test/password; then skip=0; fi
    ;;

  8)
    if db_input critical test/select; then skip=0; fi
    if db_input critical test/string; then skip=0; fi
    ;;

  9)
    if db_input critical test/text; then skip=0; fi
    ;;

  *)
    isvalid=0
    ;;
  esac

  [ "$isvalid" = 1 ] || break
  if db_go; then
     if [ "x$skip" = x0 ]; then
         #  Question has been asked, thus Ok was selected
         STATE=$(($STATE + 1))
         lastdir=next
         #  ... otherwise continue in the same direction
     elif [ "x$lastdir" = xnext ]; then
         STATE=$(($STATE + 1))
     else
         STATE=$(($STATE - 1))
     fi
  else
     #  Go Back has been selected
     STATE=$(($STATE - 1))
     lastdir=prev
  fi
done

[ "$STATE" = 0 ] && exit 10
exit 0
