#!/usr/bin/make -f

DESTDIR = debian/etch-support

scripts = \
	base-installer.d/01kernel_etchnhalf \
	post-base-installer.d/01divert-debconf-apt-progress \
	finish-install.d/91restore-debconf-apt-progress

build:
	dh_testdir

clean:
	dh_testdir
	dh_testroot
	dh_clean

install: build
	dh_testdir
	dh_testroot
	dh_installdirs
	set -e; for file in $(scripts); do \
		install -m0755 $$file $(DESTDIR)/usr/lib/$$file; \
	done
	install -m0755 partman_init.d/01mke2fs_inode_size \
		$(DESTDIR)/lib/partman/init.d/01mke2fs_inode_size
	install -m0644 mke2fs.conf $(DESTDIR)/usr/share/etch-support/
	install -m0755 debconf-apt-progress $(DESTDIR)/usr/share/etch-support/

binary-indep: build install
	dh_testdir
	dh_testroot
	#dh_installdebconf
	dh_strip
	dh_compress
	dh_fixperms
	dh_installdeb
	dh_shlibdeps
	dh_gencontrol
	dh_builddeb

binary-arch: build install

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary install
