#! /bin/sh -e

. /lib/kickseed/kickseed.sh

ks_run_script () {
	TYPE="$1"
	INTERPRETER="$2"
	CHROOTED="$3"
	SCRIPT="$4"

	logger -t kickseed "Running $TYPE script $SCRIPT using interpreter $INTERPRETER (chrooted: $CHROOTED):"
	if [ "$CHROOTED" = 1 ]; then
		cp "$SCRIPT" /target/tmp/ks-script
		chmod 700 /target/tmp/ks-script
		log-output -t kickseed --pass-stdout \
			chroot /target "$INTERPRETER" /tmp/ks-script
	else
		cp "$SCRIPT" /tmp/ks-script
		chmod 700 /tmp/ks-script
		log-output -t kickseed --pass-stdout \
			"$INTERPRETER" /tmp/ks-script
	fi
}

kickseed_post
