#! /bin/sh -e

HANDLERS=/lib/kickseed/handlers
SPOOL=/var/spool/kickseed

. /lib/kickseed/kickseed.sh
. /lib/preseed/preseed.sh

ks_preseed () {
	echo "$@" >> "$SPOOL/preseed.cfg"
}

ks_run_script () {
	TYPE="$1"
	INTERPRETER="$2"
	CHROOTED="$3"
	SCRIPT="$4"

	logger -t kickseed "Running $TYPE script $SCRIPT using interpreter $INTERPRETER (chrooted: $CHROOTED):"
	if [ "$CHROOTED" = 1 ]; then
		chroot /target "$INTERPRETER" "$SCRIPT"
	else
		"$INTERPRETER" "$SCRIPT"
	fi
}

# TODO: need to parse ks= to work out where to get configuration file
kickseed /ks.cfg

if [ -s "$SPOOL/preseed.cfg" ]; then
	preseed_location "$SPOOL/preseed.cfg"
fi
