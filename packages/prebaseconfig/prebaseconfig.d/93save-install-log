#! /bin/sh
#
# Copy install logs to /target/var/log/debian-installer

# Intentionally not set -e.

logsavedir=/target/var/log/installer

# Make sure the debconf priority is in questions.dat for base-config.
# (Gross hack; there must be a better way.)
. /usr/share/debconf/confmodule
db_get debconf/priority
db_set debconf/priority $RET
# Make sure debconf has saved the database.
db_x_save

test -d $logsavedir || mkdir $logsavedir
cp /var/log/* $logsavedir

# Copy current debconf database
cp -a /var/lib/cdebconf $logsavedir

# Transition support for the old logsavedir /var/log/debian-installer
cd /target/var/log
test -L debian-installer || ln -s ./installer debian-installer
