#! /bin/sh
#
# Copy install logs to /target/var/log/debian-installer

set -e

logsavedir=/target/var/log/debian-installer

# Make sure the debconf priority is in questions.dat for base-config.
# (Gross hack; there must be a better way.)
. /usr/share/debconf/confmodule
db_get debconf/priority
db_set debconf/priority $RET
# Make sure debconf has saved the database.
kill -USR1 $(ps | grep "debconf -o" | sed 's/ root.*//')
# Make sure we wait until after it is done saving to copy the db, to avoid
# racing. This should block until it does..
db_get debconf/priority

test -d $logsavedir || mkdir $logsavedir
cp /var/log/* $logsavedir

# Copy current debconf database
cp -a /var/lib/cdebconf $logsavedir
