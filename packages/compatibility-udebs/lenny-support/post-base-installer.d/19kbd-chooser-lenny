#! /bin/sh
set -e

file=/usr/lib/post-base-installer.d/20kbd-chooser

[ -f $file ] || exit 0

# For Lenny we also need to set charmap
sed -i '/Get values console-setup needs/a\CHARMAP="$(LC_ALL=$LOCALE chroot /target locale charmap)"'$file

# Lenny has console-setup, not keyboard-configuration and asks both
# the layout and variant questions. Also set charmap.
sed -i '/^keyboard-configuration/d' $file
sed -i '/debconf-set-selections/a\# Modified for Lenny\
console-setup console-setup/layoutcode string\
console-setup console-setup/variantcode string\
d-i debian-installer/charmap string $CHARMAP' $file
