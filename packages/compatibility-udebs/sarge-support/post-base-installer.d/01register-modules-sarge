#! /bin/sh

# Support installing a 2.6.8-ish kernel from a system running a newer
# kernel. hw-detect skips registering some modules that udev picks up in
# newer kernels, but problably not in the kernel in sarge.
SUBARCH="$(archdetect)"
if [ -e /proc/ide/ -a "`find /proc/ide/* -type d 2>/dev/null`" != "" ]; then
	case "$(uname -r)" in
	    2.6.*)
		register-module ide-generic || true
		register-module ide-cd || true
		register-module ide-disk || true
		;;
	esac
fi
if [ -e /proc/scsi/scsi ] && ! grep -q "Attached devices: none" /proc/scsi/scsi; then
	register-module sr_mod || true
	register-module sd_mod || true
fi

case "$(udpkg --print-architecture)" in
	i386|ia64|amd64)
		register-module psmouse
		;;
esac

case $SUBARCH in
	powerpc/chrp*|powerpc/prep)
		register-module psmouse
		;;
esac
