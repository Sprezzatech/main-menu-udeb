#!/bin/sh 

. /usr/share/debconf/confmodule

# Silently exit if we're using a serial console
db_get debian-installer/serial-console
if [ "$RET" != false ]; then
	exit 0
fi

# This file tells console-data (>= 2:1.04-2) to not display the
# keymap/policy question when it is being installed
mkdir -p /target/tmp/debian-installer
> /target/tmp/debian-installer/keymap-policy-default

apt-install console-tools console-data console-common || true

db_get debian-installer/keymap
KEYMAP=$RET
# Silently exit if no keymap is set
if [ -z "$KEYMAP" ]; then
	exit 0
fi

# Install non-Unicode variants of Turkish keymaps
if [ "$KEYMAP" = "trqu" ]; then
	KEYMAP="trq"
	db_set debian-installer/keymap $KEYMAP
fi
if [ "$KEYMAP" = "trfu" ]; then
	KEYMAP="trf"
	db_set debian-installer/keymap $KEYMAP
fi

[ -n "$kbd_mode_temp" ] && kbd-mode --$kbd_mode_temp
chroot /target install-keymap $KEYMAP
[ -n "$kbd_mode_temp" ] && kbd-mode --unicode

exit 0
