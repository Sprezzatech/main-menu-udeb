#!/bin/sh

# subarch-specific handling
case "`archdetect`" in
"m68k/*vme*")
	# check for a scsi-floppy
	if [ ! -e /dev/sfd0 ]; then
		PROCSCSI=/proc/scsi/scsi

# algorithm from bf/dbootstrap/main.c, hopefully it works.
#/* scan /proc/scsi/scsi for TEAC FC-1 floppy drive
# * and create /dev/sfd[0-7] symlinks if found
# */
#        if (strstr(buf, "Vendor:")
#        &&  strstr(buf, "TEAC"   )
#        &&  strstr(buf, "Model:" )
#        &&  strstr(buf, "FC-1"   )) {
#          sprintf(dev, "sd%c", 'a' + i);
#          sprintf(buf, "/dev/sfd%d", n++);

		CNTDEV=0
		CNTSFD=0
		cat $PROCSCSI | while read line; do
			if [ "" != "`echo $line | grep 'Host:'`" ]; then
				CNTDEV=$((CNTDEV+1))	
			elif [ "" != "`echo $line | grep 'Vendor:' | grep TEAC | grep 'FC-1'`" ]; then
				ADEV=`printf "%o" $(($CNTDEV+0141))`
				ADEV=`echo -e '\0'$ADEV`
				
				if [ ! -e $ROOT/dev/sfd$CNTSFD ]; then
					if [ ! -e $ROOT/dev/sd$ADEV ]; then
						echo  "Creating /dev/sd$ADEV ..."
						mknod $ROOT/dev/sd$ADEV b $((16*$CNTDEV)) 0
					fi
			
					echo  "Linking /dev/sd$ADEV to /dev/sfd$CNTSFD ..."
					ln -s $ROOT/dev/sd$ADEV $ROOT/dev/sfd$CNTSFD
				fi
				CNTSFD=$((CNTSFD+1))	
			fi
		done
	fi
	;;
*)
	;;
esac

