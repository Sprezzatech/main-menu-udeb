#!/bin/sh
set -e

[ "$TERM_TYPE" != network ] && exit 0

log() {
    logger -t prebaseconfig "$@"
}

. /usr/share/debconf/confmodule

TEMPLATE_ROOT=debian-installer/network-console

DIR=/etc/ssh/

mkdir /target/$DIR
cp $DIR/ssh_host_rsa_key* /target/$DIR
cp $DIR/sshd_config_target /target/$DIR/sshd_config

echo 'installer:x:0:0:installer:/:/usr/sbin/base-config-network-console' >> /target/etc/passwd
grep "^installer:" /etc/shadow >> /target/etc/shadow

if apt-install network-console-config ; then
    log "Installed network-console-config successfully into /target"
    db_input critical $TEMPLATE_ROOT/prebaseconfig-reminder
    db_go
else
    ## FIXME (see #279090) ##
    # There really should be a dialog shown here
    # Not implemented yet because of string freeze for RC2 release
    log "Installation of network-console-config into /target failed"
fi
