#!/bin/sh -e

PLACES="$PLACES /cdrom/live/filesystem.ext2 /cdrom/live/filesystem.ext3 /cdrom/live/filesystem.ext4"

extX_prepare() {
	modprobe $1 || true

	mkdir -p /mnt
	umount /mnt > /dev/null 2>&1 || true
	if ! mount -t $1 -o loop,ro $place /mnt; then
		error "$place has failed to be mounted as ext4."
		exit 1
	fi

	cd /mnt
}

extX_teardown() {
	umount -d /mnt > /dev/null 2>&1 || true
}

extX_count() {
	echo `print-inodes /mnt`
}

for fs in ext2 ext3 ext4; do
	eval <<EOF
	${fs}_prepare() {
		extX_prepare $fs
	}

	${fs}_teardown() {
		extX_teardown
	}

	${fs}_count() {
		extX_count
	}
EOF
done
