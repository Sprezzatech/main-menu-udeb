#!/bin/sh

mkdir -p /var/lib/partman

if [ "`udpkg --print-os`" = hurd ]; then
	[ -f /hurd/ext2fs ] && >/var/lib/partman/ext2
	[ -f /hurd/fatfs ] && >/var/lib/partman/vfat
	exit 0
fi

cat /proc/modules |
while read module_name x; do
	if [ "$module_name" = ext2 ]; then
		>/var/lib/partman/ext2
	fi
	if [ "$module_name" = vfat ]; then
		>/var/lib/partman/vfat
	fi
done

if ! [ -f /var/lib/partman/ext2 ] && \
   modprobe ext2  >/dev/null 2>/dev/null; then
	>/var/lib/partman/ext2
fi

if ! [ -f /var/lib/partman/vfat ] && \
   modprobe vfat  >/dev/null 2>/dev/null; then
	>/var/lib/partman/vfat
fi

if grep -q ext2 /proc/filesystems; then
	>/var/lib/partman/ext2
fi
if grep -q vfat /proc/filesystems; then
	>/var/lib/partman/vfat
fi
