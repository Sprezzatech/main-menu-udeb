#!/bin/sh

. /lib/partman/definitions.sh

dev=$2
id=$3
part=$dev/$id

cd $dev

[ -f $part/method -a -f $part/acting_filesystem ] || return 0
filesystem=$(cat $part/acting_filesystem)

case $1 in
    mountpoint)
	select_mountpoint $dev $id
	update_partition $dev $id
	;;
    options)
	select_mountoptions $dev $id partman-reiserfs/options
	;;
    label)
	if [ -f $part/label ]; then
	    label=$(cat $part/label)
	elif [ -f $part/mountpoint ]; then
	    label=$(cat $part/mountpoint)
	else
	    label=''
	fi
	db_reset partman-basicfilesystems/choose_label
	db_set partman-basicfilesystems/choose_label "$label"
	db_input critical partman-basicfilesystems/choose_label || true
	db_go || exit 1
	db_get partman-basicfilesystems/choose_label
	if [ "$RET" ]; then
	    echo "$RET" >$part/label
	else
	    [ ! -f $part/label ] || rm $part/label
	fi
	;;
esac

