#!/bin/sh

. /lib/partman/definitions.sh

confirm_changes "partman-md" || exit 0

# Commit the changes

for s in /lib/partman/commit.d/*; do
    if [ -x $s ]; then
	$s || {
	    db_input high partman-md/commit_failed || true
	    db_go || true
	    for s in /lib/partman/init.d/*; do
		if [ -x $s ]; then
		    $s || exit 255
		fi
	    done
	    exit 0
	}
    fi
done

stop_parted_server

mdcfg

restart_partman
