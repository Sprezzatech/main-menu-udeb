#!/bin/sh
#
# Get ISO codes from the iso-codes package and extract translations
set -e
[ -r /usr/share/iso-codes/iso_3166.tab ] || exit 1
rm -rf debian/iso-codes >/dev/null 2>&1
mkdir debian/iso-codes
for i in `find /usr/share/locale/ -name iso_3166.mo` ; do
  language=`echo $i | cut -f5 -d/`
  # If a file exists in iso-codes.updated, then use it
  # else extract translations from the iso-codes package
  if [ ! -f iso-codes.updates/$language.po ] ; then
    msgunfmt $i >debian/iso-codes/${language}.po 2>/dev/null
  else
    cp iso-codes.updates/$language.po debian/iso-codes
  fi
done

for i in `find iso-codes.updates -name \*.po -maxdepth 1` ; do
  if [ ! -f debian/iso-codes/`basename $i` ] ; then
    cp $i debian/iso-codes
  fi
done
