#!/bin/sh -e

(modprobe srm_env || true) 2> /dev/null

. /usr/share/debconf/confmodule

[ -e /proc/srm_environment/named_variables/language ] || exit 0

LANGCODE=`cat /proc/srm_environment/named_variables/language`

LANG=`grep "^$LANGCODE:" /usr/share/srm-reader/lang-codes | cut -b3-`
if [ "x$LANG" != "x" ] ; then
	db_set debconf/language "$LANG"
fi

COUNTRY=`grep "^$LANGCODE:" /usr/share/srm-reader/country-codes | cut -b3-`
if [ "x$COUNTRY" != "x" ]; then
	db_set debian-installer/country "$COUNTRY"
	if "x$LANG" != "x" ]; then
		db_set debian-installer/language "$LANG_$COUNTRY"
		db_set debian-installer/locale "$LANG_$COUNTRY"
	fi
fi

exit 0
