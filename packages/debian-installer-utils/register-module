#!/bin/sh
QUEUE=/var/lib/register-module
TYPE=options
PARAMS_ONLY=0

if [ "$1" = "-t" ]; then
	TYPE=$2
	shift 2
fi
if [ "$1" = "-p" ]; then
	PARAMS_ONLY=1
	shift 1
fi

MODULE=$1
shift
PARAMS="$@"

QUEUEFILE=$QUEUE/$MODULE.load
PARAMFILE=$QUEUE/$MODULE.params

mkdir -p $QUEUE
if [ "$PARAMS_ONLY" = 0 ]; then
	touch $QUEUEFILE
fi
grep -v "^$TYPE:" $PARAMFILE > $PARAMFILE.new
[ -n "$PARAMS" ] && echo "$TYPE:$PARAMS" >> $PARAMFILE.new
mv $PARAMFILE.new $PARAMFILE
