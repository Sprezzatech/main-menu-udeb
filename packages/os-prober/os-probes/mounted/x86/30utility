#!/bin/sh
# Detects utility (hw vendor recovery) partitions.

. /usr/share/os-prober/common.sh

partition=$1
mpoint=$2
type=$3

# Weed out stuff that doesn't apply to us
case "$type" in
	vfat)	debug "$1 is a FAT32 partition" ;;
	msdos)	debug "$1 is a FAT16 partition" ;;
	*)	debug "$1 is not a FAT partition: exiting"; exit 1 ;;
esac

# Dell Utility partitions have partition type 0xde, but no idea how to
# cleanly detect that from shell
if [ -e "$2/dellbio.bin" ] && \
  ([ -e "$2/delldiag.exe" ] || [ -e "$2/delldiag.com" ]); then
	long="Dell Utility Partition"
	short=DellUtility
else
	exit 1
fi

label=$(count_next_label $short)
result "${partition}:${long}:${label}:chain"
exit 0
